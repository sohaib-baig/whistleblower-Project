import{a as v,z as P,r as o,i as S,s as _,p as k,j as s,x as F,A as g,B as A,T as E,c as T}from"./index-BJkBHIXD.js";import{a as R}from"./index.esm-DG78EUPk.js";import{a as z}from"./zod-DbnPk1Kl.js";import{F as x}from"./fields-wQ2IQIfM.js";import{F as I}from"./form-provider-BYLnCB41.js";import{S as N}from"./Stack-DSqJGNfN.js";import{o as B,s as p}from"./schemas-BaSQ7w8v.js";import"./text-transform-DM798QSo.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./index-BdCJuPE0.js";import"./rhf-phone-input-DvY4aKGv.js";import"./index-CDpvdXdB.js";import"./search-not-found-BYtFGFNz.js";import"./InputAdornment-Cyf39fZQ.js";import"./rhf-text-field-D45rQogC.js";import"./RadioGroup-eX8WPtuC.js";import"./FormControlLabel-Do9AncA_.js";import"./Autocomplete-vOabT0lM.js";import"./Chip-Cd7PxQUv.js";import"./rhf-select-BCHEEYe2.js";import"./styles-B-zEs6qR.js";import"./format-number-BErDzwe7.js";import"./upload-default-BMHhCMpu.js";import"./tslib.es6-CTYbIaVE.js";import"./DatePicker-D3hVcc_W.js";const C={title:`Reset password | ${F.appName}`},D=B({email:p().email("Invalid email"),token:p().min(10,"Invalid token"),password:p().min(8,"Password must be at least 8 characters").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[^a-zA-Z0-9]/,"Password must contain at least one special character"),password_confirmation:p().min(1,"Please confirm your password")}).refine(t=>t.password===t.password_confirmation,{message:"Passwords must match",path:["password_confirmation"]});function cs(){const[t]=v(),l=P(),[d,y]=o.useState(!1),[u,w]=o.useState(null),[f,i]=o.useState(null),j=o.useMemo(()=>({email:t.get("email")??"",token:t.get("token")??"",password:"",password_confirmation:""}),[t]),a=R({resolver:z(D),defaultValues:j}),b=a.handleSubmit(async m=>{try{w(null),i(null),await S();const r=await _.post("/api/v1/password/reset",m),n=r?.message||r?.data?.message;w(n??"Password has been reset."),y(!0)}catch(r){const n=r?.responseData||r?.response?.data,e=n?.data?.errors||n?.errors;if(e){const c=Object.values(e).flat()[0];c&&typeof c=="string"?(i(c),e.password&&a.setError("password",{type:"server",message:Array.isArray(e.password)?e.password[0]:e.password}),e.password_confirmation&&a.setError("password_confirmation",{type:"server",message:Array.isArray(e.password_confirmation)?e.password_confirmation[0]:e.password_confirmation})):i(r?.message??"Failed to reset password")}else i(r?.message??"Failed to reset password")}}),{register:h}=a;return o.useEffect(()=>{if(d){const m=setTimeout(()=>{l(k.auth.jwt.signIn,{replace:!0})},1200);return()=>clearTimeout(m)}},[d,l]),s.jsxs(s.Fragment,{children:[s.jsx("title",{children:C.title}),!!u&&s.jsx(g,{severity:"success",sx:{mb:3},children:u}),!!f&&s.jsx(g,{severity:"error",sx:{mb:3},children:f}),s.jsxs(I,{methods:a,onSubmit:b,children:[s.jsx("input",{type:"hidden",...h("email")}),s.jsx("input",{type:"hidden",...h("token")}),s.jsxs(N,{spacing:2.5,children:[s.jsxs(A,{children:[s.jsx(x.Text,{name:"password",label:"New password",type:"password",slotProps:{inputLabel:{shrink:!0}}}),s.jsx(E,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:"Password must be at least 8 characters and contain: uppercase letter, lowercase letter, and special character"})]}),s.jsx(x.Text,{name:"password_confirmation",label:"Confirm password",type:"password",slotProps:{inputLabel:{shrink:!0}}}),s.jsx(T,{fullWidth:!0,size:"large",type:"submit",variant:"contained",children:"Reset password"})]})]})]})}export{cs as default};
