import{r,V as w,u as F,a0 as u,p as d,j as e,T as V,M as o,c as b,W as A,aa as E}from"./index-BJkBHIXD.js";import"./empty-content-Cck_Y1yy.js";import{a as L}from"./index.esm-DG78EUPk.js";import{c as M,f as D}from"./support-ticket-BcjHfbJs.js";import{F as i}from"./fields-wQ2IQIfM.js";import{F as B}from"./form-provider-BYLnCB41.js";import{G as C}from"./Grid-D_Et280v.js";import{C as G}from"./Card-CU8jzKuK.js";import{S as g}from"./Stack-DSqJGNfN.js";import{F as R,C as q}from"./FormControlLabel-Do9AncA_.js";import"./text-transform-DM798QSo.js";import"./styles-B-zEs6qR.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./index-BdCJuPE0.js";import"./rhf-phone-input-DvY4aKGv.js";import"./index-CDpvdXdB.js";import"./search-not-found-BYtFGFNz.js";import"./InputAdornment-Cyf39fZQ.js";import"./rhf-text-field-D45rQogC.js";import"./RadioGroup-eX8WPtuC.js";import"./Autocomplete-vOabT0lM.js";import"./Chip-Cd7PxQUv.js";import"./rhf-select-BCHEEYe2.js";import"./upload-default-BMHhCMpu.js";import"./tslib.es6-CTYbIaVE.js";import"./DatePicker-D3hVcc_W.js";import"./format-number-BErDzwe7.js";function z(){const[y,m]=r.useState(!1),[h,c]=r.useState([]),[n,x]=r.useState(!1),{user:a}=w(),S=F(),f=L({defaultValues:{title:"",content:"",status:"open",support_type:"technical_support",case_id:null}}),{handleSubmit:k,watch:j,setValue:l}=f,v=j("status"),p=j("support_type");r.useEffect(()=>{(async()=>{if(p==="legal_support"){x(!0);try{const s=a?.company?.id??a?.company_id??a?.id,_=await D(s);c(_)}catch(s){console.error("Error fetching active cases:",s),u.error(s.message||"Failed to load active cases"),c([])}finally{x(!1)}}else l("case_id",null),c([])})()},[p,l,a]);const T=k(async t=>{try{m(!0),await M(t),u.success("Support ticket created successfully!"),S.push(d.dashboard.supportTicket.root)}catch(s){u.error(s.message||"Failed to create support ticket")}finally{m(!1)}});return e.jsx(B,{methods:f,onSubmit:T,children:e.jsx(C,{container:!0,spacing:3,children:e.jsx(C,{size:{xs:12,md:8},children:e.jsxs(G,{sx:{p:3},children:[e.jsx(V,{variant:"h6",sx:{mb:3},children:"Create Support Ticket"}),e.jsxs(g,{spacing:3,children:[e.jsxs(i.Select,{name:"support_type",label:"Support Type",placeholder:"Select support type...",children:[e.jsx(o,{value:"legal_support",children:"Legal Support"}),e.jsx(o,{value:"technical_support",children:"Technical Support"})]}),p==="legal_support"&&e.jsxs(i.Select,{name:"case_id",label:"Case",placeholder:n?"Loading cases...":"Select a case...",disabled:n,children:[h.length===0&&!n&&e.jsx(o,{value:"",disabled:!0,children:"No active cases available"}),h.map(t=>e.jsxs(o,{value:t.id,children:[t.case_id," - ",t.subject||t.title||"Untitled"]},t.id))]}),e.jsx(i.Text,{name:"title",label:"Subject",placeholder:"Enter ticket subject..."}),e.jsx(i.Text,{name:"content",label:"Message",multiline:!0,rows:6,placeholder:"Describe your issue or question..."}),e.jsx(R,{control:e.jsx(q,{checked:v==="closed",onChange:t=>{l("status",t.target.checked?"closed":"open")}}),label:"Mark as closed after creation"}),e.jsxs(g,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(b,{variant:"outlined",onClick:()=>window.history.back(),children:"Cancel"}),e.jsx(b,{type:"submit",variant:"contained",loading:y,children:"Create Ticket"})]})]})]})})})})}function N(){return e.jsxs(A,{children:[e.jsx(E,{heading:"Create Support Ticket",links:[{name:"Dashboard",href:d.dashboard.root},{name:"Support Tickets",href:d.dashboard.supportTicket.root},{name:"Create"}],sx:{mb:{xs:3,md:5}}}),e.jsx(z,{})]})}function xe(){return e.jsx(N,{})}export{xe as default};
