import{r,i as w,s as S,x as p,j as e,B as u,T as h,A as g,c as P}from"./index-BJkBHIXD.js";import{a as F}from"./index.esm-DG78EUPk.js";import{a as M}from"./zod-DbnPk1Kl.js";import{l as T}from"./text-transform-DM798QSo.js";import{u as C}from"./use-search-params-BFu-mSGR.js";import"./styles-B-zEs6qR.js";import{F as E}from"./form-provider-BYLnCB41.js";import{o as V,s as B}from"./schemas-BaSQ7w8v.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./Stack-DSqJGNfN.js";import"./format-number-BErDzwe7.js";const I={title:`Two-factor authentication | ${p.appName}`},W=V({code:B().min(6,{message:"Code is required"}).max(6,{message:"Code must be 6 digits"})});function J(){const n=C(),[c,t]=r.useState(null),[m,l]=r.useState(null),a=n.get("email")??"",d=n.get("method")??"email",o=F({resolver:M(W),defaultValues:{code:""}}),{handleSubmit:f,setValue:x,formState:{isSubmitting:y}}=o;r.useEffect(()=>{a?l(d==="app"?"Enter the 6-digit code from your authenticator app.":"Enter the 6-digit code sent to your email address."):t("Missing email. Please login again.")},[a,d]);const j=i=>{x("code",i,{shouldValidate:!0})},b=f(async i=>{if(!a){t("Missing email. Please login again.");return}try{t(null),await w(),await S.post("/api/v1/auth/2fa/verify",{email:a,code:i.code}),sessionStorage.setItem("just_logged_in","true"),await new Promise(s=>setTimeout(s,100)),window.location.href=p.auth.redirectPath}catch(s){const v=s?.response?.data?.message||s?.message||"Failed to verify two-factor authentication code.";t(v)}});return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:I.title}),e.jsxs(u,{sx:{maxWidth:420,mx:"auto",py:6},children:[e.jsx(h,{variant:"h4",sx:{mb:1},children:"Two-factor authentication"}),e.jsx(h,{variant:"body2",sx:{mb:3},children:"We've added an extra layer of security to your account. Please enter the 6-digit code to continue."}),!!m&&e.jsx(g,{severity:"info",sx:{mb:2},children:m}),!!c&&e.jsx(g,{severity:"error",sx:{mb:2},children:c}),e.jsx(E,{methods:o,onSubmit:b,children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(T,{length:6,value:o.watch("code"),onChange:j,TextFieldsProps:{placeholder:"â€’",inputMode:"numeric"}}),e.jsx(P,{fullWidth:!0,color:"inherit",size:"large",type:"submit",variant:"contained",loading:y,children:"Verify and continue"})]})})]})]})}export{J as default};
