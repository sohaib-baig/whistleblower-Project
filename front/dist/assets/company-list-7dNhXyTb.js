import{w as z,bI as ae,a4 as K,j as e,L as se,y as A,B as g,T as E,ah as U,bP as $,a7 as V,I as y,bJ as oe,bK as ne,M as F,c as k,r as h,bR as te,a0 as x,cB as re,p as b,i as le,s as ie,aa as D,b as de,J as ce,U as me,K as he,ab as pe,W as ue}from"./index-BJkBHIXD.js";import{a as O,d as M,b as be}from"./company-table-toolbar-DdpGE0JH.js";import{C as J}from"./confirm-dialog-D488U7AY.js";import{u as xe,g as ge,r as ye,e as fe,T as je}from"./table-no-data-BKo9R2Zy.js";import{T as Ce}from"./table-empty-rows-BDBaI17h.js";import{T as ve}from"./table-head-custom-C2dATJUG.js";import{T as we}from"./table-selected-action-uAaUSqFj.js";import{T as Te}from"./table-pagination-custom-Dom7EZhX.js";import{T as Pe,a as j,b as Se,c as ke}from"./TableHead-D9jAElFw.js";import{C as Re}from"./FormControlLabel-Do9AncA_.js";import{S as Fe}from"./Stack-DSqJGNfN.js";import{F as De,a as W,c as H}from"./filters-result-8ZMjXTco.js";import{C as N}from"./Chip-Cd7PxQUv.js";import{C as _}from"./Card-CU8jzKuK.js";import"./index.esm-DG78EUPk.js";import"./zod-DbnPk1Kl.js";import"./schemas-BaSQ7w8v.js";import"./rhf-phone-input-DvY4aKGv.js";import"./index-CDpvdXdB.js";import"./search-not-found-BYtFGFNz.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./InputAdornment-Cyf39fZQ.js";import"./fields-wQ2IQIfM.js";import"./text-transform-DM798QSo.js";import"./index-BdCJuPE0.js";import"./rhf-text-field-D45rQogC.js";import"./RadioGroup-eX8WPtuC.js";import"./Autocomplete-vOabT0lM.js";import"./rhf-select-BCHEEYe2.js";import"./styles-B-zEs6qR.js";import"./format-number-BErDzwe7.js";import"./upload-default-BMHhCMpu.js";import"./tslib.es6-CTYbIaVE.js";import"./DatePicker-D3hVcc_W.js";import"./schema-utils-C_-d4BNQ.js";import"./form-provider-BYLnCB41.js";import"./Grid-D_Et280v.js";import"./empty-content-Cck_Y1yy.js";import"./LastPage-CrCg5Ljk.js";function Ae({row:a,selected:s,editHref:p,onSelectRow:u,onDeleteRow:r,onAccessAccount:l}){const{t:n}=z("navbar"),t=ae(),m=K(),C=()=>e.jsx(oe,{open:t.open,anchorEl:t.anchorEl,onClose:t.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ne,{children:[e.jsx("li",{children:e.jsxs(F,{component:A,href:p,onClick:()=>t.onClose(),children:[e.jsx(y,{icon:"solar:pen-bold"}),n("dashboard.company.edit")]})}),l&&e.jsx("li",{children:e.jsxs(F,{onClick:()=>{l(),t.onClose()},children:[e.jsx(y,{icon:"solar:user-id-bold"}),n("dashboard.company.accessAccount")]})}),e.jsxs(F,{onClick:()=>{m.onTrue(),t.onClose()},sx:{color:"error.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),n("dashboard.company.delete")]})]})}),R=()=>e.jsx(J,{open:m.value,onClose:m.onFalse,title:n("dashboard.company.deleteConfirmTitle"),content:n("dashboard.company.deleteConfirmMessage"),action:e.jsx(k,{variant:"contained",color:"error",onClick:r,children:n("dashboard.company.delete")})});return e.jsxs(e.Fragment,{children:[e.jsxs(Pe,{hover:!0,selected:s,"aria-checked":s,tabIndex:-1,children:[e.jsx(j,{padding:"checkbox",children:e.jsx(Re,{checked:s,onClick:u,slotProps:{input:{id:`${a.id}-checkbox`,"aria-label":`${a.id} checkbox`}}})}),e.jsx(j,{children:e.jsxs(Fe,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsx(se,{component:A,href:p,color:"inherit",sx:{cursor:"pointer"},children:a.name}),e.jsx(g,{component:"span",sx:{color:"text.disabled"},children:a.email})]})}),e.jsx(j,{sx:{maxWidth:150},children:e.jsx(E,{variant:"body2",noWrap:!0,sx:{maxWidth:140},children:a.phoneNumber})}),e.jsx(j,{sx:{maxWidth:220},children:e.jsx(U,{title:a.address||"",arrow:!0,children:e.jsx(E,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:a.address})})}),e.jsx(j,{children:e.jsx($,{variant:"soft",color:a.status==="active"&&"success"||a.status==="pending"&&"warning"||a.status==="banned"&&"error"||"default",children:a.status})}),e.jsx(j,{children:e.jsx(g,{sx:{display:"flex",alignItems:"center"},children:e.jsx(V,{color:t.open?"inherit":"default",onClick:t.onOpen,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})})})]}),C(),R()]})}function Ie({filters:a,onResetPage:s,totalResults:p,sx:u}){const{state:r,setState:l,resetState:n}=a,t=h.useCallback(()=>{s(),l({name:""})},[s,l]),m=h.useCallback(()=>{s(),l({status:""})},[s,l]),C=h.useCallback(()=>{s(),n()},[s,n]);return e.jsxs(De,{totalResults:p,onReset:C,sx:u,children:[e.jsx(W,{label:"Status:",isShow:!!r.status,children:e.jsx(N,{...H,label:r.status,onDelete:m,sx:{textTransform:"capitalize"}})}),e.jsx(W,{label:"Keyword:",isShow:!!r.name,children:e.jsx(N,{...H,label:r.name,onDelete:t})})]})}function Be(){const{t:a}=z("navbar"),s=xe({defaultOrderBy:"createdAt",defaultOrder:"desc"}),p=[{value:"all",label:a("dashboard.company.all")},{value:"active",label:a("dashboard.company.statusOptions.active","Active")},{value:"pending",label:a("dashboard.company.statusOptions.pending","Pending")},{value:"banned",label:a("dashboard.company.statusOptions.banned","Banned")}],u=[{id:"name",label:a("dashboard.company.tableHeaders.companyName"),width:250},{id:"phoneNumber",label:a("dashboard.company.tableHeaders.phoneNumber"),width:150},{id:"address",label:a("dashboard.company.tableHeaders.address"),width:220},{id:"status",label:a("dashboard.company.tableHeaders.status"),width:100},{id:"",width:88}],r=K(),l=te({name:"",status:"all"}),{state:n,setState:t}=l,m=h.useMemo(()=>({search:n.name,status:n.status!=="all"?n.status:void 0,per_page:100}),[n.name,n.status]),{companies:C,loading:R,error:I,refetch:v}=O(m),{companies:f}=O({per_page:1e3}),[w,G]=h.useState({all:0,active:0,pending:0,banned:0});h.useEffect(()=>{if(f){const o=f.filter(c=>c.status==="active").length,d=f.filter(c=>c.status==="pending").length,P=f.filter(c=>c.status==="banned").length;G({all:f.length,active:o,pending:d,banned:P})}},[f]);const i=Le({inputData:C,comparator:ge(s.order,s.orderBy),filters:n}),T=ye(i,s.page,s.rowsPerPage),B=!!n.name||!!n.status&&n.status!=="all",q=!i.length&&B||!i.length,Q=h.useCallback(async o=>{try{await M(o),x.success(a("dashboard.company.companyDeleted")),v(),s.onUpdatePageDeleteRow(T.length)}catch(d){console.error("Failed to delete company:",d),x.error(a("dashboard.company.failedToDelete"))}},[T.length,s,v,a]),X=h.useCallback(async()=>{try{await Promise.all(s.selected.map(o=>M(o))),x.success(a("dashboard.company.companiesDeleted")),v(),s.onUpdatePageDeleteRows(T.length,i.length)}catch(o){console.error("Failed to delete companies:",o),x.error(a("dashboard.company.failedToDeletePlural"))}},[i.length,T.length,s,v,a]),Y=h.useCallback(async o=>{try{await re(o),x.success(a("dashboard.company.successfullyLoggedIn"));const d=b.dashboard.overview.analytics;await new Promise(c=>setTimeout(c,800)),await le();let P=!1;for(let c=0;c<3;c++)try{const S=await ie.get("/api/v1/auth/me");if(S?.data?.user??S?.data){P=!0;break}}catch(S){c<2?await new Promise(L=>setTimeout(L,500)):console.error("Session verification failed after retries:",S)}if(!P){x.error("Session verification failed. Please try again.");return}sessionStorage.setItem("just_impersonated","true"),window.location.href=d}catch(d){console.error("Failed to access account:",d),x.error(a("dashboard.company.failedToAccessAccount"))}},[a]),Z=h.useCallback((o,d)=>{s.onResetPage(),t({status:d})},[t,s]),ee=()=>e.jsx(J,{open:r.value,onClose:r.onFalse,title:a("dashboard.company.deleteConfirmTitle"),content:e.jsxs(e.Fragment,{children:[a("dashboard.company.deleteConfirmMessagePlural")," ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," ",a("dashboard.company.companies"),"?"]}),action:e.jsx(k,{variant:"contained",color:"error",onClick:()=>{X(),r.onFalse()},children:a("dashboard.company.delete")})});return R?e.jsxs(e.Fragment,{children:[e.jsx(D,{heading:a("dashboard.company.heading"),links:[{name:"Dashboard",href:b.dashboard.overview.analytics},{name:a("dashboard.company.heading"),href:b.dashboard.company.root},{name:a("dashboard.company.list")}],sx:{mb:{xs:3,md:5}}}),e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(de,{})})]}):I?e.jsxs(e.Fragment,{children:[e.jsx(D,{heading:a("dashboard.company.heading"),links:[{name:"Dashboard",href:b.dashboard.overview.analytics},{name:a("dashboard.company.heading"),href:b.dashboard.company.root},{name:a("dashboard.company.list")}],sx:{mb:{xs:3,md:5}}}),e.jsxs(_,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{sx:{color:"error.main",mb:2},children:e.jsx(y,{icon:"solar:danger-bold",width:48})}),e.jsx(g,{sx:{typography:"h6",mb:1},children:a("dashboard.company.errorLoadingCompanies")}),e.jsx(g,{sx:{typography:"body2",color:"text.secondary",mb:2},children:I}),e.jsx(k,{variant:"contained",onClick:v,children:a("dashboard.company.retry")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{heading:a("dashboard.company.heading"),links:[{name:"Dashboard",href:b.dashboard.overview.analytics},{name:a("dashboard.company.heading"),href:b.dashboard.company.root},{name:a("dashboard.company.list")}],action:e.jsx(k,{component:A,href:b.dashboard.company.new,variant:"contained",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:a("dashboard.company.createCompany")}),sx:{mb:{xs:3,md:5}}}),e.jsxs(_,{children:[e.jsx(ce,{value:n.status||"all",onChange:Z,sx:[o=>({px:{md:2.5},boxShadow:`inset 0 -2px 0 0 ${me(o.vars.palette.grey["500Channel"],.08)}`})],children:p.map(o=>e.jsx(he,{iconPosition:"end",value:o.value,label:o.label,icon:e.jsx($,{variant:(o.value==="all"||o.value===n.status)&&"filled"||"soft",color:o.value==="active"&&"success"||o.value==="pending"&&"warning"||o.value==="banned"&&"error"||"default",children:o.value==="all"?w.all:o.value==="active"?w.active:o.value==="pending"?w.pending:o.value==="banned"?w.banned:0})},o.value))}),e.jsx(be,{filters:l,onResetPage:s.onResetPage,statusOptions:p}),B&&e.jsx(Ie,{filters:l,totalResults:i.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(g,{sx:{position:"relative"},children:[e.jsx(we,{dense:s.dense,numSelected:s.selected.length,rowCount:i.length,onSelectAllRows:o=>s.onSelectAllRows(o,i.map(d=>d.id)),action:e.jsx(U,{title:"Delete",children:e.jsx(V,{color:"primary",onClick:r.onTrue,children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(pe,{children:e.jsxs(Se,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ve,{order:s.order,orderBy:s.orderBy,headCells:u,rowCount:i.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:o=>s.onSelectAllRows(o,i.map(d=>d.id))}),e.jsxs(ke,{children:[i.map(o=>e.jsx(Ae,{row:o,selected:s.selected.includes(o.id),onSelectRow:()=>s.onSelectRow(o.id),onDeleteRow:()=>Q(o.id),onAccessAccount:()=>Y(o.id),editHref:b.dashboard.company.edit(o.id)},o.id)),e.jsx(Ce,{height:s.dense?56:76,emptyRows:fe(s.page,s.rowsPerPage,i.length)}),e.jsx(je,{notFound:q})]})]})})]}),e.jsx(Te,{page:s.page,dense:s.dense,count:i.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]}),ee()]})}function Le({inputData:a,comparator:s,filters:p}){const{name:u,status:r}=p,l=a.map((n,t)=>[n,t]);return l.sort((n,t)=>{const m=s(n[0],t[0]);return m!==0?m:n[1]-t[1]}),a=l.map(n=>n[0]),u&&typeof u=="string"&&(a=a.filter(n=>n.name?.toLowerCase().includes(u.toLowerCase()))),r&&r!=="all"&&(a=a.filter(n=>n.status===r)),a}function Ee(){return e.jsx(ue,{children:e.jsx(Be,{})})}function va(){return e.jsx(Ee,{})}export{va as default};
