import{w as C,a4 as B,V as z,r as h,j as e,B as o,ah as f,a7 as v,I as F,x as w,s as A,M as G,X as O,_ as V,c as q,a0 as m,c0 as M,c1 as H,bP as Q,T as r,bQ as S,a6 as N,ab as J,W as X,aa as K,p as k,a9 as Y,bx as Z,c2 as ee}from"./index-BJkBHIXD.js";import"./empty-content-Cck_Y1yy.js";import"./filters-result-8ZMjXTco.js";import{a as se,b as ae}from"./invoice-pdf-y8A2rGXB.js";import{b as P}from"./format-number-BErDzwe7.js";import{T as te}from"./TextField-BfOXJaKd.js";import{C as re}from"./Card-CU8jzKuK.js";import{S as g}from"./Stack-DSqJGNfN.js";import{b as ie,d as ne,T as U,a as n,c as oe}from"./TableHead-D9jAElFw.js";import"./index.esm-DG78EUPk.js";import"./zod-DbnPk1Kl.js";import"./schemas-BaSQ7w8v.js";import"./text-transform-DM798QSo.js";import"./Select-CM-FquqI.js";import"./styles-B-zEs6qR.js";import"./schema-utils-C_-d4BNQ.js";import"./form-provider-BYLnCB41.js";import"./search-not-found-BYtFGFNz.js";import"./InputAdornment-Cyf39fZQ.js";import"./fields-wQ2IQIfM.js";import"./index-BdCJuPE0.js";import"./rhf-phone-input-DvY4aKGv.js";import"./index-CDpvdXdB.js";import"./rhf-text-field-D45rQogC.js";import"./RadioGroup-eX8WPtuC.js";import"./FormControlLabel-Do9AncA_.js";import"./Autocomplete-vOabT0lM.js";import"./Chip-Cd7PxQUv.js";import"./rhf-select-BCHEEYe2.js";import"./upload-default-BMHhCMpu.js";import"./tslib.es6-CTYbIaVE.js";import"./DatePicker-D3hVcc_W.js";import"./react-pdf.browser-BH-ePMdR.js";function le({invoice:s,currentStatus:a,statusOptions:l,onChangeStatus:b,disabled:x}){const{t:d}=C("navbar"),{value:c,onFalse:T}=B(),{user:I}=z(),t=h.useRef(null),[p,y]=h.useState(!1),_=I?.role==="admin",$=a==="pending",E=()=>{t.current?.click()},W=async i=>{const j=i.target.files?.[0];if(!j||!s?.id)return;if(!["image/jpeg","image/jpg","image/png","application/pdf"].includes(j.type)){m.error("Invalid file type. Please upload JPG, PNG, or PDF.");return}const u=5*1024*1024;if(j.size>u){m.error("File size must be less than 5MB.");return}y(!0);try{await M(s.id,j),m.success("Payment receipt uploaded successfully"),window.location.reload()}catch(R){m.error(R?.message||"Failed to upload payment receipt")}finally{y(!1),t.current&&(t.current.value="")}},L=()=>e.jsx(O,{fullScreen:!0,open:c,children:e.jsxs(o,{sx:{height:1,display:"flex",flexDirection:"column"},children:[e.jsx(V,{sx:{p:1.5},children:e.jsx(q,{color:"inherit",variant:"contained",onClick:T,children:d("dashboard.invoice.close")})}),e.jsx(o,{sx:{flexGrow:1,height:1,overflow:"hidden"},children:s&&e.jsx(se,{invoice:s,currentStatus:a})})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(o,{className:"invoice-toolbar",sx:{gap:3,display:"flex",mb:{xs:3,md:5},flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"flex-end",sm:"center"}},children:[e.jsxs(o,{sx:{gap:1,width:1,flexGrow:1,display:"flex"},children:[s?.paymentAttachment&&e.jsx(f,{title:d("dashboard.invoice.viewPaymentAttachment"),children:e.jsx(v,{onClick:()=>{if(!s.paymentAttachment)return;const i=s.paymentAttachment.startsWith("http")?s.paymentAttachment:`${w.serverUrl}${s.paymentAttachment}`;window.open(i,"_blank")},children:e.jsx(F,{icon:"solar:paperclip-bold"})})}),e.jsx(f,{title:d("dashboard.invoice.download")||"Download",children:e.jsx(v,{onClick:async()=>{if(s?.id)try{const i=await A.get(`/api/v1/invoices/${s.id}/pdf`,{responseType:"blob"}),j=new Blob([i.data],{type:"application/pdf"}),D=window.URL.createObjectURL(j),u=document.createElement("a");u.href=D,u.download=`${s.invoiceNumber}.pdf`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(D)}catch(i){console.error("Error downloading PDF:",i),window.open(`${w.serverUrl}/api/v1/invoices/${s.id}/pdf`,"_blank")}},children:e.jsx(F,{icon:"solar:download-bold"})})}),e.jsx(f,{title:d("dashboard.invoice.print"),children:e.jsx(v,{onClick:()=>{window.print()},children:e.jsx(F,{icon:"solar:printer-minimalistic-bold"})})}),$&&e.jsx(f,{title:"Upload Payment Receipt",children:e.jsx(v,{onClick:E,disabled:p,children:e.jsx(F,{icon:"solar:upload-bold"})})}),e.jsx("input",{ref:t,type:"file",hidden:!0,accept:"image/jpeg,image/jpg,image/png,application/pdf",onChange:W})]}),_&&e.jsx(te,{fullWidth:!0,select:!0,label:d("dashboard.invoice.status"),value:a,onChange:b,disabled:!s?.id||x,sx:{maxWidth:160},slotProps:{htmlInput:{id:"status-select"},inputLabel:{htmlFor:"status-select"}},children:l.map(i=>e.jsx(G,{value:i.value,children:i.label},i.value))})]}),L()]})}function de({invoice:s}){const{t:a}=C("navbar"),[l,b]=h.useState(s?.status),[x,d]=h.useState(!1),c=h.useCallback(async t=>{const p=t.target.value;if(!s?.id){m.error("Invoice ID is missing");return}b(p),d(!0);try{await A.put(`/api/v1/invoices/${s.id}/status`,{status:p}),m.success("Invoice status updated successfully")}catch(y){b(s?.status),m.error(y?.message||"Failed to update invoice status")}finally{d(!1)}},[s]),T=()=>e.jsxs(o,{sx:{py:3,gap:2,display:"flex",flexWrap:"wrap",alignItems:"center"},children:[e.jsxs("div",{children:[s?.invoiceNote&&e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:.5},children:a("dashboard.invoice.details.notes")}),e.jsx(r,{variant:"body2",sx:{whiteSpace:"pre-line"},children:s.invoiceNote})]}),!s?.invoiceNote&&e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"subtitle2",sx:{mb:.5},children:a("dashboard.invoice.details.notes")}),e.jsx(r,{variant:"body2",children:"We appreciate your business."})]}),s?.bankDetails&&e.jsxs(o,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:.5},children:a("dashboard.invoice.details.bankDetails")}),e.jsxs(r,{variant:"body2",sx:{color:"text.secondary"},children:[s.bankDetails.iban&&e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[a("dashboard.invoice.details.iban"),":"]})," ",s.bankDetails.iban,e.jsx("br",{})]}),s.bankDetails.bic_code&&e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[a("dashboard.invoice.details.bicSwift"),":"]})," ",s.bankDetails.bic_code,e.jsx("br",{})]}),s.bankDetails.bank_account&&e.jsxs(e.Fragment,{children:[e.jsxs("strong",{children:[a("dashboard.invoice.details.bankgiro"),":"]})," ",s.bankDetails.bank_account]})]})]})]}),e.jsxs(o,{sx:{flexGrow:{md:1},textAlign:{md:"right"}},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:.5},children:a("dashboard.invoice.details.haveQuestion")}),e.jsx(r,{variant:"body2",children:s?.adminEmail||"support@minimals.cc"})]})]}),I=()=>e.jsx(J,{sx:{mt:5},children:e.jsxs(ie,{sx:{minWidth:960},children:[e.jsx(ne,{children:e.jsxs(U,{children:[e.jsx(n,{width:40,children:"#"}),e.jsx(n,{sx:{typography:"subtitle2"},children:a("dashboard.invoice.details.description")}),e.jsx(n,{children:a("dashboard.invoice.details.qty")}),e.jsx(n,{align:"right",children:a("dashboard.invoice.details.unitPrice")}),e.jsx(n,{align:"right",children:a("dashboard.invoice.details.total")})]})}),e.jsx(oe,{children:s?.items.map((t,p)=>e.jsxs(U,{children:[e.jsx(n,{children:p+1}),e.jsx(n,{children:e.jsxs(o,{sx:{maxWidth:560},children:[e.jsx(r,{variant:"subtitle2",children:t.title}),e.jsx(r,{variant:"body2",sx:{color:"text.secondary"},noWrap:!0,children:t.description})]})}),e.jsx(n,{children:t.quantity}),e.jsx(n,{align:"right",children:P(t.price)}),e.jsx(n,{align:"right",children:P(t.price*t.quantity)})]},p))})]})});return e.jsxs(e.Fragment,{children:[e.jsx(le,{invoice:s,currentStatus:l||"",onChangeStatus:c,statusOptions:H,disabled:x}),e.jsxs(re,{sx:{pt:5,px:5},children:[e.jsxs(o,{sx:{rowGap:5,display:"grid",alignItems:"center",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(o,{component:"img",alt:"Invoice logo",src:s?.logo?s.logo.startsWith("http")?s.logo:`${w.serverUrl}${s.logo}`:"/logo/logo-single.svg",sx:{width:125,height:"auto"},onError:t=>{console.error("âŒ Invoice logo failed to load:",t.currentTarget.src),t.currentTarget.src="/logo/logo-single.svg"}}),e.jsxs(g,{spacing:1,sx:{alignItems:{xs:"flex-start",md:"flex-end"}},children:[e.jsx(Q,{variant:"soft",color:l==="paid"&&"success"||l==="pending"&&"warning"||"default",children:l}),e.jsx(r,{variant:"h6",children:s?.invoiceNumber})]}),e.jsxs(g,{sx:{typography:"body2"},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1},children:a("dashboard.invoice.details.invoiceFrom")}),s?.invoiceFrom.company&&e.jsxs(e.Fragment,{children:[s.invoiceFrom.company,e.jsx("br",{})]}),s?.invoiceFrom.companyNumber&&e.jsxs(e.Fragment,{children:[a("dashboard.invoice.details.companyNumber"),": ",s.invoiceFrom.companyNumber,e.jsx("br",{})]}),s?.invoiceFrom.fullAddress,s?.invoiceFrom.city&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),s.invoiceFrom.city,s.invoiceFrom.zip_code&&`, ${s.invoiceFrom.zip_code}`]}),s?.invoiceFrom.country&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),s.invoiceFrom.country]}),e.jsx("br",{}),a("dashboard.invoice.details.phone"),": ",s?.invoiceFrom.phoneNumber,e.jsx("br",{})]}),e.jsxs(g,{sx:{typography:"body2"},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1},children:a("dashboard.invoice.details.invoiceTo")}),s?.invoiceTo.name,e.jsx("br",{}),s?.invoiceTo.company&&e.jsxs(e.Fragment,{children:[s.invoiceTo.company,e.jsx("br",{})]}),s?.invoiceTo.companyNumber&&e.jsxs(e.Fragment,{children:[a("dashboard.invoice.details.companyNumber"),": ",s.invoiceTo.companyNumber,e.jsx("br",{})]}),s?.invoiceTo.fullAddress,s?.invoiceTo.city&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),s.invoiceTo.city,s.invoiceTo.zip_code&&`, ${s.invoiceTo.zip_code}`]}),s?.invoiceTo.country&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),s.invoiceTo.country]}),e.jsx("br",{}),a("dashboard.invoice.details.phone"),": ",s?.invoiceTo.phoneNumber,e.jsx("br",{})]}),e.jsxs(g,{sx:{typography:"body2"},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1},children:a("dashboard.invoice.details.dateCreate")}),S(s?.createDate)]}),s?.status!=="paid"&&e.jsxs(g,{sx:{typography:"body2"},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1},children:a("dashboard.invoice.details.dueDate")}),S(s?.dueDate)]})]}),I(),e.jsx(N,{sx:{borderStyle:"dashed"}}),e.jsx(ae,{taxes:s?.taxes,subtotal:s?.subtotal,totalAmount:s?.totalAmount}),e.jsx(N,{sx:{mt:5,borderStyle:"dashed"}}),T()]})]})}function ce({invoice:s}){const{t:a}=C("navbar");return e.jsxs(X,{children:[e.jsx(K,{className:"invoice-breadcrumbs",heading:s?.invoiceNumber,backHref:k.dashboard.invoice.root,links:[{name:"Dashboard",href:k.dashboard.root},{name:a("dashboard.invoice.heading"),href:k.dashboard.invoice.root},{name:s?.invoiceNumber}],sx:{mb:3}}),e.jsx(de,{invoice:s})]})}const me={title:`Invoice details | Dashboard - ${w.appName}`};function qe(){const{id:s=""}=Y(),[a,l]=h.useState(null),[b,x]=h.useState(!0);return h.useEffect(()=>{(async()=>{if(!s){x(!1);return}try{x(!0);const c=await ee(s);l(c)}catch(c){console.error("Error loading invoice:",c),m.error(c?.message||"Failed to load invoice"),l(null)}finally{x(!1)}})()},[s]),b?e.jsx(Z,{}):e.jsxs(e.Fragment,{children:[e.jsx("title",{children:me.title}),e.jsx(ce,{invoice:a||void 0})]})}export{qe as default};
