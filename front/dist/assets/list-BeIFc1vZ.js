import{w as I,u as G,r as j,cG as H,b4 as S,cH as $,j as e,L as N,y as g,al as P,B as u,b as E,I as m,bI as V,bP as F,bQ as Q,T as U,a7 as D,bJ as q,bK as J,M as v,p as b,bR as K,V as _,a0 as k,W as X,aa as Y,c as Z,J as ee,K as se,x as te}from"./index-BJkBHIXD.js";import{d as T,e as re}from"./news-D7oUkqF0.js";import{m as oe,p as ae}from"./index-BdvNLWsN.js";import{S as ne}from"./search-not-found-BYtFGFNz.js";import{c as ie,A as le}from"./Autocomplete-vOabT0lM.js";import{T as de}from"./TextField-BfOXJaKd.js";import{I as ce}from"./InputAdornment-Cyf39fZQ.js";import{a as he}from"./news-skeleton-DEOoMfBF.js";import{a as pe}from"./format-number-BErDzwe7.js";import{I as ue}from"./image-V8EDN90f.js";import{C as xe}from"./Card-CU8jzKuK.js";import{S as A}from"./Stack-DSqJGNfN.js";import{o as me}from"./orderBy-BP_idRMj.js";import"./text-transform-DM798QSo.js";import"./styles-B-zEs6qR.js";import"./html-to-markdown-DFGv9hum.js";import"./styles-CIBYb4dP.js";import"./empty-content-Cck_Y1yy.js";import"./Select-CM-FquqI.js";import"./Chip-Cd7PxQUv.js";import"./Skeleton-CyTM2RGr.js";function fe({redirectPath:t,sx:r}){const{t:h}=I("navbar"),n=G(),[l,x]=j.useState(""),[i,d]=j.useState(null),a=H(l),{news:f,loading:p}=T(),y=f.filter(s=>s.title.toLowerCase().includes(a.toLowerCase())||s.description.toLowerCase().includes(a.toLowerCase())),w=j.useCallback(s=>{d(s),s&&n.push(t(s.id))},[t,n]),C=ie({matchFrom:"any",stringify:s=>`${s.title} ${s.description}`}),o={width:275,[`& .${S.listbox}`]:{[`& .${S.option}`]:{p:0,[`& .${$.root}`]:{p:.75,gap:1.5,width:1,display:"flex",alignItems:"center"}}}};return e.jsx(le,{autoHighlight:!0,popupIcon:null,loading:p,options:y,value:i,filterOptions:C,onChange:(s,c)=>w(c),onInputChange:(s,c)=>x(c),getOptionLabel:s=>s.title,noOptionsText:e.jsx(ne,{query:a}),isOptionEqualToValue:(s,c)=>s.id===c.id,slotProps:{paper:{sx:o}},sx:[{width:{xs:1,sm:260}},...Array.isArray(r)?r:[r]],renderInput:s=>e.jsx(de,{...s,placeholder:h("dashboard.news.search.placeholder"),slotProps:{input:{...s.InputProps,startAdornment:e.jsx(ce,{position:"start",children:e.jsx(m,{icon:"eva:search-fill",sx:{ml:1,color:"text.disabled"}})}),endAdornment:e.jsxs(e.Fragment,{children:[p?e.jsx(E,{size:18,color:"inherit",sx:{mr:-3}}):null,s.InputProps.endAdornment]})}}}),renderOption:(s,c,B)=>{const{key:O,...z}=s,W=oe(c.title,B.inputValue,{insideWords:!0}),M=ae(c.title,W);return e.jsx("li",{...z,children:e.jsxs(N,{component:g,href:t(c.id),color:"inherit",underline:"none",children:[e.jsx(P,{alt:c.title,src:c.coverUrl,variant:"rounded",sx:{width:24,height:24,flexShrink:0,borderRadius:1}}),e.jsx("div",{children:M.map((L,R)=>e.jsx(u,{component:"span",sx:{typography:"body2",fontWeight:"fontWeightMedium",...L.highlight&&{color:"primary.main",fontWeight:"fontWeightSemiBold"}},children:L.text},R))})]})},O)}})}function be({sx:t,news:r,editHref:h,detailsHref:n,onDelete:l,canManage:x=!0,...i}){const{t:d}=I("navbar"),a=V(),f=()=>x?e.jsx(q,{open:a.open,anchorEl:a.anchorEl,onClose:a.onClose,slotProps:{arrow:{placement:"bottom-center"}},children:e.jsxs(J,{children:[e.jsx("li",{children:e.jsxs(v,{component:g,href:n,onClick:()=>a.onClose(),children:[e.jsx(m,{icon:"solar:eye-bold"}),d("dashboard.news.menu.view")]})}),e.jsx("li",{children:e.jsxs(v,{component:g,href:h,onClick:()=>a.onClose(),children:[e.jsx(m,{icon:"solar:pen-bold"}),d("dashboard.news.menu.edit")]})}),e.jsxs(v,{onClick:()=>{a.onClose(),l?.()},sx:{color:"error.main"},children:[e.jsx(m,{icon:"solar:trash-bin-trash-bold"}),d("dashboard.news.menu.delete")]})]})}):null;return e.jsxs(e.Fragment,{children:[e.jsxs(xe,{sx:[{display:"flex"},...Array.isArray(t)?t:[t]],...i,children:[e.jsxs(A,{spacing:1,sx:[p=>({flexGrow:1,p:p.spacing(3,3,2,3)})],children:[e.jsxs(u,{sx:{mb:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(F,{variant:"soft",color:r.publish==="published"&&"info"||"default",children:r.publish==="published"?d("dashboard.news.status.published"):r.publish==="draft"?d("dashboard.news.status.draft"):r.publish}),e.jsx(u,{component:"span",sx:{typography:"caption",color:"text.disabled"},children:Q(r.createdAt)})]}),e.jsxs(A,{spacing:1,sx:{flexGrow:1},children:[e.jsx(N,{component:g,href:n,color:"inherit",variant:"subtitle2",sx:[p=>({...p.mixins.maxLine({line:2})})],children:r.title}),e.jsx(U,{variant:"body2",sx:[p=>({...p.mixins.maxLine({line:2}),color:"text.secondary"})],children:r.description})]}),e.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[x&&e.jsx(D,{color:a.open?"inherit":"default",onClick:a.onOpen,children:e.jsx(m,{icon:"eva:more-horizontal-fill"})}),e.jsx(u,{sx:{gap:1.5,flexGrow:1,display:"flex",flexWrap:"wrap",typography:"caption",color:"text.disabled",justifyContent:"flex-end"},children:e.jsxs(u,{sx:{gap:.5,display:"flex",alignItems:"center"},children:[e.jsx(m,{icon:"solar:eye-bold",width:16}),pe(r.totalViews)]})})]})]}),e.jsxs(u,{sx:{p:1,width:180,height:240,flexShrink:0,position:"relative",display:{xs:"none",sm:"block"}},children:[e.jsx(P,{alt:r.author.name,src:r.author.avatarUrl,sx:{top:16,right:16,zIndex:9,position:"absolute"}}),e.jsx(ue,{alt:r.title,src:r.coverUrl,sx:{height:1,borderRadius:1.5}})]})]}),f()]})}function je({news:t,loading:r,onDelete:h,canManage:n}){const l=()=>e.jsx(he,{variant:"horizontal"}),x=()=>t.map(i=>{const d=n?n(i):!0;return e.jsx(be,{news:i,detailsHref:b.dashboard.news.details(i.id),editHref:b.dashboard.news.edit(i.id),onDelete:d&&h?()=>h(i.id):void 0,canManage:d},i.id)});return e.jsx(u,{sx:{gap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"}},children:r?l():x()})}const ge=["all","published","draft"];function ye(){const{t}=I("navbar"),{state:r,setState:h}=K({publish:"all"}),{user:n}=_(),{news:l,loading:x,refetch:i}=T(),d=we({inputData:l,filters:r,sortBy:"latest"}),a=(n?.role??"").toLowerCase(),f=a==="admin",p=j.useCallback(o=>n?a==="admin":!1,[n,a]),y=j.useCallback(async o=>{try{await re(o),k.success(t("dashboard.news.toast.deletedSuccessfully")),i()}catch(s){console.error("Failed to delete news:",s),k.error(t("dashboard.news.toast.deleteFailed"))}},[i,t]),w=j.useCallback((o,s)=>{h({publish:s})},[h]),C=o=>o==="all"?t("dashboard.news.tabs.all"):o==="published"?t("dashboard.news.tabs.published"):o==="draft"?t("dashboard.news.tabs.draft"):o;return e.jsxs(X,{children:[e.jsx(Y,{heading:t("dashboard.news.list"),links:[{name:"Dashboard",href:b.dashboard.root},{name:t("dashboard.news.heading"),href:b.dashboard.news.root},{name:t("dashboard.news.list")}],action:f?e.jsx(Z,{component:g,href:b.dashboard.news.new,variant:"contained",startIcon:e.jsx(m,{icon:"mingcute:add-line"}),children:t("dashboard.news.addNews")}):void 0,sx:{mb:{xs:3,md:5}}}),e.jsx(u,{sx:{mb:{xs:3,md:5}},children:e.jsx(fe,{redirectPath:o=>b.dashboard.news.details(o),sx:{width:"100%",maxWidth:{xs:"100%",sm:400}}})}),a==="admin"&&e.jsx(ee,{value:r.publish,onChange:w,sx:{mb:{xs:3,md:5}},children:ge.map(o=>e.jsx(se,{iconPosition:"end",value:o,label:C(o),icon:e.jsxs(F,{variant:(o==="all"||o===r.publish)&&"filled"||"soft",color:o==="published"&&"info"||"default",children:[o==="all"&&l.length,o==="published"&&l.filter(s=>s.publish==="published").length,o==="draft"&&l.filter(s=>s.publish==="draft").length]}),sx:{textTransform:"capitalize"}},o))}),e.jsx(je,{news:d,loading:x,onDelete:f?y:void 0,canManage:p})]})}function we({inputData:t,filters:r,sortBy:h}){const{publish:n}=r;return t=me(t,["createdAt"],["desc"]),n!=="all"&&(t=t.filter(l=>l.publish===n)),t}const Ce={title:`News list | Dashboard - ${te.appName}`};function Qe(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:Ce.title}),e.jsx(ye,{})]})}export{Qe as default};
