import{w as W,bI as Y,a4 as G,j as e,ah as L,T as F,I as d,bP as Z,bQ as ee,a7 as N,bJ as ae,bK as se,M as D,c as y,B as M,u as re,V as te,bR as oe,r as b,a0 as p,p as P,cB as ne,i as le,s as ie,b as ce,ab as de,W as he,aa as me,y as ge}from"./index-BJkBHIXD.js";import{b as ue,d as O,C as xe}from"./case-manager-table-toolbar-CUGtPtg9.js";import{C as U}from"./confirm-dialog-D488U7AY.js";import{u as be,g as pe,r as je,e as fe,T as Ce}from"./table-no-data-BKo9R2Zy.js";import{T as we}from"./table-empty-rows-BDBaI17h.js";import{T as Me}from"./table-head-custom-C2dATJUG.js";import{T as ye}from"./table-selected-action-uAaUSqFj.js";import{T as Te}from"./table-pagination-custom-Dom7EZhX.js";import{T as Re,a as m,b as ve,c as Pe}from"./TableHead-D9jAElFw.js";import{C as Ae}from"./FormControlLabel-Do9AncA_.js";import{S as v}from"./Stack-DSqJGNfN.js";import{C as I}from"./Chip-Cd7PxQUv.js";import{C as _}from"./Card-CU8jzKuK.js";import{T as ke}from"./TableContainer-D0zNvGRU.js";import"./text-transform-DM798QSo.js";import"./styles-B-zEs6qR.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./InputAdornment-Cyf39fZQ.js";import"./empty-content-Cck_Y1yy.js";import"./LastPage-CrCg5Ljk.js";import"./format-number-BErDzwe7.js";function Se({row:a,selected:i,onSelectRow:x,onEditRow:g,onAccessAccount:h,onDeleteRow:u,canAccessAccount:s=!0}){const{t:r}=W("navbar"),n=Y(),o=G(),j=f=>{switch(f){case"active":return"success";case"inactive":return"warning";case"suspended":return"error";default:return"default"}},A=f=>r(`dashboard.caseManager.statusOptions.${f}`),k=()=>e.jsx(ae,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(se,{children:[e.jsx("li",{children:e.jsxs(D,{onClick:()=>{g(),n.onClose()},children:[e.jsx(d,{icon:"solar:pen-bold"}),r("dashboard.caseManager.edit")]})}),s&&e.jsx("li",{children:e.jsxs(D,{onClick:()=>{h(),n.onClose()},children:[e.jsx(d,{icon:"solar:user-id-bold"}),r("dashboard.caseManager.accessAccount")]})}),e.jsxs(D,{onClick:()=>{o.onTrue(),n.onClose()},sx:{color:"error.main"},children:[e.jsx(d,{icon:"solar:trash-bin-trash-bold"}),r("dashboard.caseManager.delete")]})]})}),S=()=>e.jsx(U,{open:o.value,onClose:o.onFalse,title:r("dashboard.caseManager.deleteConfirmTitle"),content:r("dashboard.caseManager.deleteConfirmMessage"),action:e.jsx(y,{variant:"contained",color:"error",onClick:u,children:r("dashboard.caseManager.delete")})});return e.jsxs(e.Fragment,{children:[e.jsxs(Re,{hover:!0,selected:i,children:[e.jsx(m,{padding:"checkbox",children:e.jsx(Ae,{checked:i,onChange:x})}),e.jsx(m,{sx:{maxWidth:180},children:e.jsx(L,{title:a.name||"",arrow:!0,children:e.jsx(F,{variant:"body2",noWrap:!0,sx:{maxWidth:160},children:a.name})})}),e.jsx(m,{sx:{maxWidth:200},children:e.jsx(L,{title:a.email||"",arrow:!0,children:e.jsx(F,{variant:"body2",noWrap:!0,sx:{maxWidth:180},children:a.email})})}),e.jsx(m,{sx:{maxWidth:150},children:e.jsx(F,{variant:"body2",noWrap:!0,sx:{maxWidth:130},children:a.phone})}),e.jsx(m,{children:e.jsx(d,{icon:a.isVerified?"solar:check-circle-bold":"solar:close-circle-bold",sx:{color:a.isVerified?"success.main":"error.main",fontSize:20}})}),e.jsx(m,{children:e.jsx(d,{icon:a.isActive?"solar:check-circle-bold":"solar:close-circle-bold",sx:{color:a.isActive?"success.main":"error.main",fontSize:20}})}),e.jsx(m,{children:e.jsx(Z,{variant:"soft",color:j(a.status),children:A(a.status)})}),e.jsx(m,{children:ee(a.createdAt)}),e.jsx(m,{align:"right",children:e.jsx(N,{onClick:n.onOpen,sx:{position:"static"},children:e.jsx(d,{icon:"eva:more-vertical-fill"})})})]}),k(),S()]})}function Fe({filters:a,onFilters:i,onResetFilter:x,results:g}){const h=()=>{i("status","all")},u=()=>{i("name","")},s=()=>{i("email","")};return e.jsxs(v,{spacing:1.5,sx:{p:3},children:[e.jsxs(v,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[e.jsxs(v,{spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[!!a.name&&e.jsx(I,{size:"small",label:a.name,onDelete:u,sx:{height:24}}),!!a.email&&e.jsx(I,{size:"small",label:a.email,onDelete:s,sx:{height:24}}),a.status!=="all"&&e.jsx(I,{size:"small",label:a.status,onDelete:h,sx:{height:24}})]}),e.jsx(y,{color:"error",onClick:x,startIcon:e.jsx(d,{icon:"solar:trash-bin-trash-bold"}),children:"Clear"})]}),e.jsxs(v,{spacing:.5,direction:"row",alignItems:"center",sx:{typography:"body2"},children:[e.jsx(d,{icon:"solar:info-circle-bold",sx:{width:16,height:16,color:"text.disabled"}}),e.jsxs(M,{component:"span",sx:{color:"text.disabled"},children:[g," results found"]})]})]})}function De(){const{t:a}=W("navbar"),i=re(),{user:x}=te(),h=(x?.role||"").toLowerCase()!=="company",u=[{id:"name",label:a("dashboard.caseManager.tableHeaders.name"),width:180},{id:"email",label:a("dashboard.caseManager.tableHeaders.email"),width:200},{id:"phone",label:a("dashboard.caseManager.tableHeaders.phone"),width:150},{id:"isVerified",label:a("dashboard.caseManager.tableHeaders.verified"),width:100},{id:"isActive",label:a("dashboard.caseManager.tableHeaders.active"),width:100},{id:"status",label:a("dashboard.caseManager.tableHeaders.status"),width:120},{id:"createdAt",label:a("dashboard.caseManager.tableHeaders.created"),width:140},{id:"",width:88}],s=be({defaultOrderBy:"createdAt",defaultOrder:"desc"}),r=G(),n=oe({name:"",email:"",status:"all"}),{state:o,setState:j}=n,A=b.useMemo(()=>({search:o.name||o.email,status:o.status!=="all"?o.status:void 0,per_page:100}),[o.name,o.email,o.status]),{caseManagers:k,loading:S,error:f,refetch:C}=ue(A),l=Ie({inputData:k,comparator:pe(s.order,s.orderBy),filters:o}),T=je(l,s.page,s.rowsPerPage),B=!!o.name||!!o.email||o.status!=="all",J=!l.length&&B||!l.length,K=b.useCallback(async t=>{try{await O(t),p.success(a("dashboard.caseManager.caseManagerDeleted")),C(),s.onUpdatePageDeleteRow(T.length)}catch(c){console.error("Failed to delete case manager:",c),p.error(a("dashboard.caseManager.failedToDelete"))}},[T.length,s,C,a]),Q=b.useCallback(async()=>{try{await Promise.all(s.selected.map(t=>O(t))),p.success(a("dashboard.caseManager.caseManagersDeleted")),C(),s.onUpdatePageDeleteRows(T.length,l.length)}catch(t){console.error("Failed to delete case managers:",t),p.error(a("dashboard.caseManager.failedToDeletePlural"))}},[l.length,T.length,s,C,a]),E=b.useCallback((t,c)=>{s.onResetPage(),j({[t]:c})},[j,s]),H=b.useCallback(()=>{j({name:"",email:"",status:"all"})},[j]),$=b.useCallback(t=>{i.push(P.dashboard.caseManager.edit(t))},[i]),q=b.useCallback(async t=>{try{await ne(t),p.success(a("dashboard.caseManager.successfullyLoggedIn"));const c=P.dashboard.overview.analytics;await new Promise(w=>setTimeout(w,800)),await le();let z=!1;for(let w=0;w<3;w++)try{const R=await ie.get("/api/v1/auth/me");if(R?.data?.user??R?.data){z=!0;break}}catch(R){w<2?await new Promise(V=>setTimeout(V,500)):console.error("Session verification failed after retries:",R)}if(!z){p.error("Session verification failed. Please try again.");return}sessionStorage.setItem("just_impersonated","true"),window.location.href=c}catch(c){console.error("Failed to access account:",c),p.error(a("dashboard.caseManager.failedToAccessAccount"))}},[a]);if(S)return e.jsx(M,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(ce,{})});if(f)return e.jsxs(_,{sx:{p:3,textAlign:"center"},children:[e.jsx(M,{sx:{color:"error.main",mb:2},children:e.jsx(d,{icon:"solar:danger-bold",width:48})}),e.jsx(M,{sx:{typography:"h6",mb:1},children:a("dashboard.caseManager.errorLoading")}),e.jsx(M,{sx:{typography:"body2",color:"text.secondary",mb:2},children:f}),e.jsx(y,{variant:"contained",onClick:C,children:a("dashboard.caseManager.retry")})]});const X=()=>e.jsx(U,{open:r.value,onClose:r.onFalse,title:a("dashboard.caseManager.deleteConfirmTitle"),content:e.jsxs(e.Fragment,{children:[a("dashboard.caseManager.deleteConfirmMessagePlural")," ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," ",a("dashboard.caseManager.items"),"?"]}),action:e.jsx(y,{variant:"contained",color:"error",onClick:()=>{Q(),r.onFalse()},children:a("dashboard.caseManager.delete")})});return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(xe,{filters:o,onFilters:E,onResetFilter:H}),B&&e.jsx(Fe,{filters:o,onFilters:E,onResetFilter:H,results:l.length}),e.jsxs(ke,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(ye,{dense:s.dense,numSelected:s.selected.length,rowCount:l.length,onSelectAllRows:t=>s.onSelectAllRows(t,l.map(c=>c.id)),action:e.jsx(L,{title:a("dashboard.caseManager.delete"),children:e.jsx(N,{color:"primary",onClick:r.onTrue,children:e.jsx(d,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(de,{children:e.jsxs(ve,{size:s.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(Me,{order:s.order,orderBy:s.orderBy,headCells:u,rowCount:l.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:t=>s.onSelectAllRows(t,l.map(c=>c.id))}),e.jsxs(Pe,{children:[l.map(t=>e.jsx(Se,{row:t,selected:s.selected.includes(t.id),onSelectRow:()=>s.onSelectRow(t.id),onEditRow:()=>$(t.id),canAccessAccount:h,onAccessAccount:()=>q(t.id),onDeleteRow:()=>K(t.id)},t.id)),e.jsx(we,{height:s.dense?56:76,emptyRows:fe(s.page,s.rowsPerPage,l.length)}),e.jsx(Ce,{notFound:J})]})]})})]}),e.jsx(Te,{page:s.page,dense:s.dense,count:l.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]}),X()]})}function Ie({inputData:a,comparator:i,filters:x}){const{name:g,email:h,status:u}=x,s=a.map((r,n)=>[r,n]);return s.sort((r,n)=>{const o=i(r[0],n[0]);return o!==0?o:r[1]-n[1]}),a=s.map(r=>r[0]),g&&typeof g=="string"&&(a=a.filter(r=>r.name?.toLowerCase().includes(g.toLowerCase()))),h&&typeof h=="string"&&(a=a.filter(r=>r.email?.toLowerCase().includes(h.toLowerCase()))),u!=="all"&&(a=a.filter(r=>r.status===u)),a}function Le(){const{t:a}=W("navbar");return e.jsxs(he,{children:[e.jsx(me,{heading:a("dashboard.caseManager.heading"),links:[{name:"Dashboard",href:P.dashboard.root},{name:a("dashboard.caseManager.caseManagers")}],action:e.jsx(y,{component:ge,href:P.dashboard.caseManager.new,variant:"contained",startIcon:e.jsx(d,{icon:"mingcute:add-line"}),children:a("dashboard.caseManager.addCaseManager")}),sx:{mb:{xs:3,md:5}}}),e.jsx(De,{})]})}function ra(){return e.jsx(Le,{})}export{ra as default};
