import{r as d,i as G,s as M,e as S,w as Y,j as e,B as m,I as j,ah as de,T as w,a7 as J,bJ as ce,M as E,a0 as R,X as qe,Y as Ce,Z as Te,c as Q,df as A,_ as we,bI as ke,bK as Re,a4 as U,bR as Se,aa as K,p as B,b as De,ab as Fe,W as Ie}from"./index-BJkBHIXD.js";import{C as ae}from"./confirm-dialog-D488U7AY.js";import{u as Qe,g as Ee,T as Oe}from"./table-no-data-BKo9R2Zy.js";import{T as We}from"./table-head-custom-C2dATJUG.js";import{T as Ae}from"./table-selected-action-uAaUSqFj.js";import{T as Be,a as P,b as Ne,c as Le}from"./TableHead-D9jAElFw.js";import{C as _e,F as ne}from"./FormControlLabel-Do9AncA_.js";import{C as V}from"./Chip-Cd7PxQUv.js";import{a as Pe}from"./zod-DbnPk1Kl.js";import{a as Me,F as $e}from"./index.esm-DG78EUPk.js";import"./text-transform-DM798QSo.js";import{R as He}from"./rhf-text-field-D45rQogC.js";import{R as ze}from"./rhf-select-BCHEEYe2.js";import"./styles-B-zEs6qR.js";import{S as N}from"./Stack-DSqJGNfN.js";import{a as Ue,R as te}from"./RadioGroup-eX8WPtuC.js";import{T as X,I as Ve}from"./TextField-BfOXJaKd.js";import{o as Ge,s as oe,b as Ye}from"./schemas-BaSQ7w8v.js";import{I as Ke}from"./InputAdornment-Cyf39fZQ.js";import{F as Xe,S as Je}from"./Select-CM-FquqI.js";import{C as re}from"./Card-CU8jzKuK.js";async function Ze(){return(await M.get(S.questions.list)).data}async function es(s){await G();const n={name:s.name,is_required:s.isRequired,input_type:s.inputType,options:s.options};return(await M.post(S.questions.create,n)).data}async function ss(s,n){const x=typeof S.questions.update=="function"?S.questions.update(s):S.questions.update;await G();const t={};return n.name!==void 0&&(t.name=n.name),n.isRequired!==void 0&&(t.is_required=n.isRequired),n.inputType!==void 0&&(t.input_type=n.inputType),n.options!==void 0&&(t.options=n.options),(await M.put(x,t)).data}async function ie(s){const n=typeof S.questions.delete=="function"?S.questions.delete(s):S.questions.delete;await G(),await M.delete(n)}async function as(s){await G(),await M.post(S.questions.reorder,{questions:s})}function ns(){const[s,n]=d.useState([]),[x,t]=d.useState(!0),[a,c]=d.useState(null),o=d.useCallback(async()=>{try{t(!0),c(null);const b=(await Ze()).map(u=>({id:u.id.toString(),name:u.name,isRequired:u.is_required,inputType:u.input_type,options:u.options,order:u.order,createdAt:u.created_at,updatedAt:u.updated_at}));b.sort((u,p)=>u.order-p.order),n(b)}catch(l){console.error("Failed to fetch questions:",l),c(l instanceof Error?l.message:"Failed to fetch questions"),n([])}finally{t(!1)}},[]);return d.useEffect(()=>{o()},[o]),{questions:s,loading:x,error:a,refetch:o}}const ue=[{value:"text",label:"Text"},{value:"select",label:"Select"},{value:"password",label:"Password"},{value:"email",label:"Email"},{value:"url",label:"URL"},{value:"tel",label:"Telephone"},{value:"search",label:"Search"},{value:"number",label:"Number"},{value:"range",label:"Range"},{value:"date",label:"Date"},{value:"datetime-local",label:"Date Time Local"},{value:"month",label:"Month"},{value:"week",label:"Week"},{value:"time",label:"Time"},{value:"checkbox",label:"Checkbox"},{value:"radio",label:"Radio"},{value:"file",label:"File"},{value:"color",label:"Color"}];function ts({row:s,selected:n,onSelectRow:x,onDeleteRow:t,onEditRow:a,onDragStart:c,onDragOverRow:o,onDragEnd:l,dragging:b}){const{t:u}=Y("navbar"),[p,k]=d.useState(null),D=d.useCallback(h=>{k(h.currentTarget)},[]),v=d.useCallback(()=>{k(null)},[]),C=h=>u(`dashboard.question.inputTypes.${h}`)||h,F=h=>e.jsx(V,{label:u(h?"dashboard.question.required":"dashboard.question.optional"),color:h?"error":"default",size:"small"});return e.jsxs(e.Fragment,{children:[e.jsxs(Be,{hover:!0,selected:n,onDragOver:h=>{h.preventDefault()},onDragEnter:()=>{o?.(s.id)},onDrop:()=>{l?.()},sx:{opacity:b?.6:1},children:[e.jsx(P,{padding:"checkbox",children:e.jsx(_e,{checked:n,onChange:h=>x(h.target.checked)})}),e.jsx(P,{sx:{maxWidth:300},children:e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(m,{draggable:!0,onDragStart:h=>{h.dataTransfer?.setData&&h.dataTransfer.setData("text/plain",s.id),c?.(s.id)},onDragEnd:()=>{l?.()},sx:{cursor:"grab",display:"inline-flex",flexShrink:0},children:e.jsx(j,{icon:"custom:drag-dots-fill",width:18,sx:{color:"text.disabled",mr:1}})}),e.jsx(m,{sx:{ml:2,minWidth:0,overflow:"hidden"},children:e.jsx(de,{title:s.name,arrow:!0,children:e.jsx(w,{variant:"subtitle2",noWrap:!0,sx:{maxWidth:250},children:s.name})})})]})}),e.jsx(P,{children:F(s.isRequired)}),e.jsx(P,{children:e.jsx(V,{label:C(s.inputType),variant:"outlined",size:"small"})}),e.jsx(P,{align:"right",children:e.jsx(J,{color:p?"inherit":"default",onClick:D,children:e.jsx(j,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(ce,{open:!!p,anchorEl:p,onClose:v,slotProps:{paper:{sx:{minWidth:200,maxWidth:300}}},children:e.jsxs(m,{sx:{py:1},children:[e.jsxs(E,{onClick:()=>{a(),v()},sx:{whiteSpace:"normal",wordBreak:"break-word"},children:[e.jsx(j,{icon:"solar:pen-bold",sx:{mr:1,flexShrink:0}}),e.jsx(w,{variant:"body2",sx:{flex:1},children:u("dashboard.question.editQuestion")})]}),e.jsxs(E,{onClick:()=>{t(),v()},sx:{color:"error.main",whiteSpace:"normal",wordBreak:"break-word"},children:[e.jsx(j,{icon:"solar:trash-bin-trash-bold",sx:{mr:1,flexShrink:0}}),e.jsx(w,{variant:"body2",sx:{flex:1},children:u("dashboard.question.delete")})]})]})})]})}function le({open:s,onClose:n,onSave:x,question:t}){const{t:a}=Y("navbar"),c=Ge({name:oe().min(1,a("dashboard.question.nameRequired")),isRequired:Ye(),inputType:oe().min(1,a("dashboard.question.inputTypeRequired"))}),[o,l]=d.useState([]),[b,u]=d.useState(""),p=d.useMemo(()=>({name:t?.name||"",isRequired:t?.isRequired||!1,inputType:t?.inputType||"text"}),[t]),k=Me({resolver:Pe(c),defaultValues:p}),{handleSubmit:D,watch:v,reset:C,setValue:F}=k,h=v("inputType");d.useEffect(()=>{t?(C({name:t.name,isRequired:t.isRequired,inputType:t.inputType}),l(t.options||[])):(C(p),l([]))},[t,C,p]);const $=D(async i=>{try{const f={name:i.name,isRequired:i.isRequired,inputType:i.inputType,options:o.length>0?o:void 0};t?(await ss(t.id,f),R.success(a("dashboard.question.questionUpdated"))):(await es(f),R.success(a("dashboard.question.questionCreated"))),x(f),g()}catch(f){console.error("Form submission error:",f),R.error(a("dashboard.question.failedToSave"))}}),g=()=>{C(),l([]),u(""),n()},O=()=>{b.trim()&&(l(i=>[...i,b.trim()]),u(""))},H=i=>{l(f=>f.filter((z,W)=>W!==i))},T=i=>{F("inputType",i),["select","checkbox","radio"].includes(i)||l([])},L=["select","checkbox","radio"].includes(h);return e.jsxs(qe,{open:s,onClose:g,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{maxHeight:"90vh"}},children:[e.jsx(Ce,{children:a(t?"dashboard.question.editQuestion":"dashboard.question.newQuestion")}),e.jsx($e,{...k,children:e.jsxs(m,{component:"form",onSubmit:$,children:[e.jsx(Te,{sx:{pt:3},children:e.jsxs(N,{spacing:3,children:[e.jsx(He,{name:"name",label:a("dashboard.question.questionName"),placeholder:a("dashboard.question.questionNamePlaceholder"),fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsxs(m,{children:[e.jsx(w,{variant:"subtitle2",sx:{mb:1},children:a("dashboard.question.isRequired")}),e.jsxs(Ue,{row:!0,value:v("isRequired"),onChange:i=>F("isRequired",i.target.value==="true"),children:[e.jsx(ne,{value:!0,control:e.jsx(te,{}),label:a("dashboard.question.yes")}),e.jsx(ne,{value:!1,control:e.jsx(te,{}),label:a("dashboard.question.no")})]})]}),e.jsx(ze,{name:"inputType",label:a("dashboard.question.inputType"),placeholder:a("dashboard.question.inputTypePlaceholder"),onChange:i=>T(i.target.value),children:ue.map(i=>e.jsx(E,{value:i.value,children:a(`dashboard.question.inputTypes.${i.value}`)},i.value))}),L&&e.jsxs(m,{children:[e.jsx(w,{variant:"subtitle2",sx:{mb:2},children:a("dashboard.question.options")}),e.jsxs(N,{spacing:2,children:[o.map((i,f)=>e.jsxs(N,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(X,{fullWidth:!0,value:i,onChange:z=>{const W=[...o];W[f]=z.target.value,l(W)},placeholder:`${a("dashboard.question.option")} ${f+1}`}),e.jsx(J,{color:"error",onClick:()=>H(f),children:e.jsx(j,{icon:"solar:trash-bin-trash-bold"})})]},f)),e.jsxs(N,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(X,{value:b,onChange:i=>u(i.target.value),placeholder:a("dashboard.question.addNewOption"),onKeyPress:i=>{i.key==="Enter"&&(i.preventDefault(),O())},sx:{flex:"0 1 auto",maxWidth:"60%"}}),e.jsx(Q,{variant:"contained",onClick:O,disabled:!b.trim(),sx:{whiteSpace:"nowrap",paddingX:3,paddingY:1.5,flex:"0 0 auto",minWidth:"140px"},children:a("dashboard.question.addOption")})]})]})]}),h==="text"&&e.jsx(m,{sx:{p:2,bgcolor:i=>A(i.palette.primary.main,.08),borderRadius:1,border:i=>`1px solid ${A(i.palette.primary.main,.2)}`},children:e.jsxs(w,{variant:"caption",color:"primary",children:[e.jsx("strong",{children:a("dashboard.question.preview.preview")})," ",a("dashboard.question.preview.textInput",{name:v("name")})]})}),["password","email","url","tel","search","number","range","date","datetime-local","month","week","time","file","color"].includes(h)&&e.jsx(m,{sx:{p:2,bgcolor:i=>A(i.palette.primary.main,.08),borderRadius:1,border:i=>`1px solid ${A(i.palette.primary.main,.2)}`},children:e.jsxs(w,{variant:"caption",color:"primary",children:[e.jsx("strong",{children:a("dashboard.question.preview.preview")})," ",a("dashboard.question.preview.input",{name:v("name"),type:h})]})}),L&&o.length>0&&e.jsx(m,{sx:{p:2,bgcolor:i=>A(i.palette.success.main,.08),borderRadius:1,border:i=>`1px solid ${A(i.palette.success.main,.2)}`},children:e.jsxs(w,{variant:"caption",color:"success.main",children:[e.jsx("strong",{children:a("dashboard.question.preview.preview")})," ",a("dashboard.question.preview.inputWithOptions",{type:a(`dashboard.question.inputTypes.${h}`),count:o.length,options:o.join(", ")})]})})]})}),e.jsxs(we,{children:[e.jsx(Q,{variant:"outlined",onClick:g,children:a("dashboard.question.cancel")}),e.jsx(Q,{type:"submit",variant:"contained",children:a(t?"dashboard.question.updateQuestion":"dashboard.question.createQuestion")})]})]})})]})}function os({filters:s,inputTypeOptions:n,onResetPage:x}){const{t}=Y("navbar"),a=ke(),{state:c,setState:o}=s,l=d.useCallback(p=>{x(),o({name:p.target.value})},[x,o]),b=d.useCallback(p=>{x(),o({inputType:p.target.value})},[x,o]),u=()=>e.jsx(ce,{open:a.open,onClose:a.onClose,sx:{width:160},children:e.jsxs(Re,{children:[e.jsxs(E,{onClick:()=>{a.onClose()},children:[e.jsx(j,{icon:"solar:printer-minimalistic-bold"}),t("dashboard.question.print")]}),e.jsxs(E,{onClick:()=>{a.onClose()},children:[e.jsx(j,{icon:"solar:import-bold"}),t("dashboard.question.import")]}),e.jsxs(E,{onClick:()=>{a.onClose()},children:[e.jsx(j,{icon:"solar:export-bold"}),t("dashboard.question.export")]})]})});return e.jsxs(m,{sx:{py:2.5,px:{xs:2.5,md:2},display:"flex",alignItems:"center",flexWrap:"wrap",gap:1},children:[e.jsx(X,{fullWidth:!0,value:c.name,onChange:l,placeholder:t("dashboard.question.searchQuestions"),InputProps:{startAdornment:e.jsx(Ke,{position:"start",children:e.jsx(j,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{maxWidth:{xs:1,md:300}}}),e.jsxs(Xe,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(Ve,{children:t("dashboard.question.inputType")}),e.jsx(Je,{value:c.inputType,onChange:b,label:t("dashboard.question.inputType"),children:n.map(p=>e.jsx(E,{value:p.value,children:t(`dashboard.question.inputTypes.${p.value}`)},p.value))})]}),e.jsx(m,{sx:{flexGrow:1}}),u()]})}function rs({filters:s,onResetPage:n,totalResults:x,sx:t}){const{state:a,setState:c}=s,o=d.useCallback(()=>{c({name:""}),n()},[n,c]),l=d.useCallback(()=>{c({inputType:""}),n()},[n,c]),b=d.useCallback(()=>{c({name:"",inputType:""}),n()},[n,c]);return e.jsxs(N,{spacing:1.5,sx:{p:3},children:[e.jsxs(m,{sx:{typography:"body2"},children:[e.jsx("strong",{children:x}),e.jsxs(m,{component:"span",sx:{typography:"body2",color:"text.secondary"},children:[" ","results found"]})]}),e.jsxs(N,{flexWrap:"wrap",direction:"row",spacing:1,children:[!!a.name&&e.jsx(V,{size:"small",label:"Name",onDelete:o,deleteIcon:e.jsx(j,{icon:"solar:close-circle-bold"})}),!!a.inputType&&e.jsx(V,{size:"small",label:"Input Type",onDelete:l,deleteIcon:e.jsx(j,{icon:"solar:close-circle-bold"})}),e.jsx(Q,{color:"error",onClick:b,startIcon:e.jsx(j,{icon:"solar:trash-bin-trash-bold"}),children:"Clear All"})]})]})}function is(){const{t:s}=Y("navbar"),n=Qe({defaultOrderBy:"order"}),x=[{id:"name",label:s("dashboard.question.tableHeaders.questionName"),width:300},{id:"isRequired",label:s("dashboard.question.tableHeaders.isRequired"),width:120},{id:"inputType",label:s("dashboard.question.tableHeaders.inputType"),width:120},{id:"",width:88}],t=U(),a=U(),c=U(),o=U(),[l,b]=d.useState(null),[u,p]=d.useState(null),[k,D]=d.useState(null),v=Se({name:"",inputType:""}),{state:C}=v,{questions:F,loading:h,error:$,refetch:g}=ns(),[O,H]=d.useState([]);d.useEffect(()=>{F&&H(F)},[F]);const T=ls({inputData:O,comparator:Ee(n.order,n.orderBy),filters:C}),L=!!C.name||!!C.inputType,i=!T.length&&L||!T.length,f=d.useCallback((r,y,I)=>{if(y===I)return r;const q=[...r],ee=q.findIndex(_=>_.id===y),se=q.findIndex(_=>_.id===I);if(ee===-1||se===-1)return r;const[ye]=q.splice(ee,1);return q.splice(se,0,ye),q.map((_,ve)=>({..._,order:ve+1}))},[]),z=d.useCallback(r=>{n.setOrderBy("order"),n.setOrder("asc"),b(r)},[n]),W=d.useCallback(r=>{!l||l===r||H(y=>f(y,l,r))},[l,f]),he=d.useCallback(async()=>{if(l)try{const r=O.map((y,I)=>({id:y.id,order:I+1}));await as(r),R.success(s("dashboard.question.questionsReordered")),g()}catch(r){console.error("Failed to save question order:",r),R.error(s("dashboard.question.failedToReorder")),g()}b(null)},[l,O,g,s]),pe=d.useCallback(r=>{D(r),a.onTrue()},[a]),me=d.useCallback(async()=>{if(k)try{await ie(k),R.success(s("dashboard.question.questionDeleted")),g(),a.onFalse(),D(null)}catch(r){console.error("Failed to delete question:",r),R.error(s("dashboard.question.failedToDelete")),a.onFalse(),D(null)}},[k,g,s,a]),xe=d.useCallback(async()=>{try{await Promise.all(n.selected.map(r=>ie(r))),R.success(s("dashboard.question.questionsDeleted")),n.onSelectAllRows(!1,[]),g()}catch(r){console.error("Failed to delete questions:",r),R.error(s("dashboard.question.failedToDeletePlural"))}},[n,g,s]),be=d.useCallback(r=>{p(r),o.onTrue()},[o]),fe=d.useCallback(()=>{p(null),c.onTrue()},[c]),Z=d.useCallback(()=>{o.onFalse(),c.onFalse(),p(null),g()},[o,c,g]),je=()=>{const r=s("dashboard.question.deleteConfirmMessage"),y=r.split(`

`).map((I,q)=>e.jsx(w,{sx:{mb:q<r.split(`

`).length-1?2:0},children:I},q));return e.jsx(ae,{open:t.value,onClose:t.onFalse,title:s("dashboard.question.deleteConfirmTitle"),content:e.jsx(m,{children:y}),action:e.jsx(Q,{variant:"contained",color:"error",onClick:()=>{xe(),t.onFalse()},children:s("dashboard.question.delete")})})},ge=()=>{const r=s("dashboard.question.deleteConfirmMessageSingle"),y=r.split(`

`).map((I,q)=>e.jsx(w,{sx:{mb:q<r.split(`

`).length-1?2:0},children:I},q));return e.jsx(ae,{open:a.value,onClose:()=>{a.onFalse(),D(null)},title:s("dashboard.question.deleteConfirmTitle"),content:e.jsx(m,{children:y}),action:e.jsx(Q,{variant:"contained",color:"error",onClick:me,children:s("dashboard.question.delete")})})};return h?e.jsxs(e.Fragment,{children:[e.jsx(K,{heading:s("dashboard.question.heading"),links:[{name:"Dashboard",href:B.dashboard.overview.analytics},{name:s("dashboard.question.heading"),href:B.dashboard.question.root},{name:s("dashboard.question.list")}],sx:{mb:{xs:3,md:5}}}),e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(De,{})})]}):$?e.jsxs(e.Fragment,{children:[e.jsx(K,{heading:s("dashboard.question.heading"),links:[{name:"Dashboard",href:B.dashboard.overview.analytics},{name:s("dashboard.question.heading"),href:B.dashboard.question.root},{name:s("dashboard.question.list")}],sx:{mb:{xs:3,md:5}}}),e.jsxs(re,{sx:{p:3,textAlign:"center"},children:[e.jsx(m,{sx:{color:"error.main",mb:2},children:e.jsx(j,{icon:"solar:danger-bold",width:48})}),e.jsx(m,{sx:{typography:"h6",mb:1},children:s("dashboard.question.errorLoading")}),e.jsx(m,{sx:{typography:"body2",color:"text.secondary",mb:2},children:$}),e.jsx(Q,{variant:"contained",onClick:g,children:s("dashboard.question.retry")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{heading:s("dashboard.question.heading"),links:[{name:"Dashboard",href:B.dashboard.overview.analytics},{name:s("dashboard.question.heading"),href:B.dashboard.question.root},{name:s("dashboard.question.list")}],action:e.jsx(Q,{variant:"contained",startIcon:e.jsx(j,{icon:"mingcute:add-line"}),onClick:fe,children:s("dashboard.question.addQuestion")}),sx:{mb:{xs:3,md:5}}}),e.jsxs(re,{children:[e.jsx(os,{filters:v,onResetPage:n.onResetPage,inputTypeOptions:ue}),L&&e.jsx(rs,{filters:v,totalResults:T.length,onResetPage:n.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(m,{sx:{position:"relative"},children:[e.jsx(Ae,{dense:n.dense,numSelected:n.selected.length,rowCount:T.length,onSelectAllRows:r=>n.onSelectAllRows(r,T.map(y=>y.id)),action:e.jsx(de,{title:s("dashboard.question.delete"),children:e.jsx(J,{color:"primary",onClick:t.onTrue,children:e.jsx(j,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(Fe,{children:e.jsxs(Ne,{size:n.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(We,{order:n.order,orderBy:n.orderBy,headCells:x,rowCount:T.length,numSelected:n.selected.length,onSort:n.onSort,onSelectAllRows:r=>n.onSelectAllRows(r,T.map(y=>y.id))}),e.jsxs(Le,{children:[T.map(r=>e.jsx(ts,{row:r,selected:n.selected.includes(r.id),onSelectRow:()=>n.onSelectRow(r.id),onDeleteRow:()=>pe(r.id),onEditRow:()=>be(r),onDragStart:z,onDragOverRow:W,onDragEnd:he,dragging:l===r.id},r.id)),e.jsx(Oe,{notFound:i})]})]})})]})]}),e.jsx(le,{open:c.value,onClose:c.onFalse,onSave:Z,question:null}),e.jsx(le,{open:o.value,onClose:o.onFalse,onSave:Z,question:u}),je(),ge()]})}function ls({inputData:s,comparator:n,filters:x}){const{name:t,inputType:a}=x,c=s.map((o,l)=>[o,l]);return c.sort((o,l)=>{const b=n(o[0],l[0]);return b!==0?b:o[1]-l[1]}),s=c.map(o=>o[0]),t&&typeof t=="string"&&(s=s.filter(o=>o.name?.toLowerCase().includes(t.toLowerCase()))),a&&(a==="required"?s=s.filter(o=>o.isRequired):s=s.filter(o=>o.inputType===a)),s}function Fs(){return e.jsx(Ie,{children:e.jsx(is,{})})}export{Fs as Q};
