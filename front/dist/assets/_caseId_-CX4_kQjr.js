import{w as C,N as j,r as n,O as v,j as e,B as c,J as T,K as u,Q as y,I as w}from"./index-BJkBHIXD.js";import{g as I}from"./password-session-B6s3sc22.js";import{P,C as M,a as S,b as E,c as R}from"./password-guard-DO16_mwR.js";import{C as B}from"./Card-CU8jzKuK.js";import"./audio-processor-BGEu5NX3.js";import"./Stack-DSqJGNfN.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./Chip-Cd7PxQUv.js";import"./styles-B-zEs6qR.js";import"./format-number-BErDzwe7.js";import"./upload-default-BMHhCMpu.js";import"./index-CDpvdXdB.js";import"./tslib.es6-CTYbIaVE.js";import"./empty-content-Cck_Y1yy.js";import"./table-head-custom-C2dATJUG.js";import"./TableHead-D9jAElFw.js";import"./FormControlLabel-Do9AncA_.js";import"./table-pagination-custom-Dom7EZhX.js";import"./LastPage-CrCg5Ljk.js";import"./InputAdornment-Cyf39fZQ.js";import"./TableContainer-D0zNvGRU.js";import"./schemas-BaSQ7w8v.js";function m(i){const{children:a,value:s,index:t,...l}=i;return e.jsx("div",{role:"tabpanel",hidden:s!==t,id:`case-details-tabpanel-${t}`,"aria-labelledby":`case-details-tab-${t}`,...l,children:s===t&&e.jsx(c,{sx:{p:3},children:a})})}function h(i){return{id:`case-details-tab-${i}`,"aria-controls":`case-details-tabpanel-${i}`}}function ae(){const{t:i}=C("navbar"),{slug:a,caseId:s}=j(),[t,l]=n.useState(0),[x,p]=n.useState(0),o=n.useCallback(async()=>{if(s)try{const r=await v(s);p(Math.min(r,99))}catch(r){console.error("âŒ [caseId].tsx: Failed to fetch unread chat count:",r),p(0)}},[s]);n.useEffect(()=>{if(!s)return;o();const r=setInterval(()=>{o()},5e3);return()=>clearInterval(r)},[s,o]),n.useEffect(()=>{if(!s)return;const r=d=>{d.detail?.caseId===s&&(o(),setTimeout(()=>o(),500),setTimeout(()=>o(),1500))};return window.addEventListener("chatMessagesMarkedAsRead",r),()=>{window.removeEventListener("chatMessagesMarkedAsRead",r)}},[s,o]),n.useEffect(()=>{if(s&&t===2){const r=setTimeout(()=>o(),1e3),d=setTimeout(()=>o(),2e3);return()=>{clearTimeout(r),clearTimeout(d)}}},[t,s,o]);const b=(r,d)=>{l(d)},f=()=>{},g=I(a||"")?.password||"";return!a||!s?e.jsx(c,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("p",{children:"Invalid case access. Please check the URL."})}):e.jsx(P,{companySlug:a,requiredPassword:g,children:e.jsx(c,{sx:{pt:5,pb:5,minHeight:"100vh",bgcolor:"grey.50",px:{xs:2,sm:3,md:4,lg:5}},children:e.jsxs(B,{sx:{borderRadius:2,overflow:"hidden"},children:[e.jsx(c,{sx:{borderBottom:1,borderColor:"divider",px:{xs:2,sm:3,md:4}},children:e.jsxs(T,{value:t,onChange:b,"aria-label":"case details tabs",sx:{"& .MuiTab-root":{minHeight:64,px:{xs:2,sm:3,md:4},mx:{xs:.5,sm:1}}},children:[e.jsx(u,{label:i("dashboard.case.detailsTabs.caseDetails"),...h(0)}),e.jsx(u,{label:i("dashboard.case.detailsTabs.documents"),...h(1)}),e.jsx(u,{label:i("dashboard.case.detailsTabs.chat"),...h(2),icon:e.jsx(y,{badgeContent:x??0,color:"error",sx:{"& .MuiBadge-badge":{fontSize:"0.7rem",minWidth:"18px",height:"18px"}},children:e.jsx(w,{width:24,icon:"solar:chat-round-dots-bold"})}),iconPosition:"start"})]})}),e.jsx(m,{value:t,index:0,children:e.jsx(M,{caseId:s,userId:a,companySlug:a})}),e.jsx(m,{value:t,index:1,children:e.jsx(S,{caseId:s,userId:a,companySlug:a})}),e.jsx(m,{value:t,index:2,children:e.jsx(E,{resetChatCount:f,children:e.jsx(R,{caseId:s,userId:a,companySlug:a})})})]})})})}export{ae as default};
