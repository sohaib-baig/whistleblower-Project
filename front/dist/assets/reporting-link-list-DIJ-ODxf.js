import{w as j,V as E,r as p,x as f,j as e,B as a,T as u,c as y,I as x,s as A,e as R,i as G,a4 as _,a0 as P,a8 as Q,a7 as I,a5 as J,a6 as K,a3 as X,M as Y,aa as Z,p as F,J as ee,K as te,bm as re,W as ne}from"./index-BJkBHIXD.js";import{S as se}from"./state-list-Dpo3uNiS.js";import{Q as ae}from"./question-view-BPaE8dV5.js";import{S as oe}from"./severity-list-BXB14MAR.js";import{D as ie}from"./department-list-BGfDRo5P.js";import{S as le}from"./support-edit-form-BtaBfAEj.js";import{S as h}from"./Stack-DSqJGNfN.js";import{T as de}from"./TextField-BfOXJaKd.js";import{I as T}from"./InputAdornment-Cyf39fZQ.js";import{U as ce}from"./user-create-edit-form-bgAKTpXd.js";import{a as pe}from"./index.esm-DG78EUPk.js";import{a as ge}from"./zod-DbnPk1Kl.js";import{F as L}from"./fields-wQ2IQIfM.js";import{s as ue}from"./schema-utils-C_-d4BNQ.js";import{F as me}from"./form-provider-BYLnCB41.js";import{C as D}from"./Card-CU8jzKuK.js";import{o as he,s as U}from"./schemas-BaSQ7w8v.js";import{P as xe}from"./privacy-policy-edit-form-D9O0KaFU.js";import{T as fe}from"./terms-conditions-edit-form-DmDJgzsM.js";import"./state-create-edit-form-Ce1HeCDb.js";import"./state-DFemdeiH.js";import"./Grid-D_Et280v.js";import"./confirm-dialog-D488U7AY.js";import"./table-no-data-BKo9R2Zy.js";import"./empty-content-Cck_Y1yy.js";import"./TableHead-D9jAElFw.js";import"./table-empty-rows-BDBaI17h.js";import"./table-head-custom-C2dATJUG.js";import"./FormControlLabel-Do9AncA_.js";import"./Select-CM-FquqI.js";import"./table-selected-action-uAaUSqFj.js";import"./table-pagination-custom-Dom7EZhX.js";import"./LastPage-CrCg5Ljk.js";import"./Chip-Cd7PxQUv.js";import"./text-transform-DM798QSo.js";import"./rhf-text-field-D45rQogC.js";import"./rhf-select-BCHEEYe2.js";import"./styles-B-zEs6qR.js";import"./format-number-BErDzwe7.js";import"./RadioGroup-eX8WPtuC.js";import"./severity-create-edit-form-D3OiKgZ-.js";import"./severity-Bb8Qe9go.js";import"./department-create-edit-form-DUV7k7Ni.js";import"./department-BOJZtc9U.js";import"./support-trthRr6H.js";import"./CardHeader-BmHD0Q2N.js";import"./rhf-phone-input-DvY4aKGv.js";import"./index-CDpvdXdB.js";import"./search-not-found-BYtFGFNz.js";import"./index-BdCJuPE0.js";import"./Autocomplete-vOabT0lM.js";import"./upload-default-BMHhCMpu.js";import"./tslib.es6-CTYbIaVE.js";import"./DatePicker-D3hVcc_W.js";import"./privacy-policy-YT0BRm3M.js";import"./terms-conditions-CcMF1HTj.js";function be(){const{t}=j("navbar"),{user:s}=E(),o=p.useMemo(()=>{const l=typeof window<"u"?window.location.origin:f.serverUrl,r=s?.companySlug||s?.company_slug||s?.slug||"";return`${l}/company/${r}/`},[s]),i=()=>{navigator.clipboard.writeText(o)},d=()=>{window.open(o,"_blank")};return e.jsx(a,{children:e.jsxs(h,{spacing:2,children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(a,{children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:t("dashboard.reportingLink.customizeChannel")}),e.jsx(u,{variant:"body2",color:"text.secondary",children:t("dashboard.reportingLink.customizeDescription")})]}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(x,{icon:"eva:external-link-fill"}),onClick:d,children:t("dashboard.reportingLink.openPage")})]}),e.jsxs(a,{children:[e.jsx(u,{variant:"subtitle2",sx:{mb:1},children:t("dashboard.reportingLink.reportingLink")}),e.jsx(de,{fullWidth:!0,value:o,InputProps:{readOnly:!0,startAdornment:e.jsx(T,{position:"start",children:e.jsx(x,{icon:"eva:link-2-fill"})}),endAdornment:e.jsx(T,{position:"end",children:e.jsx(y,{size:"small",onClick:i,startIcon:e.jsx(x,{icon:"solar:copy-bold"}),children:t("dashboard.reportingLink.copy")})})}})]})]})})}function ye(t){if(!t)return t;const o=new DOMParser().parseFromString(t,"text/html");return o.querySelectorAll("img[src]").forEach(l=>{const c=l.getAttribute("src");if(c&&!c.startsWith("data:")){if(c.startsWith("/")&&!c.startsWith("//")&&!c.startsWith("http")){const r=`${f.serverUrl}${c}`;l.setAttribute("src",r)}}}),o.body.innerHTML}function je(t){if(!t)return t;const o=new DOMParser().parseFromString(t,"text/html");return o.querySelectorAll("img[src]").forEach(d=>{const l=d.getAttribute("src");if(l&&l.startsWith(f.serverUrl)){const c=l.replace(f.serverUrl,"");d.setAttribute("src",c)}}),o.body.innerHTML}async function ve(t="en"){return(await A.get(R.pages.reportingPage.get,{params:{language:t}})).data}async function ke(t){await G();const s=je(t.content),o={page_title:t.title,page_content:s};return t.language&&(o.language=t.language),(await A.put(R.pages.reportingPage.update,o)).data}function Le(t="en"){const[s,o]=p.useState(null),[i,d]=p.useState(!0),[l,c]=p.useState(null),r=p.useCallback(async()=>{try{d(!0),c(null);const n=await ve(t),m=ye(n.page_content||""),v={id:n.id||"",title:n.page_title||"",content:m,lastUpdated:n.updated_at||"",pageType:n.page_type||"reporting_page",language:n.language||t};o(v)}catch(n){console.error("Failed to fetch reporting page:",n),c(n instanceof Error?n.message:"Failed to fetch reporting page"),o(null)}finally{d(!1)}},[t]);return p.useEffect(()=>{r()},[r]),{data:s,isLoading:i,error:l,refetch:r}}function Ce(){const[t,s]=p.useState(!1),[o,i]=p.useState(!1),[d,l]=p.useState(null),c=p.useCallback(async r=>{s(!0),i(!1),l(null);try{const n=await ke(r);return{id:n.id,title:n.page_title,content:n.page_content,lastUpdated:n.updated_at,pageType:n.page_type,language:n.language||r.language||"en"}}catch(n){throw i(!0),l(n instanceof Error?n.message:"Failed to update reporting page"),n}finally{s(!1)}},[]);return{mutate:c,mutateAsync:c,isPending:t,isError:o,error:d}}function we(){const{t}=j("navbar"),[s,o]=p.useState("en"),{data:i,isLoading:d,refetch:l}=Le(s),c=Ce(),r=_(),n=_(!0),m=p.useRef(!1),v=he({title:U().min(5,{message:t("dashboard.reportingLink.pageContent.titleMinLength")}),content:ue.editor().min(20,{message:t("dashboard.reportingLink.pageContent.contentMinLength")}),language:U().optional()}),W={title:"",content:"",language:"en"},C=pe({mode:"all",resolver:ge(v),defaultValues:W}),{watch:H,reset:w,setValue:M,handleSubmit:B,formState:{isSubmitting:z,isValid:S}}=C;p.useEffect(()=>{i&&(w({title:i.title||"",content:i.content||"",language:i.language||s}),m.current=!0)},[i,w,s]);const V=g=>{o(g),M("language",g),m.current=!1,l()},b=H(),O=B(async g=>{try{await c.mutateAsync({...g,language:s}),P.success(t("dashboard.reportingLink.pageContent.updatedSuccessfully"))}catch(k){console.error(k),P.error(t("dashboard.reportingLink.pageContent.updateFailed"))}}),$=(g,k)=>e.jsx(I,{onClick:k,children:e.jsx(x,{icon:g?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})}),q=()=>e.jsxs(a,{children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(a,{children:[e.jsx(u,{variant:"h6",sx:{fontWeight:"bold"},children:t("dashboard.reportingLink.pageContent.title")}),e.jsx(u,{variant:"body2",color:"text.secondary",children:t("dashboard.reportingLink.pageContent.description")})]}),$(n.value,n.onToggle)]}),e.jsxs(J,{in:n.value,children:[e.jsx(K,{sx:{mb:2}}),e.jsxs(h,{spacing:3,children:[e.jsx(L.Text,{name:"title",label:t("dashboard.reportingLink.pageContent.titleLabel")}),e.jsx(L.Select,{name:"language",label:"Language",value:s,onChange:g=>V(g.target.value),children:X.map(g=>e.jsx(Y,{value:g.value,children:g.label},g.value))}),e.jsxs(h,{spacing:1.5,children:[e.jsx(u,{variant:"subtitle2",children:t("dashboard.reportingLink.pageContent.content")}),e.jsx(L.Editor,{name:"content",fullItem:!0,sx:{maxHeight:600,"& .ql-editor":{minHeight:400}}},i?.id||"editor"),e.jsx(u,{variant:"caption",color:"text.secondary",sx:{mt:1},children:t("dashboard.reportingLink.pageContent.tip")})]})]})]})]}),N=()=>e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-end",gap:2,p:2.5},children:[e.jsx(y,{color:"inherit",variant:"outlined",size:"medium",onClick:r.onTrue,disabled:!S,children:t("dashboard.reportingLink.pageContent.preview")}),e.jsx(y,{type:"submit",variant:"contained",size:"medium",loading:z,disabled:!S,children:t("dashboard.reportingLink.pageContent.saveChanges")})]});return d?e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(u,{children:t("dashboard.reportingLink.loading")})}):e.jsxs(me,{methods:C,onSubmit:O,children:[e.jsxs(h,{spacing:3,sx:{mx:0,maxWidth:"none",width:1},children:[q(),N()]}),r.value&&e.jsx(Q,{children:e.jsx(a,{onClick:r.onFalse,sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",p:2},children:e.jsxs(D,{onClick:g=>g.stopPropagation(),sx:{width:"100%",maxWidth:{xs:"95vw",sm:"90vw",md:"800px",lg:"1000px"},maxHeight:"90vh",display:"flex",flexDirection:"column",position:"relative"},children:[e.jsx(a,{sx:{p:2,borderBottom:1,borderColor:"divider",flexShrink:0},children:e.jsxs(h,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(u,{variant:"h6",children:t("dashboard.reportingLink.pageContent.preview")}),e.jsx(I,{onClick:r.onFalse,children:e.jsx(x,{icon:"solar:close-circle-bold"})})]})}),e.jsxs(a,{sx:{p:3,overflow:"auto",flex:1},children:[b.title&&e.jsx(u,{variant:"h4",sx:{mb:2},children:b.title}),b.content?e.jsx(a,{sx:{"& h1, & h2, & h3, & h4, & h5, & h6":{color:"text.primary",fontWeight:600,mb:2,mt:3,"&:first-of-type":{mt:0}},"& p":{color:"text.secondary",lineHeight:1.7,mb:2},"& ul, & ol":{pl:3,mb:2,"& li":{color:"text.secondary",lineHeight:1.7,mb:.5}}},dangerouslySetInnerHTML:{__html:b.content}}):e.jsx(u,{variant:"body2",color:"text.secondary",children:t("dashboard.reportingLink.pageContent.noContent")})]})]})})})]})}function Se({userId:t}){const{t:s}=j("navbar"),[o,i]=p.useState(null),[d,l]=p.useState(!0);return p.useEffect(()=>{(async()=>{try{l(!0);const r=await re(t),n=Array.isArray(r?.roles)&&r.roles.length?r.roles[0]?.name:r?.primary_role||r?.role||"",m=r.avatar_url?String(r.avatar_url).startsWith("/")?`${f.serverUrl}${r.avatar_url}`:String(r.avatar_url):"";i({id:r.id,name:r.name??"",email:r.email??"",phoneNumber:r.phone??"",avatar:r.avatar_path??"",avatarUrl:m,role:n??"",status:r.is_active===1?"active":r.is_active===0?"banned":"pending",company:r.company_name??"",country:r.country??null,address:r.address??"",physicalAddress:r.physical_address??"",phoneHoursFrom:r.phone_hours_from??"",phoneHoursTo:r.phone_hours_to??"",phoneHoursFormat:r.phone_hours_format??"24h",userLanguage:r.user_language??"en",state:r.state??"",city:r.city??"",zipCode:r.zip_code??"",isVerified:!!r.email_verified_at,createdAt:r.created_at??new Date().toISOString(),updatedAt:r.updated_at??new Date().toISOString()})}catch(r){console.error("Failed to fetch user:",r)}finally{l(!1)}})()},[t]),d?e.jsx(a,{children:s("dashboard.reportingLink.loading")}):e.jsx(ce,{currentUser:o||void 0,showOnlyReportingFields:!0})}function _e(){const{t}=j("navbar"),{user:s}=E(),o=p.useMemo(()=>[{key:"setting",label:t("dashboard.reportingLink.tabs.setting"),render:()=>s?.id?e.jsx(a,{sx:{p:3},children:e.jsx(Se,{userId:s.id})}):null},{key:"page",label:t("dashboard.reportingLink.tabs.page"),render:()=>e.jsx(a,{sx:{p:3},children:e.jsx(we,{})})},{key:"privacy-policy",label:t("dashboard.reportingLink.tabs.privacyPolicy"),render:()=>e.jsx(a,{sx:{p:3},children:e.jsx(xe,{isReportingLinkContext:!0})})},{key:"terms-conditions",label:t("dashboard.reportingLink.tabs.termsConditions"),render:()=>e.jsx(a,{sx:{p:3},children:e.jsx(fe,{isReportingLinkContext:!0})})},{key:"support",label:t("dashboard.reportingLink.tabs.support"),render:()=>e.jsx(a,{sx:{p:3},children:e.jsx(le,{isReportingLinkContext:!0})})},{key:"question",label:t("dashboard.reportingLink.tabs.question"),render:()=>e.jsx(a,{sx:{p:0,pt:3},children:e.jsx(ae,{})})},{key:"department",label:t("dashboard.reportingLink.tabs.department"),render:()=>e.jsx(a,{sx:{p:3},children:e.jsx(ie,{showBreadcrumbs:!1})})},{key:"state",label:t("dashboard.reportingLink.tabs.state"),render:()=>e.jsx(a,{sx:{p:3},children:e.jsx(se,{showBreadcrumbs:!1})})},{key:"severity",label:t("dashboard.reportingLink.tabs.severity"),render:()=>e.jsx(a,{sx:{p:3},children:e.jsx(oe,{showBreadcrumbs:!1})})}],[t,s?.id]),i=s?.role==="case_manager",d=p.useMemo(()=>i?o.filter(n=>n.key==="setting"):o,[o,i]),[l,c]=p.useState(d[0]?.key??"setting");p.useEffect(()=>{d.some(n=>n.key===l)||c(d[0]?.key??"setting")},[d,l]);const r=(n,m)=>{c(m)};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{heading:t("dashboard.reportingLink.heading"),links:[{name:"Dashboard",href:F.dashboard.root},{name:t("dashboard.reportingLink.breadcrumb"),href:F.dashboard.reportingLink.root}],sx:{mb:{xs:3,md:5}}}),e.jsxs(D,{children:[e.jsx(a,{sx:{px:3,pt:3,pb:5},children:e.jsx(be,{})}),!i&&e.jsx(a,{sx:{borderTop:i?0:1,borderBottom:1,borderColor:"divider",px:3,pt:i?3:0},children:e.jsx(ee,{value:l,onChange:r,variant:"scrollable",allowScrollButtonsMobile:!0,children:d.map(n=>e.jsx(te,{label:n.label,value:n.key},n.key))})}),!i&&e.jsx(a,{sx:{px:0,py:0},children:d.map(n=>e.jsx(a,{sx:{display:n.key===l?"block":"none"},children:n.render()},n.key))})]})]})}function Pe(){return e.jsx(ne,{children:e.jsx(_e,{})})}function Tt(){return e.jsx(Pe,{})}export{Tt as default};
