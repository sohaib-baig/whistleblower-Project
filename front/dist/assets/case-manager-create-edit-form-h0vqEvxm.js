import{w as N,u as D,r as m,i as k,s as P,e as S,a0 as b,p as I,j as s,B as T,c as C}from"./index-BJkBHIXD.js";import{a as q}from"./zod-DbnPk1Kl.js";import{a as J,F as K}from"./index.esm-DG78EUPk.js";import{u as Q,c as W}from"./case-manager-table-toolbar-CUGtPtg9.js";import"./text-transform-DM798QSo.js";import{R as f}from"./rhf-text-field-D45rQogC.js";import{R as X}from"./rhf-phone-input-DvY4aKGv.js";import"./styles-B-zEs6qR.js";import{S as x}from"./Stack-DSqJGNfN.js";import{C as R}from"./Card-CU8jzKuK.js";import{o as Y,s as c,l as Z}from"./schemas-BaSQ7w8v.js";function da({currentCaseManager:r}){const{t:a}=N("navbar"),B=D(),w=a("dashboard.caseManager.emailExists",{defaultValue:"This email address is already registered."}),y=a("dashboard.caseManager.phoneExists",{defaultValue:"This phone number is already registered."}),M=a("dashboard.caseManager.emailValidationFailed",{defaultValue:"Unable to validate email right now. Please try again."}),j=a("dashboard.caseManager.phoneValidationFailed",{defaultValue:"Unable to validate phone number right now. Please try again."}),L=Y({name:c().min(2,a("dashboard.caseManager.nameMinLength")),email:c().email(a("dashboard.caseManager.invalidEmail")),password:c().min(8,a("dashboard.caseManager.passwordMinLength")).optional().or(Z("")),phone:c().min(10,a("dashboard.caseManager.phoneMinLength"))}),O={name:"",email:"",password:"",phone:""},v=J({resolver:q(L),defaultValues:O,values:r?{name:r.name,email:r.email,password:"",phone:r.phone}:void 0}),{reset:E,handleSubmit:A,formState:{isSubmitting:h,errors:F},setError:n,clearErrors:i,getValues:d}=v,p=m.useMemo(()=>r?.email?r.email.trim().toLowerCase():"",[r?.email]),g=m.useMemo(()=>r?.phone?r.phone.trim():"",[r?.phone]),H=m.useCallback(async()=>{const o=(d("email")||"").trim().toLowerCase();if(!o){i("email");return}if(p&&o===p){i("email");return}try{await k(),!!(await P.post(S.auth.checkEmail,{email:o})).data?.exists?n("email",{type:"duplicate",message:w}):i("email")}catch(e){const t=e?.message||M;n("email",{type:"manual",message:t})}},[i,w,M,d,p,n]),U=m.useCallback(async()=>{const o=(d("phone")||"").trim();if(!o){i("phone");return}if(g&&o===g){i("phone");return}try{await k(),!!(await P.post(S.auth.checkPhone,{phone:o})).data?.exists?n("phone",{type:"duplicate",message:y}):i("phone")}catch(e){const t=e?.message||j;n("phone",{type:"manual",message:t})}},[i,y,d,g,j,n]),z=A(async o=>{try{const e={...o};r&&!e.password&&delete e.password,r?(await Q(r.id,e),b.success(a("dashboard.caseManager.caseManagerUpdated"))):(await W(e),b.success(a("dashboard.caseManager.caseManagerCreated"))),E(),B.push(I.dashboard.caseManager.list)}catch(e){console.error("Failed to save case manager:",e);const t=e?.errors;t&&typeof t=="object"&&Object.entries(t).forEach(([l,u])=>{const V=Array.isArray(u)?u[0]:u;typeof V=="string"&&(l==="email"||l==="phone"||l==="name"||l==="password")&&n(l,{type:"server",message:V})});const G=e?.message||a("dashboard.caseManager.failedToSave",{defaultValue:"Failed to save case manager. Please try again."});b.error(G)}});return s.jsx(K,{...v,children:s.jsxs(x,{spacing:3,children:[s.jsx(R,{sx:{p:3},children:s.jsxs(T,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[s.jsx(f,{name:"name",label:a("dashboard.caseManager.fullName")}),s.jsx(f,{name:"email",label:a("dashboard.caseManager.emailAddress"),onBlur:H}),s.jsx(f,{name:"password",label:a("dashboard.caseManager.password"),type:"password",helperText:a(r?"dashboard.caseManager.passwordPlaceholder":"dashboard.caseManager.passwordHelperText")}),s.jsx(X,{name:"phone",label:a("dashboard.caseManager.phoneNumber"),onBlur:U})]})}),s.jsxs(x,{direction:"row",justifyContent:"flex-end",spacing:2,children:[s.jsx(C,{variant:"outlined",onClick:()=>E(),disabled:h,children:a("dashboard.caseManager.reset")}),s.jsx(C,{type:"submit",variant:"contained",disabled:h,onClick:z,children:a(h?"dashboard.caseManager.saving":"dashboard.caseManager.save")})]}),Object.keys(F).length>0&&s.jsx(R,{sx:{p:2,bgcolor:"error.lighter"},children:s.jsxs(x,{spacing:1,children:[s.jsx("strong",{children:"Form Validation Errors:"}),Object.entries(F).map(([o,e])=>s.jsxs(T,{children:[s.jsxs("strong",{children:[o,":"]})," ",e?.message]},o))]})})]})})}export{da as C};
