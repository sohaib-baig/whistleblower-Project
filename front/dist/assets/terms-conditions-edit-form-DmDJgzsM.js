import{w as _,u as q,r as j,a4 as v,a0 as y,p as G,j as e,B as o,T as a,a8 as J,a7 as w,I as S,a6 as K,a3 as N,M as x,a5 as O,c as p}from"./index-BJkBHIXD.js";import{a as Q}from"./index.esm-DG78EUPk.js";import{a as X}from"./zod-DbnPk1Kl.js";import{u as Y,a as Z}from"./terms-conditions-CcMF1HTj.js";import{F as c}from"./fields-wQ2IQIfM.js";import{s as $}from"./schema-utils-C_-d4BNQ.js";import{F as ee}from"./form-provider-BYLnCB41.js";import{S as m}from"./Stack-DSqJGNfN.js";import{C as T}from"./Card-CU8jzKuK.js";import{C as te}from"./CardHeader-BmHD0Q2N.js";import{o as se,s as g}from"./schemas-BaSQ7w8v.js";const oe=i=>se({title:g().min(5,{message:i("dashboard.termsConditions.errors.titleMinLength")}),content:$.editor().min(20,{message:i("dashboard.termsConditions.errors.contentMinLength")}),status:g().optional(),language:g().optional()});function pe({isReportingLinkContext:i=!1}){const{t}=_("navbar"),b=q(),[r,I]=j.useState("en"),{data:n,isLoading:k,refetch:L}=Y(r),F=Z(),H=oe(t),l=v(),h=v(!0),E={title:"",content:"",status:"active",language:"en"},f=Q({mode:"all",resolver:X(H),defaultValues:E,values:n?{title:n.title,content:n.content,status:n.status||"active",language:n.language||r}:void 0}),{watch:B,setValue:M,handleSubmit:z,formState:{isSubmitting:D,isValid:C}}=f,d=B(),W=s=>{I(s),M("language",s),L()},P=z(async s=>{try{await F.mutateAsync({...s,language:r}),y.success(t(i?"dashboard.reportingLink.page2.updatedSuccessfully":"dashboard.termsConditions.toast.updatedSuccessfully"))}catch(u){console.error(u),y.error(t("dashboard.termsConditions.toast.updateFailed"))}}),V=j.useCallback(()=>{b.push(G.dashboard.termsConditions.root)},[b]),A=(s,u)=>e.jsx(w,{onClick:u,children:e.jsx(S,{icon:s?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})}),R=()=>e.jsxs(T,{children:[e.jsx(te,{title:t("dashboard.termsConditions.form.title"),subheader:t("dashboard.termsConditions.form.subheader"),action:A(h.value,h.onToggle),sx:{mb:3}}),e.jsx(K,{}),e.jsxs(m,{spacing:3,sx:{p:3},children:[e.jsx(c.Text,{name:"title",label:t("dashboard.termsConditions.form.titleLabel")}),e.jsx(c.Select,{name:"language",label:"Language",value:r,onChange:s=>W(s.target.value),children:N.map(s=>e.jsx(x,{value:s.value,children:s.label},s.value))}),e.jsxs(c.Select,{name:"status",label:t("dashboard.termsConditions.form.status"),placeholder:t("dashboard.termsConditions.form.selectStatus"),children:[e.jsx(x,{value:"active",children:t("dashboard.termsConditions.status.active")}),e.jsx(x,{value:"inactive",children:t("dashboard.termsConditions.status.inactive")})]}),e.jsx(O,{in:h.value,children:e.jsxs(m,{spacing:1.5,children:[e.jsx(a,{variant:"subtitle2",children:t("dashboard.termsConditions.form.content")}),e.jsx(c.Editor,{name:"content",fullItem:!0,sx:{maxHeight:600,"& .ql-editor":{minHeight:400}}}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:t("dashboard.termsConditions.form.tip")})]})})]})]}),U=()=>e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-end",gap:2,p:2.5},children:[e.jsx(p,{color:"inherit",variant:"outlined",size:"medium",onClick:l.onTrue,disabled:!C,children:t("dashboard.termsConditions.actions.preview")}),e.jsx(p,{color:"inherit",variant:"outlined",size:"medium",onClick:V,children:t("dashboard.termsConditions.actions.cancel")}),e.jsx(p,{type:"submit",variant:"contained",size:"medium",loading:D,disabled:!C,children:t("dashboard.termsConditions.actions.saveChanges")})]});return k?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(a,{children:t("dashboard.termsConditions.loading")})}):e.jsxs(ee,{methods:f,onSubmit:P,children:[e.jsxs(m,{spacing:5,sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[R(),U()]}),l.value&&e.jsx(J,{children:e.jsx(o,{onClick:l.onFalse,sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",p:2},children:e.jsxs(T,{onClick:s=>s.stopPropagation(),sx:{width:"100%",maxWidth:{xs:"95vw",sm:"90vw",md:"800px",lg:"1000px"},maxHeight:"90vh",display:"flex",flexDirection:"column",position:"relative"},children:[e.jsx(o,{sx:{p:2,borderBottom:1,borderColor:"divider",flexShrink:0},children:e.jsxs(m,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(a,{variant:"h6",children:t("dashboard.termsConditions.actions.preview")}),e.jsx(w,{onClick:l.onFalse,children:e.jsx(S,{icon:"solar:close-circle-bold"})})]})}),e.jsxs(o,{sx:{p:3,overflow:"auto",flex:1},children:[d.title&&e.jsx(a,{variant:"h4",sx:{mb:2},children:d.title}),d.content?e.jsx(o,{sx:{"& h1, & h2, & h3, & h4, & h5, & h6":{color:"text.primary",fontWeight:600,mb:2,mt:3,"&:first-of-type":{mt:0}},"& p":{color:"text.secondary",lineHeight:1.7,mb:2},"& ul, & ol":{pl:3,mb:2,"& li":{color:"text.secondary",lineHeight:1.7,mb:.5}}},dangerouslySetInnerHTML:{__html:d.content}}):e.jsx(a,{variant:"body2",color:"text.secondary",children:t("dashboard.termsConditions.form.noContent")})]})]})})})]})}export{pe as T};
