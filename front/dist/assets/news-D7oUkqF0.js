import{r as c,i as w,s as u,e as n}from"./index-BJkBHIXD.js";async function N(s){return(await u.get(n.news.list,{params:s})).data}async function S(s){try{const t=n.news.details(s);return(await u.get(t)).data}catch(t){throw console.error("Error in fetchNews:",t),console.error("Error response:",t.response?.data),console.error("Error status:",t.response?.status),t}}async function C(s){await w();const t={title:s.title,content:s.content,cover_image:s.cover_image,status:s.status,meta_title:s.meta_title,meta_description:s.meta_description,meta_keywords:s.meta_keywords};return(await u.post(n.news.create,t)).data}async function D(s,t){const a=typeof n.news.update=="function"?n.news.update(s):n.news.update;await w();const o={};return t.title!==void 0&&(o.title=t.title),t.content!==void 0&&(o.content=t.content),t.cover_image!==void 0&&(o.cover_image=t.cover_image),t.status!==void 0&&(o.status=t.status),t.meta_title!==void 0&&(o.meta_title=t.meta_title),t.meta_description!==void 0&&(o.meta_description=t.meta_description),t.meta_keywords!==void 0&&(o.meta_keywords=t.meta_keywords),(await u.put(a,o)).data}async function F(s){const t=typeof n.news.delete=="function"?n.news.delete(s):n.news.delete;await w(),await u.delete(t)}async function U(s,t){await w();const a=new FormData;a.append("cover",t);const o=n.news.uploadCover(s);return(await u.post(o,a,{headers:{"Content-Type":"multipart/form-data"}})).data}function A(s){const[t,a]=c.useState([]),[o,l]=c.useState(!0),[f,d]=c.useState(null),p=c.useCallback(async()=>{try{l(!0),d(null);const e=await N(s),i=e.data||e,g=(Array.isArray(i)?i:i.data||[]).map(r=>{const m=r.meta_keywords?r.meta_keywords.split(",").map(h=>h.trim()):[],_=r.cover_url||(r.cover_image?`http://127.0.0.1:8082/storage/${r.cover_image}`:""),y=(r.content?.replace(/<[^>]*>/g,"").trim()||"").substring(0,200);return{id:r.id.toString(),title:r.title,content:r.content,description:y,coverUrl:_,publish:r.status,metaTitle:r.meta_title||"",metaDescription:r.meta_description||"",metaKeywords:m,tags:m,totalViews:r.total_views||0,totalShares:0,totalComments:0,totalFavorites:0,favoritePerson:[],comments:[],author:{id:r.user?.id?r.user.id.toString():void 0,name:r.user?.name||"Unknown",avatarUrl:r.user?.avatar_url||""},createdAt:r.created_at}});a(g)}catch(e){console.error("Failed to fetch news:",e),d(e instanceof Error?e.message:"Failed to fetch news"),a([])}finally{l(!1)}},[s]);return c.useEffect(()=>{p()},[p]),{news:t,loading:o,error:f,refetch:p}}function T(s){const[t,a]=c.useState(null),[o,l]=c.useState(!0),[f,d]=c.useState(null);return c.useEffect(()=>{async function p(){if(!s){l(!1);return}try{l(!0),d(null);const e=await S(s);if(!e)throw console.error("❌ Data is null or undefined"),new Error("No data returned from API");if(!e.id)throw console.error("❌ Data has no ID:",e),new Error("Invalid news data - missing ID");const i=e.meta_keywords?e.meta_keywords.split(",").map(_=>_.trim()):[],v=e.cover_url||(e.cover_image?`http://127.0.0.1:8082/storage/${e.cover_image}`:""),r=(e.content?.replace(/<[^>]*>/g,"").trim()||"").substring(0,200),m={id:e.id.toString(),title:e.title,content:e.content,description:r,coverUrl:v,publish:e.status,metaTitle:e.meta_title||"",metaDescription:e.meta_description||"",metaKeywords:i,tags:i,totalViews:e.total_views||0,totalShares:0,totalComments:0,totalFavorites:0,favoritePerson:[],comments:[],author:{id:e.user?.id?e.user.id.toString():void 0,name:e.user?.name||"Unknown",avatarUrl:e.user?.avatar_url||""},createdAt:e.created_at};a(m)}catch(e){console.error("Failed to fetch news:",e),console.error("Error details:",{message:e.message,response:e.response,status:e.response?.status,data:e.response?.data});const i=e.message||"Failed to fetch news";console.error("Final error message:",i),d(i),a(null)}finally{l(!1)}}p()},[s]),{news:t,loading:o,error:f}}export{U as a,T as b,C as c,A as d,F as e,D as u};
