import{r as n,j as _,B as R}from"./index-BJkBHIXD.js";let x=null,b=null;function H(){const o=typeof window<"u"?window.location.hostname:null;if(x!==null&&b===o)return x;const t=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="0.0.0.0"||window.location.hostname.startsWith("192.168.")||window.location.hostname.startsWith("10.0."))||!0;return x=t,b=o,t}function P(){return"0x4AAAAAACI2ghJGyWWGChrA"}let f;const T=new WeakMap;function S(){if(window.turnstile)return Promise.resolve();if(window.__turnstileLoading)return window.__turnstileLoading;const o="cf-turnstile-script";return document.getElementById(o)?(f=new Promise((t,u)=>{let r=0;const l=100,a=setInterval(()=>{if(r++,window.turnstile){clearInterval(a),window.__turnstileLoading=void 0,t();return}r>=l&&(clearInterval(a),window.__turnstileLoading=void 0,u(new Error("Turnstile script failed to load after timeout")))},100)}),window.__turnstileLoading=f,f):(f=new Promise((t,u)=>{const r=document.createElement("script");r.id=o,r.src="https://challenges.cloudflare.com/turnstile/v0/api.js",r.async=!0,r.defer=!0;let l=!1;const a=()=>{window.__turnstileLoading=void 0};r.onload=()=>{let c=0;const i=50,s=setInterval(()=>{if(c++,window.turnstile){clearInterval(s),l||(l=!0,a(),t());return}c>=i&&(clearInterval(s),l||(l=!0,a(),u(new Error("Turnstile object not available after script load"))))},100)},r.onerror=()=>{l||(l=!0,a(),u(new Error("Failed to load Cloudflare Turnstile script")))},window.__turnstileLoading=f,document.head.appendChild(r)}),f)}function W({siteKey:o,onSuccess:w,onError:t,onExpire:u,theme:r="auto",size:l="normal",className:a}){const c=n.useRef(null),i=n.useRef(null),s=n.useRef(!1),d=n.useRef(!1),[p,I]=n.useState(!1),v=n.useCallback(e=>{s.current=!1,w(e)},[w]),y=n.useCallback(()=>{s.current=!1,t&&t()},[t]),L=n.useCallback(()=>{u&&u()},[u]);n.useEffect(()=>{let e=!0;return window.turnstile?(I(!0),()=>{e=!1}):(S().then(()=>{e&&window.turnstile?I(!0):e&&t&&t()}).catch(m=>{console.error("[Turnstile] Script loading error:",m),e&&t&&t()}),()=>{e=!1})},[t]),n.useEffect(()=>{if(!p||!c.current||!window.turnstile)return()=>{};const e=c.current;if(!e)return()=>{};if(d.current||i.current||s.current)return()=>{};const m=T.get(e);if(m)return d.current=!0,i.current=m,()=>{};const k=e.querySelector('.cf-turnstile, iframe[src*="challenges.cloudflare.com"]'),g=e.getAttribute("data-turnstile-widget-id");if(k||g)return d.current=!0,g&&(i.current=g,T.set(e,g)),()=>{};s.current=!0,d.current=!0,e.innerHTML="";const C=setTimeout(()=>{if(!e||!window.turnstile){s.current=!1,d.current=!1;return}if(i.current||e.querySelector(".cf-turnstile")){s.current=!1;return}try{const h=window.turnstile.render(e,{sitekey:o,callback:v,"error-callback":y,"expired-callback":L,theme:r,size:l});i.current=h,T.set(e,h),s.current=!1}catch(h){s.current=!1,d.current=!1,console.error("[Turnstile] Failed to render widget:",h),t&&t()}},50);return()=>{clearTimeout(C),s.current=!1}},[p,o,v,y,L,r,l,t]);const A=()=>{if(i.current&&window.turnstile)try{window.turnstile.reset(i.current)}catch(e){console.error("Failed to reset Turnstile widget:",e)}};return n.useEffect(()=>{c.current&&(c.current.resetTurnstile=A)},[]),n.useEffect(()=>{c.current&&i.current&&c.current.setAttribute("data-turnstile-widget-id",i.current)},[i.current]),_.jsx(R,{ref:c,className:a,"data-turnstile-container":"true",sx:{display:"flex",justifyContent:"center",minHeight:65,alignItems:"center","& .cf-turnstile":{margin:"0 auto"}},children:!p&&_.jsx(R,{sx:{display:"flex",alignItems:"center",gap:1,color:"text.secondary",fontSize:"0.875rem"},children:"Loading security verification..."})})}const B=n.memo(W);export{B as T,P as g,H as s};
