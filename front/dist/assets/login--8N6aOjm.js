import{N as B,u as W,w as F,r,j as e,C as x,T as o,A as j,H as N,x as _,P as b,B as c,c as A,I as v,bg as D,bi as R}from"./index-BJkBHIXD.js";import{s as $}from"./password-session-B6s3sc22.js";import{s as u,T as k,g as H}from"./turnstile-CZ4Z_PxC.js";import{T as K}from"./TextField-BfOXJaKd.js";import{C as z}from"./Card-CU8jzKuK.js";import{C as U}from"./CardContent-B8WUz70H.js";import"./Select-CM-FquqI.js";const q=H();function G(){const{slug:a}=B(),C=W(),{t:n}=F("company"),[s,I]=r.useState(null),[T,g]=r.useState(!0),[h,y]=r.useState(!1),[f,i]=r.useState(null),[p,d]=r.useState(null),[m,S]=r.useState({email:"",password:"",rememberMe:!1});r.useEffect(()=>{(async()=>{if(a)try{g(!0);const t=await D(a);I(t)}catch(t){console.error("Error fetching company:",t),i("Company not found")}finally{g(!1)}})()},[a]);const w=l=>t=>{const L=t.target.value;S({...m,[l]:L})},E=async l=>{if(l.preventDefault(),!!a){if(u()&&!p){i("Please complete the security verification.");return}try{y(!0),i(null);const t=await R(a,m,u()?p??void 0:void 0);t.status&&t.data?.case_id?($(m.password,a,a,t.data.case_id),C.push(`/company/${a}/case-details/${t.data.case_id}`)):i("Invalid password. Please try again.")}catch(t){i(t.message||"Invalid password. Please try again."),d(null)}finally{y(!1)}}};if(T)return e.jsx(x,{maxWidth:"sm",sx:{py:4},children:e.jsx(o,{children:n("layout.loading")})});if(!s)return e.jsx(x,{maxWidth:"sm",sx:{py:4},children:e.jsx(j,{severity:"error",children:n("layout.companyNotFound")})});const P=s?.name||"Login";return e.jsxs(e.Fragment,{children:[e.jsx(N,{children:e.jsx("title",{children:`${P} - ${_.appName}`})}),e.jsxs(x,{maxWidth:"sm",sx:{py:4},children:[e.jsxs(b,{elevation:3,sx:{p:4,mb:4,textAlign:"center"},children:[e.jsx(c,{component:"img",src:s.logo,alt:s.name,sx:{width:80,height:80,mx:"auto",mb:2,objectFit:"contain",display:"block"}}),e.jsxs(o,{variant:"h4",component:"h1",gutterBottom:!0,children:[n("login.welcome")," ",s.name]}),e.jsx(o,{variant:"body1",color:"text.secondary",children:n("login.signInToCase")})]}),e.jsxs(b,{elevation:3,sx:{p:4},children:[e.jsx(o,{variant:"h5",component:"h2",gutterBottom:!0,textAlign:"center",children:n("login.signIn")}),f&&e.jsx(j,{severity:"error",sx:{mb:3},children:f}),e.jsxs(c,{component:"form",onSubmit:E,children:[e.jsx(K,{fullWidth:!0,label:n("login.password"),type:"password",value:m.password,onChange:w("password"),margin:"normal",required:!0,autoComplete:"current-password"}),u()&&e.jsx(c,{sx:{mt:2,mb:2,display:"flex",justifyContent:"center"},children:e.jsx(k,{siteKey:q,onSuccess:l=>{d(l)},onError:()=>{d(null),i("Security verification failed. Please refresh and try again.")},onExpire:()=>{d(null)},theme:"auto",size:"normal"})}),e.jsx(A,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:h||u()&&!p,sx:{mt:2,mb:2},children:n(h?"login.signingIn":"login.signIn")})]})]}),e.jsx(z,{sx:{mt:3},children:e.jsxs(U,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:n("login.needHelp")}),e.jsx(o,{variant:"body2",color:"text.secondary",paragraph:!0,children:n("login.troubleSigningIn")}),s.contactInfo?.email&&e.jsxs(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(v,{icon:"solar:letter-unread-bold",sx:{mr:1}}),e.jsx(o,{variant:"body2",fontWeight:"medium",children:s.contactInfo.email})]}),s.contactInfo?.phone&&e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(v,{icon:"solar:phone-bold",sx:{mr:1}}),e.jsx(o,{variant:"body2",fontWeight:"medium",children:s.contactInfo.phone})]})]})})]})]})}function Z(){return e.jsx(G,{})}export{Z as default};
