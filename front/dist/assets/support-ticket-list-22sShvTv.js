import{j as e,T as x,B as C,al as V,bP as D,bQ as k,bS as H,a7 as _,I as y,r as p,bT as K,u as N,V as B,a4 as G,bR as J,cD as Q,a0 as I,p as w,J as q,U as M,K as X,ah as Y,ab as Z,c as F,d1 as ee,W as te,aa as ae,y as se}from"./index-BJkBHIXD.js";import{e as ne}from"./support-ticket-BcjHfbJs.js";import{C as oe}from"./confirm-dialog-D488U7AY.js";import{u as re,g as le,r as ce,e as ie,T as de}from"./table-no-data-BKo9R2Zy.js";import{T as ue}from"./table-empty-rows-BDBaI17h.js";import{T as he}from"./table-head-custom-C2dATJUG.js";import{T as pe}from"./table-pagination-custom-Dom7EZhX.js";import{T as me,a as g,b as xe,c as ge}from"./TableHead-D9jAElFw.js";import{C as je}from"./FormControlLabel-Do9AncA_.js";import{S as j}from"./Stack-DSqJGNfN.js";import{T as be}from"./TextField-BfOXJaKd.js";import{I as fe}from"./InputAdornment-Cyf39fZQ.js";import{D as A}from"./DatePicker-D3hVcc_W.js";import{C as S}from"./Chip-Cd7PxQUv.js";import{C as Ce}from"./Card-CU8jzKuK.js";import"./text-transform-DM798QSo.js";import"./styles-B-zEs6qR.js";import"./empty-content-Cck_Y1yy.js";import"./LastPage-CrCg5Ljk.js";import"./Select-CM-FquqI.js";import"./index-CDpvdXdB.js";import"./format-number-BErDzwe7.js";function Te({row:t,selected:o,onSelectRow:u,onViewRow:i,onDeleteRow:a}){return e.jsxs(me,{hover:!0,selected:o,children:[e.jsx(g,{padding:"checkbox",children:e.jsx(je,{checked:o,onClick:u})}),e.jsx(g,{children:e.jsx(j,{direction:"row",alignItems:"center",spacing:2,children:e.jsxs(x,{variant:"body2",sx:{color:"text.secondary"},children:["#",t.id.slice(-8)]})})}),e.jsx(g,{children:e.jsx(j,{direction:"row",alignItems:"center",spacing:2,children:e.jsxs(C,{children:[e.jsx(x,{variant:"subtitle2",noWrap:!0,children:t.title}),t.latest_chat&&e.jsxs(x,{variant:"caption",sx:{color:"text.secondary"},children:["Last: ",t.latest_chat.content.substring(0,50),"..."]})]})})}),e.jsx(g,{children:e.jsxs(j,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(V,{alt:t.creator.name,src:void 0,sx:{width:32,height:32},children:t.creator.name.charAt(0).toUpperCase()}),e.jsxs(C,{children:[e.jsx(x,{variant:"body2",noWrap:!0,children:t.creator.name}),t.creator.company_name&&e.jsx(x,{variant:"caption",sx:{color:"text.secondary"},children:t.creator.company_name})]})]})}),e.jsx(g,{children:e.jsx(D,{variant:"soft",color:t.status==="open"&&"success"||t.status==="closed"&&"default"||"default",children:t.status})}),e.jsx(g,{children:e.jsxs(j,{direction:"row",alignItems:"center",spacing:1,children:[t.unread_count>0&&e.jsx(D,{color:"error",variant:"filled",children:t.unread_count}),e.jsx(x,{variant:"caption",children:t.unread_count>0?"unread":"read"})]})}),e.jsx(g,{children:e.jsxs(j,{direction:"column",children:[e.jsx(x,{variant:"body2",children:k(t.created_at)}),e.jsx(x,{variant:"caption",sx:{color:"text.secondary"},children:H(t.created_at)})]})}),e.jsx(g,{align:"right",children:e.jsx(_,{onClick:i,children:e.jsx(y,{icon:"solar:eye-bold"})})})]})}function we({filters:t,onFilters:o,dateError:u}){const i=p.useCallback(r=>{o("name",r.target.value)},[o]),a=p.useCallback(r=>{o("startDate",r)},[o]),c=p.useCallback(r=>{o("endDate",r)},[o]);return e.jsx(j,{spacing:2,alignItems:{xs:"flex-end",sm:"center"},direction:{xs:"column",sm:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:e.jsxs(j,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[e.jsx(be,{fullWidth:!0,value:t.name,onChange:i,placeholder:"Search by subject or creator...",InputProps:{startAdornment:e.jsx(fe,{position:"start",children:e.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsx(A,{label:"Start date",value:t.startDate,onChange:a,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:180}}}),e.jsx(A,{label:"End date",value:t.endDate,onChange:c,slotProps:{textField:{fullWidth:!0,error:u,helperText:u?"End date must be later than start date":null}},sx:{maxWidth:{md:180}}})]})})}function De({filters:t,onFilters:o,onResetFilters:u,results:i,...a}){const c=()=>{o("name","")},r=()=>{o("status","all")},m=()=>{o("startDate",null),o("endDate",null)};return e.jsxs(j,{gap:1.5,direction:"row",flexWrap:"wrap",alignItems:"center",...a,children:[e.jsxs(C,{component:"span",sx:{typography:"body2",color:"text.secondary"},children:[i," results found"]}),!!t.name&&e.jsx(S,{label:`Subject/Creator: ${t.name}`,size:"small",onDelete:c}),t.status!=="all"&&e.jsx(S,{label:`Status: ${t.status}`,size:"small",onDelete:r}),(!!t.startDate||!!t.endDate)&&e.jsx(S,{label:`Date: ${k(t.startDate)} - ${k(t.endDate)}`,size:"small",onDelete:m})]})}function ye({dense:t,action:o,rowCount:u,numSelected:i,onSelectAllRows:a,sx:c,...r}){return i?e.jsxs(C,{sx:{position:"absolute",zIndex:9,top:16,right:16,display:"flex",alignItems:"center",gap:1,p:1.5,borderRadius:1,bgcolor:"primary.main",color:"primary.contrastText",...c},...r,children:[e.jsxs(D,{variant:"filled",color:"default",sx:{color:"primary.contrastText",bgcolor:"primary.darker"},children:[i," selected"]}),o&&o]}):null}function Se(){const t=K(),o=N(),{user:u}=B(),i=[{id:"id",label:"Ticket ID",width:140},{id:"title",label:"Subject",width:250},{id:"creator",label:"Created By",width:180},{id:"status",label:"Status",width:120},{id:"unread_count",label:"Unread",width:100},{id:"created_at",label:"Created Date",width:140},{id:"",width:88}],a=re({defaultOrderBy:"created_at",defaultOrder:"desc"}),c=G(),[r,m]=p.useState([]);p.useEffect(()=>{u&&(async()=>{try{const l=await ne();m(l.data)}catch{m([])}})()},[u]);const T=J({name:"",status:"all",startDate:null,endDate:null}),{state:n,setState:h}=T,b=Q(n.startDate,n.endDate),d=ke({inputData:r,comparator:le(a.order,a.orderBy),filters:n,dateError:b}),f=ce(d,a.page,a.rowsPerPage),v=!!n.name||n.status!=="all"||!!n.startDate&&!!n.endDate,L=!d.length&&v||!d.length,R=s=>r.filter(l=>l.status===s).length,E=[{value:"all",label:"All",color:"default",count:r.length},{value:"open",label:"Open",color:"success",count:R("open")},{value:"closed",label:"Closed",color:"default",count:R("closed")}],W=p.useCallback(s=>{const l=r.filter(U=>U.id!==s);I.success("Support ticket deleted successfully"),m(l),a.onUpdatePageDeleteRow(f.length)},[f.length,a,r]),z=p.useCallback(()=>{const s=r.filter(l=>!a.selected.includes(l.id));I.success("Support tickets deleted successfully"),m(s),a.onUpdatePageDeleteRows(f.length,d.length)},[d.length,f.length,a,r]),O=p.useCallback((s,l)=>{a.onResetPage(),h({status:l})},[h,a]),P=p.useCallback((s,l)=>{a.onResetPage(),h({[s]:l})},[h,a]),$=p.useCallback(s=>{o.push(w.dashboard.supportTicket.details(s))},[o]);return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx(q,{value:n.status,onChange:O,sx:{px:2.5,boxShadow:`inset 0 -2px 0 0 ${M(t.vars.palette.grey["500Channel"],.08)}`},children:E.map(s=>e.jsx(X,{iconPosition:"end",value:s.value,label:s.label,icon:e.jsx(D,{variant:(s.value==="all"||s.value===n.status)&&"filled"||"soft",color:s.color,children:s.count})},s.value))}),e.jsx(we,{filters:n,onFilters:P,dateError:b}),v&&e.jsx(De,{filters:n,onFilters:P,onResetFilters:()=>{h({name:"",status:"all",startDate:null,endDate:null})},results:d.length,sx:{p:2.5,pt:0}}),e.jsxs(C,{sx:{position:"relative"},children:[e.jsx(ye,{dense:a.dense,numSelected:a.selected.length,rowCount:d.length,onSelectAllRows:s=>a.onSelectAllRows(s,d.map(l=>l.id)),action:e.jsx(Y,{title:"Delete",children:e.jsx(_,{color:"primary",onClick:c.onTrue,children:e.jsx(y,{icon:"solar:trash-bin-minimalistic-bulk"})})})}),e.jsx(Z,{sx:{minHeight:444},children:e.jsxs(xe,{size:a.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(he,{order:a.order,orderBy:a.orderBy,headCells:i,rowCount:d.length,numSelected:a.selected.length,onSort:a.onSort,onSelectAllRows:s=>a.onSelectAllRows(s,d.map(l=>l.id))}),e.jsxs(ge,{children:[f.map(s=>e.jsx(Te,{row:s,selected:a.selected.includes(s.id),onSelectRow:()=>a.onSelectRow(s.id),onViewRow:()=>$(s.id),onDeleteRow:()=>W(s.id)},s.id)),e.jsx(ue,{height:a.dense?56:76,emptyRows:ie(a.page,a.rowsPerPage,d.length)}),e.jsx(de,{notFound:L})]})]})})]}),e.jsx(pe,{page:a.page,dense:a.dense,count:d.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,onRowsPerPageChange:a.onChangeRowsPerPage,onChangeDense:a.onChangeDense})]}),e.jsx(oe,{open:c.value,onClose:c.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",a.selected.length," "]})," items?"]}),action:e.jsx(F,{variant:"contained",color:"error",onClick:()=>{z(),c.onFalse()},children:"Delete"})})]})}function ke({inputData:t,comparator:o,filters:u,dateError:i}){const{name:a,status:c,startDate:r,endDate:m}=u,T=t.map((n,h)=>[n,h]);return T.sort((n,h)=>{const b=o(n[0],h[0]);return b!==0?b:n[1]-h[1]}),t=T.map(n=>n[0]),a&&(t=t.filter(n=>n.title.toLowerCase().indexOf(a.toLowerCase())!==-1||n.creator.name.toLowerCase().indexOf(a.toLowerCase())!==-1||n.creator.company_name?.toLowerCase().indexOf(a.toLowerCase())!==-1)),c!=="all"&&(t=t.filter(n=>n.status===c)),i||r&&m&&(t=t.filter(n=>ee(n.created_at,r,m))),t}function ve(){const{user:t}=B(),o=t?.role?.toLowerCase?.()==="admin";return e.jsxs(te,{children:[e.jsx(ae,{heading:"Support Tickets",links:[{name:"Dashboard",href:w.dashboard.root},{name:"sidebar.supportTickets",href:w.dashboard.supportTicket.root}],action:o?null:e.jsx(F,{component:se,href:w.dashboard.supportTicket.new,variant:"contained",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:"Create Support Ticket"}),sx:{mb:{xs:3,md:5}}}),e.jsx(Se,{})]})}function Me(){return e.jsx(ve,{})}export{Me as default};
