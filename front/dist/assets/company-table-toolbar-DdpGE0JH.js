import{r,i as w,s as y,e as f,u as E,w as T,a0 as j,p as N,j as a,B as v,bM as I,M as g,c as $,bI as A,I as C,bJ as M,bK as k}from"./index-BJkBHIXD.js";import{a as G}from"./index.esm-DG78EUPk.js";import{a as L}from"./zod-DbnPk1Kl.js";import{i as O}from"./rhf-phone-input-DvY4aKGv.js";import{F as x}from"./fields-wQ2IQIfM.js";import{s as _}from"./schema-utils-C_-d4BNQ.js";import{F as U}from"./form-provider-BYLnCB41.js";import{G as F}from"./Grid-D_Et280v.js";import{C as V}from"./Card-CU8jzKuK.js";import{S as D}from"./Stack-DSqJGNfN.js";import{o as q,s as S,l as z}from"./schemas-BaSQ7w8v.js";import{F as B,S as J}from"./Select-CM-FquqI.js";import{I as H,T as K}from"./TextField-BfOXJaKd.js";import{I as W}from"./InputAdornment-Cyf39fZQ.js";async function Y(e){const o=new URLSearchParams;e?.search&&o.append("search",e.search),e?.status&&e.status!=="all"&&o.append("status",e.status),e?.per_page&&o.append("per_page",e.per_page.toString()),e?.page&&o.append("page",e.page.toString()),e?.sort&&o.append("sort",e.sort),e?.order&&o.append("order",e.order);const s=`${f.companies.list}?${o.toString()}`;return{data:(await y.get(s)).data}}async function Q(e){const o=typeof f.companies.details=="function"?f.companies.details(e):f.companies.details;return(await y.get(o)).data}async function R(e){return await w(),(await y.post(f.companies.create,e)).data}async function X(e,o){const s=typeof f.companies.update=="function"?f.companies.update(e):f.companies.update;return await w(),(await y.put(s,o)).data}async function fe(e){const o=typeof f.companies.delete=="function"?f.companies.delete(e):f.companies.delete;await w(),await y.delete(o)}function be(e){const[o,s]=r.useState([]),[d,i]=r.useState(!0),[p,m]=r.useState(null),[b,t]=r.useState({currentPage:1,perPage:15,total:0,lastPage:1}),n=JSON.stringify(e),u=r.useCallback(async()=>{try{i(!0),m(null);const h=n?JSON.parse(n):void 0,c=await Y(h),P=c.data.data.map(l=>({id:l.id,name:l.name,email:l.email,phoneNumber:l.phone||"",address:`${l.address||""}, ${l.city||""}, ${l.state||""}, ${l.zip_code||""}`.replace(/(^[,\s]+)|([,\s]+$)/g,""),status:l.is_active===1?"active":l.is_active===2?"pending":(l.is_active===0,"banned"),createdAt:l.created_at,isVerified:!!l.email_verified_at}));s(P),t({currentPage:c.data.current_page,perPage:c.data.per_page,total:c.data.total,lastPage:c.data.last_page})}catch(h){console.error("Failed to fetch companies:",h),m(h instanceof Error?h.message:"Failed to fetch companies"),s([])}finally{i(!1)}},[n]);return r.useEffect(()=>{u()},[u]),{companies:o,loading:d,error:p,pagination:b,refetch:u}}function xe(e){const[o,s]=r.useState(null),[d,i]=r.useState(!0),[p,m]=r.useState(null);return r.useEffect(()=>{async function b(){try{i(!0),m(null);const t=await Q(e),n={id:t.id,name:t.name,email:t.email,phoneNumber:t.phone||"",address:`${t.address||""}, ${t.city||""}, ${t.state||""}, ${t.zip_code||""}`.replace(/(^[,\s]+)|([,\s]+$)/g,""),status:t.is_active===1?"active":t.is_active===2?"pending":"banned",createdAt:t.created_at,isVerified:!!t.email_verified_at};s(n)}catch(t){console.error("Failed to fetch company:",t),m(t instanceof Error?t.message:"Failed to fetch company"),s(null)}finally{i(!1)}}e&&b()},[e]),{company:o,loading:d,error:p}}const Z=q({name:S().min(1,{message:"Company name is required!"}),email:_.email(),password:S().min(8,{message:"Password must be at least 8 characters"}).optional().or(z("")),phoneNumber:_.phoneNumber({isValid:O}).optional(),address:S().min(1,{message:"Address is required!"}),status:S().min(1,{message:"Status is required!"})});function ge({currentCompany:e}){const o=E(),{t:s}=T("navbar"),d={status:"pending",name:"",email:"",password:"",phoneNumber:"",address:""},i=G({mode:"onSubmit",resolver:L(Z),defaultValues:d,values:e}),{reset:p,handleSubmit:m,formState:{isSubmitting:b}}=i,t=m(async n=>{try{const u={active:1,pending:2,banned:3},h={name:n.name,email:n.email,phone:n.phoneNumber||void 0,address:n.address,is_active:u[n.status]||2,company_name:n.name};n.password&&n.password.trim()!==""&&(h.password=n.password),e?(await X(e.id,h),j.success(s("dashboard.company.companyUpdated"))):(await R(h),j.success(s("dashboard.company.companyCreated"))),p(),o.push(N.dashboard.company.list)}catch(u){console.error("Error saving company:",u),j.error(u instanceof Error?u.message:s("dashboard.company.failedToSave"))}});return a.jsx(U,{methods:i,onSubmit:t,children:a.jsx(F,{container:!0,spacing:3,children:a.jsx(F,{size:{xs:12},children:a.jsxs(V,{sx:{p:3},children:[a.jsxs(v,{sx:{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[a.jsx(x.Text,{name:"name",label:s("dashboard.company.companyName")}),a.jsx(x.Text,{name:"email",label:s("dashboard.company.emailAddress")}),a.jsx(x.Text,{name:"password",label:s("dashboard.company.password"),type:"password",placeholder:s(e?"dashboard.company.passwordPlaceholderEdit":"dashboard.company.passwordPlaceholder"),helperText:e?s("dashboard.company.passwordHelperText"):void 0}),a.jsx(x.Phone,{name:"phoneNumber",label:s("dashboard.company.phoneNumber"),defaultCountry:"US"}),a.jsx(x.Select,{name:"status",label:s("dashboard.company.status"),placeholder:s("dashboard.company.selectStatus"),children:I.map(n=>a.jsx(g,{value:n.value,children:n.label},n.value))}),a.jsx(x.Text,{name:"address",label:s("dashboard.company.address"),sx:{gridColumn:"1 / -1"}})]}),a.jsx(D,{sx:{mt:3,alignItems:"flex-end"},children:a.jsx($,{type:"submit",variant:"contained",loading:b,children:s(e?"dashboard.company.saveChanges":"dashboard.company.createCompany")})})]})})})})}function ee({filters:e,statusOptions:o,onResetPage:s}){const{t:d}=T("navbar"),i=A(),{state:p,setState:m}=e,[b,t]=r.useState(p.name);r.useEffect(()=>{t(p.name)},[p.name]),r.useEffect(()=>{const c=setTimeout(()=>{b!==p.name&&(s(),m({name:b}))},500);return()=>clearTimeout(c)},[b,p.name,s,m]);const n=r.useCallback(c=>{t(c.target.value)},[]),u=r.useCallback(c=>{s(),m({status:c.target.value})},[s,m]),h=()=>a.jsx(M,{open:i.open,anchorEl:i.anchorEl,onClose:i.onClose,slotProps:{arrow:{placement:"right-top"}},children:a.jsxs(k,{children:[a.jsxs(g,{onClick:()=>i.onClose(),children:[a.jsx(C,{icon:"solar:printer-minimalistic-bold"}),d("dashboard.company.print")]}),a.jsxs(g,{onClick:()=>i.onClose(),children:[a.jsx(C,{icon:"solar:import-bold"}),d("dashboard.company.import")]}),a.jsxs(g,{onClick:()=>i.onClose(),children:[a.jsx(C,{icon:"solar:export-bold"}),d("dashboard.company.export")]})]})});return a.jsxs(a.Fragment,{children:[a.jsxs(v,{sx:{p:2.5,gap:2,display:"flex",pr:{xs:2.5,md:1},flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"}},children:[a.jsxs(B,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[a.jsx(H,{htmlFor:"filter-status-select",children:d("dashboard.company.status")}),a.jsx(J,{label:d("dashboard.company.status"),value:p.status,onChange:u,inputProps:{id:"filter-status-select"},MenuProps:{slotProps:{paper:{sx:{maxHeight:240}}}},children:o.map(c=>a.jsx(g,{value:c.value,children:c.label},c.value))})]}),a.jsx(v,{sx:{gap:2,width:1,flexGrow:1,display:"flex",alignItems:"center"},children:a.jsx(K,{fullWidth:!0,value:b,onChange:n,placeholder:d("dashboard.company.searchCompanies"),slotProps:{input:{startAdornment:a.jsx(W,{position:"start",children:a.jsx(C,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}})})]}),h()]})}const ye=r.memo(ee);export{ge as C,be as a,ye as b,fe as d,xe as u};
