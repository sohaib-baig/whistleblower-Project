import{w as V,u as L,a2 as y,a0 as p,p as q,j as r,B as l,T as j,M as h,a3 as G,c as M,d as c}from"./index-BJkBHIXD.js";import{a as w}from"./index.esm-DG78EUPk.js";import{a as P}from"./zod-DbnPk1Kl.js";import{i as R}from"./rhf-phone-input-DvY4aKGv.js";import{f as k}from"./format-number-BErDzwe7.js";import{F as s}from"./fields-wQ2IQIfM.js";import{s as u}from"./schema-utils-C_-d4BNQ.js";import{F as B}from"./form-provider-BYLnCB41.js";import{G as b}from"./Grid-D_Et280v.js";import{C as H}from"./Card-CU8jzKuK.js";import{S as E}from"./Stack-DSqJGNfN.js";import{o as g,b as T,s as o,c as v}from"./schemas-BaSQ7w8v.js";function re({currentUser:m,onSaveSuccess:C,showOnlyReportingFields:t=!1}){const{t:a}=V("navbar"),F=L(),f=(e,d)=>{if(e){if(c.isDayjs(e))return e.format("HH:mm");if(typeof e=="string"){if(/^\d{2}:\d{2}$/.test(e))return e;if(d==="12h"||typeof e=="string"&&(e.includes("AM")||e.includes("PM"))){const n=c(e,"hh:mm A");if(n.isValid())return n.format("HH:mm")}if(typeof e=="string"&&e.includes("T")){const n=e.match(/T(\d{2}):(\d{2})/);if(n)return`${n[1]}:${n[2]}`}const x=c(e);if(x.isValid())return x.format("HH:mm")}}},S=t?g({physicalAddress:o().optional(),phoneHoursFrom:o().optional(),phoneHoursTo:o().optional(),phoneHoursFormat:v(["12h","24h"]).optional(),userLanguage:o().optional(),avatarUrl:u.file().optional(),name:o().optional(),email:o().optional(),phoneNumber:o().optional(),country:o().nullable().optional(),address:o().optional(),company:o().optional(),companyNumber:o().optional(),state:o().optional(),city:o().optional(),role:o().optional(),zipCode:o().optional(),status:o().optional(),isVerified:T().optional()}):g({avatarUrl:u.file().optional(),name:o().min(1,{error:a("dashboard.user.validation.nameRequired")}),email:u.email(),phoneNumber:u.phoneNumber({isValid:R}),country:u.nullableInput(o().min(1,{error:a("dashboard.user.validation.countryRequired")}),{error:a("dashboard.user.validation.countryRequired")}),address:o().min(1,{error:a("dashboard.user.validation.addressRequired")}),physicalAddress:o().optional(),phoneHoursFrom:o().optional(),phoneHoursTo:o().optional(),phoneHoursFormat:v(["12h","24h"]).optional(),userLanguage:o().optional(),company:o().min(1,{error:a("dashboard.user.validation.companyRequired")}),companyNumber:o().optional(),state:o().min(1,{error:a("dashboard.user.validation.stateRequired")}),city:o().min(1,{error:a("dashboard.user.validation.cityRequired")}),role:o().min(1,{error:a("dashboard.user.validation.roleRequired")}),zipCode:o().min(1,{error:a("dashboard.user.validation.zipCodeRequired")}),status:o(),isVerified:T()}),A={status:"",avatarUrl:null,isVerified:!0,name:"",email:"",phoneNumber:"",country:"",state:"",city:"",address:"",physicalAddress:"",phoneHoursFrom:"",phoneHoursTo:"",phoneHoursFormat:"24h",userLanguage:"en",zipCode:"",company:"",companyNumber:"",role:""},i=w({mode:"onSubmit",resolver:P(S),defaultValues:A,values:m}),{handleSubmit:N,formState:{isSubmitting:U}}=i,z=N(async e=>{try{m?(t?await y(m.id,{physicalAddress:e.physicalAddress||void 0,phoneHoursFrom:f(e.phoneHoursFrom,e.phoneHoursFormat),phoneHoursTo:f(e.phoneHoursTo,e.phoneHoursFormat)}):await y(m.id,{name:e.name,email:e.email,phoneNumber:e.phoneNumber,country:e.country||void 0,address:e.address,phoneHoursFormat:e.phoneHoursFormat||void 0,userLanguage:e.userLanguage||void 0,state:e.state,city:e.city,zipCode:e.zipCode,company:e.company,companyNumber:e.companyNumber,role:e.role,avatar:e.avatarUrl instanceof File?e.avatarUrl:void 0}),p.success(a("dashboard.user.toast.updateSuccess")),C?.()):(await new Promise(d=>setTimeout(d,500)),p.success(a("dashboard.user.toast.createSuccess")),F.push(q.dashboard.user.list))}catch(d){console.error(d),p.error(a("dashboard.user.toast.saveError"))}});return r.jsx(B,{methods:i,onSubmit:z,children:r.jsxs(b,{container:!0,spacing:3,children:[!t&&r.jsx(b,{size:{xs:12,md:4},children:r.jsx(H,{sx:{pt:10,pb:5,px:3},children:r.jsxs(l,{sx:{mb:5},children:[r.jsx(j,{variant:"subtitle2",sx:{mb:2,textAlign:"center",fontWeight:600},children:a("dashboard.user.form.companyLogo")}),r.jsx(s.UploadAvatar,{name:"avatarUrl",maxSize:3145728,helperText:r.jsxs(j,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:[a("dashboard.user.form.avatarAllowed"),r.jsx("br",{})," ",a("dashboard.user.form.avatarMaxSize")," ",k(3145728)]})})]})})}),r.jsx(b,{size:{xs:12,md:t?12:8},children:r.jsxs(H,{sx:{p:3},children:[!t&&r.jsxs(l,{sx:{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[r.jsx(s.Text,{name:"name",label:a("dashboard.user.form.fullName")}),r.jsx(s.Text,{name:"email",label:a("dashboard.user.form.emailAddress"),disabled:!0}),r.jsx(s.Phone,{name:"phoneNumber",label:a("dashboard.user.form.phoneNumber"),defaultCountry:"US"}),r.jsx(s.CountrySelect,{fullWidth:!0,name:"country",label:a("dashboard.user.form.country"),placeholder:a("dashboard.user.form.chooseCountry")}),r.jsx(s.Text,{name:"state",label:a("dashboard.user.form.stateRegion")}),r.jsx(s.Text,{name:"city",label:a("dashboard.user.form.city")}),r.jsx(s.Text,{name:"address",label:a("dashboard.user.form.address")}),r.jsx(s.Text,{name:"zipCode",label:a("dashboard.user.form.zipCode")}),r.jsx(s.Text,{name:"company",label:a("dashboard.user.form.company")}),r.jsx(s.Text,{name:"companyNumber",label:a("dashboard.user.form.companyNumber")}),r.jsx(s.Text,{name:"role",label:a("dashboard.user.form.role"),disabled:!0})]}),!t&&r.jsxs(l,{sx:{mt:3,rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[r.jsxs(s.Select,{name:"phoneHoursFormat",label:a("dashboard.user.form.phoneHoursFormat"),children:[r.jsx(h,{value:"24h",children:"24 Hours"}),r.jsx(h,{value:"12h",children:"12 Hours (AM/PM)"})]}),r.jsx(s.Select,{name:"userLanguage",label:a("dashboard.user.form.userLanguage")||"User Language",children:G.map(e=>r.jsx(h,{value:e.value,children:e.label},e.value))})]}),t&&r.jsxs(r.Fragment,{children:[r.jsx(l,{sx:{mt:t?0:3},children:r.jsx(s.Text,{name:"physicalAddress",label:a("dashboard.user.form.physicalAddress"),multiline:!0,rows:4,fullWidth:!0})}),r.jsxs(l,{sx:{mt:3,rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[r.jsx(s.TimePicker,{name:"phoneHoursFrom",label:a("dashboard.user.form.phoneHoursFrom"),ampm:i.watch("phoneHoursFormat")==="12h",format:i.watch("phoneHoursFormat")==="12h"?"hh:mm A":"HH:mm"}),r.jsx(s.TimePicker,{name:"phoneHoursTo",label:a("dashboard.user.form.phoneHoursTo"),ampm:i.watch("phoneHoursFormat")==="12h",format:i.watch("phoneHoursFormat")==="12h"?"hh:mm A":"HH:mm"})]})]}),r.jsx(E,{sx:{mt:3,alignItems:"flex-end"},children:r.jsx(M,{type:"submit",variant:"contained",loading:U,children:a(m?"dashboard.user.form.saveChanges":"dashboard.user.form.createUser")})})]})})]})})}export{re as U};
