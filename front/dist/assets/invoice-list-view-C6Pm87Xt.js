import{j as e,B as g,I as u,b as N,U as J,T as ue,w as G,bI as Q,a4 as q,al as me,bO as B,L as be,y as R,bS as O,bQ as V,bP as X,a7 as w,bJ as Z,bK as ee,M as D,a6 as se,c as _,r as p,cC as ve,bT as je,V as ge,bR as fe,cD as ye,a0 as L,W as Ce,aa as De,p as T,ab as z,J as Se,K as Te,cE as we,ah as k,cF as ke}from"./index-BJkBHIXD.js";import{C as ae}from"./confirm-dialog-D488U7AY.js";import{u as Ie,e as Pe,T as Fe}from"./table-no-data-BKo9R2Zy.js";import{T as Re}from"./table-empty-rows-BDBaI17h.js";import{T as Ae}from"./table-head-custom-C2dATJUG.js";import{T as Ee}from"./table-selected-action-uAaUSqFj.js";import{T as Be}from"./table-pagination-custom-Dom7EZhX.js";import{a as Le,b as te}from"./format-number-BErDzwe7.js";import{T as oe,a as j,b as He,c as _e}from"./TableHead-D9jAElFw.js";import{C as ne}from"./FormControlLabel-Do9AncA_.js";import{F as Me,S as We}from"./Select-CM-FquqI.js";import{I as Ye,f as Ne,T as Oe}from"./TextField-BfOXJaKd.js";import{D as $}from"./DatePicker-D3hVcc_W.js";import{I as Ve}from"./InputAdornment-Cyf39fZQ.js";import{F as ze,a as I,c as P}from"./filters-result-8ZMjXTco.js";import{C as F}from"./Chip-Cd7PxQUv.js";import{C as K}from"./Card-CU8jzKuK.js";import{S as $e}from"./Stack-DSqJGNfN.js";import{s as U}from"./invoice-pdf-y8A2rGXB.js";function H({title:a,total:m,icon:c,color:d,percent:r,price:l}){return e.jsxs(g,{sx:{width:1,gap:2.5,minWidth:200,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsxs(g,{sx:{display:"flex",position:"relative",alignItems:"center",justifyContent:"center"},children:[e.jsx(u,{icon:c,width:32,sx:{color:d,position:"absolute"}}),e.jsx(N,{size:56,thickness:2,value:r,variant:"determinate",sx:{color:d,opacity:.48}}),e.jsx(N,{size:56,value:100,thickness:3,variant:"determinate",sx:[s=>({top:0,left:0,opacity:.48,position:"absolute",color:J(s.vars.palette.grey["500Channel"],.16)})]})]}),e.jsxs("div",{children:[e.jsx(ue,{variant:"subtitle1",children:a}),e.jsxs(g,{component:"span",sx:{my:.5,display:"block",typography:"body2",color:"text.disabled"},children:[Le(m)," invoices"]}),e.jsx(g,{component:"span",sx:{typography:"subtitle2"},children:te(l)})]})]})}function Ke({row:a,selected:m,editHref:c,onSelectRow:d,onDeleteRow:r,detailsHref:l,canManageInvoices:s=!0}){const{t:x}=G("navbar"),o=Q(),v=q(),f=()=>e.jsx(Z,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[e.jsx("li",{children:e.jsxs(D,{component:R,href:l,onClick:o.onClose,children:[e.jsx(u,{icon:"solar:eye-bold"}),x("dashboard.invoice.view")]})}),s&&e.jsx("li",{children:e.jsxs(D,{component:R,href:c,onClick:o.onClose,children:[e.jsx(u,{icon:"solar:pen-bold"}),x("dashboard.invoice.edit")]})}),s&&e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:{borderStyle:"dashed"}}),e.jsxs(D,{onClick:()=>{v.onTrue(),o.onClose()},sx:{color:"error.main"},children:[e.jsx(u,{icon:"solar:trash-bin-trash-bold"}),x("dashboard.invoice.delete")]})]})]})}),b=()=>e.jsx(ae,{open:v.value,onClose:v.onFalse,title:x("dashboard.invoice.deleteConfirmTitle"),content:x("dashboard.invoice.deleteConfirmMessage"),action:e.jsx(_,{variant:"contained",color:"error",onClick:r,children:x("dashboard.invoice.delete")})});return e.jsxs(e.Fragment,{children:[e.jsxs(oe,{hover:!0,selected:m,children:[e.jsx(j,{padding:"checkbox",children:e.jsx(ne,{checked:m,onClick:d,slotProps:{input:{id:`${a.id}-checkbox`,"aria-label":`${a.id} checkbox`}}})}),e.jsx(j,{children:e.jsxs(g,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(me,{alt:a.invoiceTo.name,children:a.invoiceTo.name.charAt(0).toUpperCase()}),e.jsx(B,{primary:a.invoiceTo.name,secondary:e.jsx(be,{component:R,href:l,color:"inherit",children:a.invoiceNumber}),slotProps:{primary:{noWrap:!0,sx:{typography:"body2"}},secondary:{sx:{color:"text.disabled","&:hover":{color:"text.secondary"}}}}})]})}),e.jsx(j,{children:e.jsx(B,{primary:V(a.createDate),secondary:O(a.createDate),slotProps:{primary:{noWrap:!0,sx:{typography:"body2"}},secondary:{sx:{mt:.5,typography:"caption"}}}})}),e.jsx(j,{children:e.jsx(B,{primary:V(a.dueDate),secondary:O(a.dueDate),slotProps:{primary:{noWrap:!0,sx:{typography:"body2"}},secondary:{sx:{mt:.5,typography:"caption"}}}})}),e.jsx(j,{children:te(a.totalAmount)}),e.jsx(j,{align:"center",children:a.sent}),e.jsx(j,{children:e.jsx(X,{variant:"soft",color:a.status==="paid"&&"success"||a.status==="pending"&&"warning"||"default",children:a.status})}),e.jsx(j,{align:"right",sx:{px:1},children:s&&e.jsx(w,{color:o.open?"inherit":"default",onClick:o.onOpen,children:e.jsx(u,{icon:"eva:more-vertical-fill"})})})]}),f(),b()]})}function Ue({filters:a,options:m,dateError:c,onResetPage:d}){const r=Q(),{state:l,setState:s}=a,x=p.useCallback(n=>{d(),s({name:n.target.value})},[d,s]),o=p.useCallback(n=>{const y=typeof n.target.value=="string"?n.target.value.split(","):n.target.value;d(),s({service:y})},[d,s]),v=p.useCallback(n=>{d(),s({startDate:n})},[d,s]),f=p.useCallback(n=>{d(),s({endDate:n})},[d,s]),b=()=>e.jsx(Z,{open:r.open,anchorEl:r.anchorEl,onClose:r.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[e.jsxs(D,{onClick:()=>r.onClose(),children:[e.jsx(u,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),e.jsxs(D,{onClick:()=>r.onClose(),children:[e.jsx(u,{icon:"solar:import-bold"}),"Import"]}),e.jsxs(D,{onClick:()=>r.onClose(),children:[e.jsx(u,{icon:"solar:export-bold"}),"Export"]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(g,{sx:{p:2.5,gap:2,display:"flex",pr:{xs:2.5,md:1},flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"}},children:[e.jsxs(Me,{sx:{flexShrink:0,width:{xs:1,md:180}},children:[e.jsx(Ye,{htmlFor:"filter-service-select",children:"Service"}),e.jsx(We,{multiple:!0,label:"Service",value:l.service,onChange:o,renderValue:n=>n.map(y=>y).join(", "),inputProps:{id:"filter-service-select"},MenuProps:{slotProps:{paper:{sx:{maxHeight:240}}}},children:m.services.map(n=>e.jsxs(D,{value:n,children:[e.jsx(ne,{disableRipple:!0,size:"small",checked:l.service.includes(n),slotProps:{input:{id:`${n}-checkbox`}}}),n]},n))})]}),e.jsx($,{label:"Start date",value:l.startDate,onChange:v,sx:{maxWidth:{md:180}}}),e.jsx($,{label:"End date",value:l.endDate,onChange:f,slotProps:{textField:{error:c,helperText:c?"End date must be later than start date":null}},sx:{maxWidth:{md:180},[`& .${Ne.root}`]:{bottom:{md:-40},position:{md:"absolute"}}}}),e.jsx(g,{sx:{gap:2,width:1,flexGrow:1,display:"flex",alignItems:"center"},children:e.jsx(Oe,{fullWidth:!0,value:l.name,onChange:x,placeholder:"Search customer or invoice number...",slotProps:{input:{startAdornment:e.jsx(Ve,{position:"start",children:e.jsx(u,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}})})]}),b()]})}function Je({filters:a,totalResults:m,onResetPage:c,sx:d}){const{state:r,setState:l,resetState:s}=a,x=p.useCallback(()=>{c(),l({name:""})},[c,l]),o=p.useCallback(b=>{const n=r.service.filter(y=>y!==b);c(),l({service:n})},[c,l,r.service]),v=p.useCallback(()=>{c(),l({status:"all"})},[c,l]),f=p.useCallback(()=>{c(),l({startDate:null,endDate:null})},[c,l]);return e.jsxs(ze,{totalResults:m,onReset:()=>s(),sx:d,children:[e.jsx(I,{label:"Service:",isShow:!!r.service.length,children:r.service.map(b=>p.createElement(F,{...P,key:b,label:b,onDelete:()=>o(b)}))}),e.jsx(I,{label:"Status:",isShow:r.status!=="all",children:e.jsx(F,{...P,label:r.status,onDelete:v,sx:{textTransform:"capitalize"}})}),e.jsx(I,{label:"Date:",isShow:!!(r.startDate&&r.endDate),children:e.jsx(F,{...P,label:ve(r.startDate,r.endDate),onDelete:f})}),e.jsx(I,{label:"Keyword:",isShow:!!r.name,children:e.jsx(F,{...P,label:r.name,onDelete:x})})]})}function us(){const{t:a}=G("navbar"),m=je(),{user:c}=ge(),d=[{id:"invoiceNumber",label:a("dashboard.invoice.tableHeaders.customer"),width:220},{id:"createDate",label:a("dashboard.invoice.tableHeaders.create"),width:150},{id:"dueDate",label:a("dashboard.invoice.tableHeaders.due"),width:150},{id:"price",label:a("dashboard.invoice.tableHeaders.amount"),width:120},{id:"sent",label:a("dashboard.invoice.tableHeaders.sent"),width:100,align:"center"},{id:"status",label:a("dashboard.invoice.tableHeaders.status"),width:120},{id:"",width:88}],l=c?.role?.toLowerCase()==="admin",s=Ie({defaultOrderBy:"created_at",defaultOrder:"desc"}),x=q(),[o,v]=p.useState([]),[f,b]=p.useState(!0),[n,y]=p.useState({current_page:1,per_page:15,total:0,last_page:1}),A=fe({name:"",service:[],status:"all",startDate:null,endDate:null}),{state:h,setState:M}=A;p.useEffect(()=>{(async()=>{if(!c){b(!1);return}try{b(!0);const i=await ke({status:h.status!=="all"?h.status:void 0,search:h.name||void 0,start_date:h.startDate?.format("YYYY-MM-DD")||void 0,end_date:h.endDate?.format("YYYY-MM-DD")||void 0,per_page:s.rowsPerPage,page:s.page+1,sort_by:s.orderBy||"created_at",sort_order:s.order||"desc"});v(i.data),y(i.pagination)}catch(i){console.error("Error fetching invoices:",i),L.error(i?.message||a("dashboard.invoice.failedToLoad")),v([])}finally{b(!1)}})()},[c,h.status,h.name,h.startDate,h.endDate,s.page,s.rowsPerPage,s.orderBy,s.order,a]);const re=ye(h.startDate,h.endDate),E=o,C=o,le=!!h.name||h.service.length>0||h.status!=="all"||!!h.startDate&&!!h.endDate,S=t=>o.filter(i=>i.status===t).length,W=t=>U(o.filter(i=>i.status===t),i=>i.totalAmount),Y=t=>S(t)/o.length*100,ie=[{value:"all",label:a("dashboard.invoice.tabs.all"),color:"default",count:o.length},{value:"paid",label:a("dashboard.invoice.tabs.paid"),color:"success",count:S("paid")},{value:"pending",label:a("dashboard.invoice.tabs.pending"),color:"warning",count:S("pending")}],ce=p.useCallback(t=>{const i=o.filter(xe=>xe.id!==t);L.success(a("dashboard.invoice.deleteSuccess")),v(i),s.onUpdatePageDeleteRow(C.length)},[C.length,s,o,a]),de=p.useCallback(()=>{const t=o.filter(i=>!s.selected.includes(i.id));L.success(a("dashboard.invoice.deleteSuccess")),v(t),s.onUpdatePageDeleteRows(C.length,n.total)},[C.length,n.total,s,o,a]),he=p.useCallback((t,i)=>{s.onResetPage(),M({status:i})},[M,s]),pe=()=>e.jsx(ae,{open:x.value,onClose:x.onFalse,title:a("dashboard.invoice.deleteConfirmTitle"),content:e.jsxs(e.Fragment,{children:[a("dashboard.invoice.deleteConfirmMessagePlural")," ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," ",a("dashboard.invoice.items"),"?"]}),action:e.jsx(_,{variant:"contained",color:"error",onClick:()=>{de(),x.onFalse()},children:a("dashboard.invoice.delete")})});return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{children:[e.jsx(De,{heading:a("dashboard.invoice.list"),links:[{name:"Dashboard",href:T.dashboard.root},{name:a("dashboard.invoice.heading"),href:T.dashboard.invoice.root},{name:a("dashboard.invoice.list")}],action:l?e.jsx(_,{component:R,href:T.dashboard.invoice.new,variant:"contained",startIcon:e.jsx(u,{icon:"mingcute:add-line"}),children:a("dashboard.invoice.addInvoice")}):null,sx:{mb:{xs:3,md:5}}}),e.jsx(K,{sx:{mb:{xs:3,md:5}},children:e.jsx(z,{sx:{minHeight:108},children:e.jsxs($e,{divider:e.jsx(se,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:2,flexDirection:"row"},children:[e.jsx(H,{title:a("dashboard.invoice.analytics.total"),total:o.length,percent:100,price:U(o,t=>t.totalAmount),icon:"solar:bill-list-bold-duotone",color:m.vars.palette.info.main}),e.jsx(H,{title:a("dashboard.invoice.analytics.paid"),total:S("paid"),percent:Y("paid"),price:W("paid"),icon:"solar:file-check-bold-duotone",color:m.vars.palette.success.main}),e.jsx(H,{title:a("dashboard.invoice.analytics.pending"),total:S("pending"),percent:Y("pending"),price:W("pending"),icon:"solar:sort-by-time-bold-duotone",color:m.vars.palette.warning.main})]})})}),e.jsxs(K,{children:[e.jsx(Se,{value:h.status,onChange:he,sx:{px:{md:2.5},boxShadow:`inset 0 -2px 0 0 ${J(m.vars.palette.grey["500Channel"],.08)}`},children:ie.map(t=>e.jsx(Te,{value:t.value,label:t.label,iconPosition:"end",icon:e.jsx(X,{variant:(t.value==="all"||t.value===h.status)&&"filled"||"soft",color:t.color,children:t.count})},t.value))}),e.jsx(Ue,{filters:A,dateError:re,onResetPage:s.onResetPage,options:{services:we.map(t=>t.name)}}),le&&e.jsx(Je,{filters:A,onResetPage:s.onResetPage,totalResults:E.length,sx:{p:2.5,pt:0}}),e.jsxs(g,{sx:{position:"relative"},children:[e.jsx(Ee,{dense:s.dense,numSelected:s.selected.length,rowCount:E.length,onSelectAllRows:t=>{s.onSelectAllRows(t,E.map(i=>i.id))},action:e.jsxs(g,{sx:{display:"flex"},children:[e.jsx(k,{title:a("dashboard.invoice.sent"),children:e.jsx(w,{color:"primary",children:e.jsx(u,{icon:"custom:send-fill"})})}),e.jsx(k,{title:a("dashboard.invoice.download"),children:e.jsx(w,{color:"primary",children:e.jsx(u,{icon:"solar:download-bold"})})}),e.jsx(k,{title:a("dashboard.invoice.print"),children:e.jsx(w,{color:"primary",children:e.jsx(u,{icon:"solar:printer-minimalistic-bold"})})}),e.jsx(k,{title:a("dashboard.invoice.delete"),children:e.jsx(w,{color:"primary",onClick:x.onTrue,children:e.jsx(u,{icon:"solar:trash-bin-trash-bold"})})})]})}),e.jsx(z,{sx:{minHeight:444},children:e.jsxs(He,{size:s.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(Ae,{order:s.order,orderBy:s.orderBy,headCells:d,rowCount:n.total,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:t=>s.onSelectAllRows(t,C.map(i=>i.id))}),e.jsx(_e,{children:f?e.jsx(oe,{children:e.jsx(j,{colSpan:d.length,align:"center",sx:{py:3},children:a("dashboard.invoice.loading")})}):e.jsxs(e.Fragment,{children:[C.map(t=>e.jsx(Ke,{row:t,selected:s.selected.includes(t.id),onSelectRow:()=>s.onSelectRow(t.id),onDeleteRow:()=>ce(t.id),editHref:T.dashboard.invoice.edit(t.id),detailsHref:T.dashboard.invoice.details(t.id),canManageInvoices:l},t.id)),e.jsx(Re,{height:s.dense?56:76,emptyRows:Pe(s.page,s.rowsPerPage,n.total)}),e.jsx(Fe,{notFound:!f&&!C.length})]})})]})})]}),e.jsx(Be,{page:s.page,dense:s.dense,count:n.total,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]}),pe()]})}export{us as I};
