import{w as _,u as q,r as v,a4 as y,a0 as S,p as G,j as e,B as a,T as o,a8 as J,a7 as C,I as w,a6 as K,a3 as N,M as m,a5 as O,c as x}from"./index-BJkBHIXD.js";import{a as Q}from"./index.esm-DG78EUPk.js";import{a as X}from"./zod-DbnPk1Kl.js";import{u as Y,a as Z}from"./support-trthRr6H.js";import{F as c}from"./fields-wQ2IQIfM.js";import{s as $}from"./schema-utils-C_-d4BNQ.js";import{F as ee}from"./form-provider-BYLnCB41.js";import{S as p}from"./Stack-DSqJGNfN.js";import{C as I}from"./Card-CU8jzKuK.js";import{C as te}from"./CardHeader-BmHD0Q2N.js";import{o as se,s as g}from"./schemas-BaSQ7w8v.js";const ae=n=>se({title:g().min(5,{message:n("dashboard.support.errors.titleMinLength")}),content:$.editor().min(20,{message:n("dashboard.support.errors.contentMinLength")}),status:g().optional(),language:g().optional()});function xe({isReportingLinkContext:n=!1}){const{t}=_("navbar"),b=q(),[i,k]=v.useState("en"),{data:r,isLoading:L,refetch:F}=Y(i),H=Z(),E=ae(t),l=y(),u=y(!0),T={title:"",content:"",status:"active",language:"en"},f=Q({mode:"all",resolver:X(E),defaultValues:T,values:r?{title:r.title,content:r.content,status:r.status||"active",language:r.language||i}:void 0}),{watch:B,setValue:M,handleSubmit:z,formState:{isSubmitting:D,isValid:j}}=f,d=B(),W=s=>{k(s),M("language",s),F()},P=z(async s=>{try{await H.mutateAsync({...s,language:i}),S.success(t(n?"dashboard.reportingLink.page3.updatedSuccessfully":"dashboard.support.toast.updatedSuccessfully"))}catch(h){console.error(h),S.error(t("dashboard.support.toast.updateFailed"))}}),V=v.useCallback(()=>{b.push(G.dashboard.support.root)},[b]),A=(s,h)=>e.jsx(C,{onClick:h,children:e.jsx(w,{icon:s?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})}),R=()=>e.jsxs(I,{children:[e.jsx(te,{title:t("dashboard.support.form.title"),subheader:t("dashboard.support.form.subheader"),action:A(u.value,u.onToggle),sx:{mb:3}}),e.jsx(K,{}),e.jsxs(p,{spacing:3,sx:{p:3},children:[e.jsx(c.Text,{name:"title",label:t("dashboard.support.form.titleLabel")}),e.jsx(c.Select,{name:"language",label:"Language",value:i,onChange:s=>W(s.target.value),children:N.map(s=>e.jsx(m,{value:s.value,children:s.label},s.value))}),e.jsxs(c.Select,{name:"status",label:t("dashboard.support.form.status"),placeholder:t("dashboard.support.form.selectStatus"),children:[e.jsx(m,{value:"active",children:t("dashboard.support.status.active")}),e.jsx(m,{value:"inactive",children:t("dashboard.support.status.inactive")})]}),e.jsx(O,{in:u.value,children:e.jsxs(p,{spacing:1.5,children:[e.jsx(o,{variant:"subtitle2",children:t("dashboard.support.form.content")}),e.jsx(c.Editor,{name:"content",fullItem:!0,sx:{maxHeight:600,"& .ql-editor":{minHeight:400}}}),e.jsx(o,{variant:"caption",color:"text.secondary",sx:{mt:1},children:t("dashboard.support.form.tip")})]})})]})]}),U=()=>e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-end",gap:2,p:2.5},children:[e.jsx(x,{color:"inherit",variant:"outlined",size:"medium",onClick:l.onTrue,disabled:!j,children:t("dashboard.support.actions.preview")}),e.jsx(x,{color:"inherit",variant:"outlined",size:"medium",onClick:V,children:t("dashboard.support.actions.cancel")}),e.jsx(x,{type:"submit",variant:"contained",size:"medium",loading:D,disabled:!j,children:t("dashboard.support.actions.saveChanges")})]});return L?e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(o,{children:t("dashboard.support.loading")})}):e.jsxs(ee,{methods:f,onSubmit:P,children:[e.jsxs(p,{spacing:5,sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[R(),U()]}),l.value&&e.jsx(J,{children:e.jsx(a,{onClick:l.onFalse,sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",p:2},children:e.jsxs(I,{onClick:s=>s.stopPropagation(),sx:{width:"100%",maxWidth:{xs:"95vw",sm:"90vw",md:"800px",lg:"1000px"},maxHeight:"90vh",display:"flex",flexDirection:"column",position:"relative"},children:[e.jsx(a,{sx:{p:2,borderBottom:1,borderColor:"divider",flexShrink:0},children:e.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(o,{variant:"h6",children:t("dashboard.support.actions.preview")}),e.jsx(C,{onClick:l.onFalse,children:e.jsx(w,{icon:"solar:close-circle-bold"})})]})}),e.jsxs(a,{sx:{p:3,overflow:"auto",flex:1},children:[d.title&&e.jsx(o,{variant:"h4",sx:{mb:2},children:d.title}),d.content?e.jsx(a,{sx:{"& h1, & h2, & h3, & h4, & h5, & h6":{color:"text.primary",fontWeight:600,mb:2,mt:3,"&:first-of-type":{mt:0}},"& p":{color:"text.secondary",lineHeight:1.7,mb:2},"& ul, & ol":{pl:3,mb:2,"& li":{color:"text.secondary",lineHeight:1.7,mb:.5}}},dangerouslySetInnerHTML:{__html:d.content}}):e.jsx(o,{variant:"body2",color:"text.secondary",children:t("dashboard.support.form.noContent")})]})]})})})]})}export{xe as S};
