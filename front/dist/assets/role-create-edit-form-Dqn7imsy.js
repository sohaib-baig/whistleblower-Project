import{r as f,j as e,T as C,P as A,u as B,a4 as y,bG as H,bH as P,a0 as O,p as U,a5 as w,a6 as F,c as q,a7 as _,I as G}from"./index-BJkBHIXD.js";import{a as N}from"./index.esm-DG78EUPk.js";import{a as J}from"./zod-DbnPk1Kl.js";import{F as K}from"./fields-wQ2IQIfM.js";import{s as Q}from"./schema-utils-C_-d4BNQ.js";import{F as X}from"./form-provider-BYLnCB41.js";import{T as z,a as m,b as Y,d as Z,c as $}from"./TableHead-D9jAElFw.js";import{F as M,C as R}from"./FormControlLabel-Do9AncA_.js";import{C as k}from"./Card-CU8jzKuK.js";import{T as ee}from"./TableContainer-D0zNvGRU.js";import{S as b}from"./Stack-DSqJGNfN.js";import{C as E}from"./CardHeader-BmHD0Q2N.js";import{o as j,a as W,s as u,b as se}from"./schemas-BaSQ7w8v.js";function re({module:r,onPermissionChange:c,onModuleChange:t}){const l=f.useCallback((s,d)=>{c(r.id,s,d)},[r.id,c]),p=f.useCallback(s=>{t(r.id,s)},[r.id,t]),a=r.permissions.every(s=>s.checked),n=r.permissions.some(s=>s.checked);return e.jsxs(z,{children:[e.jsx(m,{sx:{width:"200px"},children:e.jsx(M,{control:e.jsx(R,{checked:a,indeterminate:n&&!a,onChange:s=>p(s.target.checked),color:"primary",sx:{"&.Mui-checked":{color:"primary.main"}}}),label:e.jsx(C,{variant:"subtitle2",sx:{fontWeight:600,fontSize:"0.875rem",color:"text.primary"},children:r.name}),sx:{m:0,"& .MuiFormControlLabel-label":{ml:1}}})}),r.permissions.map(s=>e.jsx(m,{align:"center",children:e.jsx(M,{control:e.jsx(R,{checked:s.checked,onChange:d=>l(s.id,d.target.checked),color:"primary",sx:{"&.Mui-checked":{color:"primary.main"}}}),label:e.jsx(C,{variant:"body2",sx:{fontSize:"0.8rem",color:"text.secondary",fontWeight:400},children:s.name}),sx:{m:0,"& .MuiFormControlLabel-label":{ml:.5}}})},s.id))]})}function ie({modules:r,onPermissionChange:c,onModuleChange:t}){const l=f.useCallback((n,s,d)=>{c(n,s,d)},[c]),p=f.useCallback((n,s)=>{t(n,s)},[t]),a=r.length>0?r[0].permissions:[];return e.jsx(k,{variant:"outlined",sx:{borderRadius:0,border:"1px solid",borderColor:"divider",bgcolor:"background.paper",overflow:"hidden"},children:e.jsx(ee,{component:A,sx:{boxShadow:"none"},children:e.jsxs(Y,{sx:{minWidth:650},"aria-label":"role permissions table",children:[e.jsx(Z,{children:e.jsxs(z,{sx:{bgcolor:"grey.50"},children:[e.jsx(m,{sx:{fontWeight:600,fontSize:"0.875rem"},children:"Module"}),a.map(n=>e.jsx(m,{align:"center",sx:{fontWeight:600,fontSize:"0.875rem"},children:n.name},n.id)),e.jsx(m,{align:"center",sx:{fontWeight:600,fontSize:"0.875rem"},children:"Create"}),e.jsx(m,{align:"center",sx:{fontWeight:600,fontSize:"0.875rem"},children:"Update"}),e.jsx(m,{align:"center",sx:{fontWeight:600,fontSize:"0.875rem"},children:"Delete"})]})}),e.jsx($,{children:r.map(n=>e.jsx(re,{module:n,onPermissionChange:l,onModuleChange:p},n.id))})]})})})}const ne=j({title:u().min(1,{error:"Title is required!"}),content:Q.editor().min(100,{error:"Content must be at least 100 characters"}),permissions:W(j({id:u(),name:u(),permissions:W(j({id:u(),name:u(),checked:se()}))})).min(1,{error:"At least one permission is required!"})});function ge({currentRole:r}){const c=B(),t=y(!0),l=y(!0),p={title:"",content:"",permissions:H.map(o=>({id:o.id,name:o.name,permissions:o.id==="dashboard"?[P[0]].map(i=>({id:i.id,name:i.name,checked:!1})):P.slice(0,4).map(i=>({id:i.id,name:i.name,checked:!1}))}))},a=N({mode:"all",resolver:J(ne),defaultValues:p,values:r}),{reset:n,handleSubmit:s,formState:{isSubmitting:d}}=a,D=s(async o=>{try{await new Promise(i=>setTimeout(i,500)),n(),O.success(r?"Update success!":"Create success!"),c.push(U.dashboard.role.root),console.info("DATA",o)}catch(i){console.error(i)}}),S=(o,i)=>e.jsx(_,{onClick:i,children:e.jsx(G,{icon:o?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})}),L=()=>e.jsxs(k,{children:[e.jsx(E,{title:"Details",subheader:"Title, short description, image...",action:S(t.value,t.onToggle),sx:{mb:3}}),e.jsxs(w,{in:t.value,children:[e.jsx(F,{}),e.jsx(b,{spacing:3,sx:{p:3},children:e.jsxs(b,{spacing:1.5,children:[e.jsx(C,{variant:"subtitle2",children:"Title"}),e.jsx(K.Text,{name:"title",placeholder:"Ex: Software engineer..."})]})})]})]}),I=()=>e.jsxs(k,{children:[e.jsx(E,{title:"Permissions",subheader:"Set module permissions for this role...",action:S(l.value,l.onToggle),sx:{mb:3}}),e.jsxs(w,{in:l.value,children:[e.jsx(F,{}),e.jsx(ie,{modules:a.watch("permissions"),onPermissionChange:(o,i,v)=>{const h=a.getValues("permissions").map(x=>x.id===o?{...x,permissions:x.permissions.map(g=>g.id===i?{...g,checked:v}:g)}:x);a.setValue("permissions",h)},onModuleChange:(o,i)=>{const T=a.getValues("permissions").map(h=>h.id===o?{...h,permissions:h.permissions.map(x=>({...x,checked:i}))}:h);a.setValue("permissions",T)}})]})]}),V=()=>e.jsx(b,{sx:{alignItems:"flex-end"},children:e.jsx(q,{type:"submit",variant:"contained",size:"large",loading:d,sx:{ml:2},children:r?"Save changes":"Create role"})});return e.jsx(X,{methods:a,onSubmit:D,children:e.jsxs(b,{spacing:{xs:3,md:5},sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[L(),I(),V()]})})}export{ge as R};
