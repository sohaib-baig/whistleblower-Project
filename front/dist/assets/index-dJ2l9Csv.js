import{i as F,s as j,e as K,w,r as l,a0 as a,j as e,B as f,A as b,c as h,T as V,W as P,aa as W,p as x}from"./index-BJkBHIXD.js";import{a as B}from"./index.esm-DG78EUPk.js";import{a as D}from"./zod-DbnPk1Kl.js";import{F as m}from"./fields-wQ2IQIfM.js";import{F as G}from"./form-provider-BYLnCB41.js";import{S as R}from"./Stack-DSqJGNfN.js";import{o as q,s as g}from"./schemas-BaSQ7w8v.js";import{G as S}from"./Grid-D_Et280v.js";import{C as H}from"./Card-CU8jzKuK.js";import"./text-transform-DM798QSo.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./index-BdCJuPE0.js";import"./rhf-phone-input-DvY4aKGv.js";import"./index-CDpvdXdB.js";import"./search-not-found-BYtFGFNz.js";import"./InputAdornment-Cyf39fZQ.js";import"./rhf-text-field-D45rQogC.js";import"./RadioGroup-eX8WPtuC.js";import"./FormControlLabel-Do9AncA_.js";import"./Autocomplete-vOabT0lM.js";import"./Chip-Cd7PxQUv.js";import"./rhf-select-BCHEEYe2.js";import"./styles-B-zEs6qR.js";import"./format-number-BErDzwe7.js";import"./upload-default-BMHhCMpu.js";import"./tslib.es6-CTYbIaVE.js";import"./DatePicker-D3hVcc_W.js";async function A(){try{const r=(await j.get(K.stripeConfiguration.get)).data||{};return{clientId:r.stripe_client_id||"",secretKey:r.stripe_secret_key||"",productKey:r.stripe_webhook_secret||""}}catch(t){throw console.error("Failed to fetch Stripe configuration:",t),t}}async function N(t){try{await F();const r={stripe_client_id:t.clientId,stripe_secret_key:t.secretKey,stripe_webhook_secret:t.productKey};await j.put(K.stripeConfiguration.update,r)}catch(r){throw console.error("Failed to save Stripe configuration:",r),r}}async function z(t){try{if(!t.clientId||!t.secretKey||!t.productKey)return!1;const r=t.clientId.startsWith("pk_"),s=t.secretKey.startsWith("sk_"),n=t.productKey.startsWith("prod_")||t.productKey.startsWith("whsec_");return r&&s&&n}catch(r){return console.error("Stripe connection test failed:",r),!1}}function L({onSuccess:t}){const{t:r}=w("navbar"),[s,n]=l.useState(!1),[c,C]=l.useState(!1),[p,i]=l.useState(null),v=q({clientId:g().min(1,r("dashboard.stripeConfiguration.validation.clientIdRequired")),secretKey:g().min(1,r("dashboard.stripeConfiguration.validation.secretKeyRequired")),productKey:g().min(1,r("dashboard.stripeConfiguration.validation.webhookSecretRequired"))}),y=B({resolver:D(v),defaultValues:{clientId:"",secretKey:"",productKey:""}}),{reset:u,watch:T,handleSubmit:_}=y;l.useEffect(()=>{(async()=>{try{const o=await A();o&&u({clientId:o.clientId,secretKey:o.secretKey,productKey:o.productKey})}catch(o){console.error("Error loading configuration:",o)}})()},[u]);const I=_(async d=>{try{n(!0),await N(d),a.success(r("dashboard.stripeConfiguration.toast.saveSuccess")),t?.()}catch{a.error(r("dashboard.stripeConfiguration.toast.saveError"))}finally{n(!1)}}),k=async()=>{try{C(!0),i(null);const d=T();await z(d)?(i("success"),a.success(r("dashboard.stripeConfiguration.toast.testSuccess"))):(i("error"),a.error(r("dashboard.stripeConfiguration.toast.testError")))}catch{i("error"),a.error(r("dashboard.stripeConfiguration.toast.testConnectionError"))}finally{C(!1)}},E=()=>{u(),i(null)};return e.jsxs(G,{methods:y,onSubmit:I,children:[e.jsxs(f,{sx:{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"}},children:[e.jsx(m.Text,{name:"clientId",label:r("dashboard.stripeConfiguration.form.clientId"),placeholder:r("dashboard.stripeConfiguration.form.clientIdPlaceholder"),helperText:r("dashboard.stripeConfiguration.form.clientIdHelperText")}),e.jsx(m.Text,{name:"secretKey",label:r("dashboard.stripeConfiguration.form.secretKey"),type:"password",placeholder:r("dashboard.stripeConfiguration.form.secretKeyPlaceholder"),helperText:r("dashboard.stripeConfiguration.form.secretKeyHelperText")}),e.jsx(m.Text,{name:"productKey",label:r("dashboard.stripeConfiguration.form.webhookSecret"),type:"password",placeholder:r("dashboard.stripeConfiguration.form.webhookSecretPlaceholder"),helperText:r("dashboard.stripeConfiguration.form.webhookSecretHelperText"),sx:{gridColumn:"1 / -1"}})]}),p&&e.jsxs(f,{sx:{mt:2},children:[p==="success"&&e.jsx(b,{severity:"success",children:r("dashboard.stripeConfiguration.alert.testSuccess")}),p==="error"&&e.jsx(b,{severity:"error",children:r("dashboard.stripeConfiguration.alert.testError")})]}),e.jsxs(R,{direction:"row",spacing:2,sx:{mt:3,alignItems:"flex-end"},children:[e.jsx(h,{type:"submit",variant:"contained",loading:s,disabled:s||c,children:r("dashboard.stripeConfiguration.form.saveConfiguration")}),e.jsx(h,{variant:"outlined",onClick:E,disabled:s||c,children:r("dashboard.stripeConfiguration.form.cancel")}),e.jsx(h,{variant:"outlined",color:"secondary",onClick:k,loading:c,disabled:s||c,children:r("dashboard.stripeConfiguration.form.testConnection")})]}),e.jsx(f,{sx:{mt:3},children:e.jsxs(V,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:r("dashboard.stripeConfiguration.form.securityNote")})," ",r("dashboard.stripeConfiguration.form.securityNoteText")]})})]})}function J(){const{t}=w("navbar"),r=()=>{};return e.jsxs(P,{children:[e.jsx(W,{heading:t("dashboard.stripeConfiguration.heading"),links:[{name:"Dashboard",href:x.dashboard.overview.analytics},{name:"Settings",href:x.dashboard.user.root},{name:t("dashboard.stripeConfiguration.breadcrumb")}],sx:{mb:{xs:3,md:5}}}),e.jsx(S,{container:!0,spacing:3,children:e.jsx(S,{size:{xs:12},children:e.jsx(H,{sx:{p:3},children:e.jsx(L,{onSuccess:r})})})})]})}function Sr(){return e.jsx(J,{})}export{Sr as default};
