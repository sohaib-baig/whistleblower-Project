import{a as b,z as P,r as a,i as S,s as k,p as A,j as s,x as _,A as x,B as F,T as E,c as T}from"./index-BJkBHIXD.js";import{a as z}from"./index.esm-DG78EUPk.js";import{a as C}from"./zod-DbnPk1Kl.js";import{F as y}from"./fields-wQ2IQIfM.js";import{F as I}from"./form-provider-BYLnCB41.js";import{S as B}from"./Stack-DSqJGNfN.js";import{o as N,s as p}from"./schemas-BaSQ7w8v.js";import"./text-transform-DM798QSo.js";import"./TextField-BfOXJaKd.js";import"./Select-CM-FquqI.js";import"./index-BdCJuPE0.js";import"./rhf-phone-input-DvY4aKGv.js";import"./index-CDpvdXdB.js";import"./search-not-found-BYtFGFNz.js";import"./InputAdornment-Cyf39fZQ.js";import"./rhf-text-field-D45rQogC.js";import"./RadioGroup-eX8WPtuC.js";import"./FormControlLabel-Do9AncA_.js";import"./Autocomplete-vOabT0lM.js";import"./Chip-Cd7PxQUv.js";import"./rhf-select-BCHEEYe2.js";import"./styles-B-zEs6qR.js";import"./format-number-BErDzwe7.js";import"./upload-default-BMHhCMpu.js";import"./tslib.es6-CTYbIaVE.js";import"./DatePicker-D3hVcc_W.js";const R={title:`Set password | ${_.appName}`},D=N({email:p().email("Invalid email"),token:p().min(10,"Invalid token"),password:p().min(8,"Password must be at least 8 characters").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[^a-zA-Z0-9]/,"Password must contain at least one special character"),password_confirmation:p().min(1,"Please confirm your password")}).refine(r=>r.password===r.password_confirmation,{message:"Passwords must match",path:["password_confirmation"]});function cs(){const[r]=b(),d=P(),[u,j]=a.useState(!1),[w,f]=a.useState(null),[g,o]=a.useState(null),n=a.useMemo(()=>({email:r.get("email")??"",token:r.get("token")??"",password:"",password_confirmation:""}),[r]);a.useEffect(()=>{(!n.email||!n.token)&&o("Activation link is invalid or expired.")},[n]);const i=z({resolver:C(D),defaultValues:n}),v=i.handleSubmit(async c=>{try{f(null),o(null),await S();const t=await k.post("/api/v1/password/set",c),m=t?.message||t?.data?.message;f(m??"Password has been set. Redirecting to loginâ€¦"),j(!0)}catch(t){const m=t?.responseData||t?.response?.data,e=m?.data?.errors||m?.errors;if(e){const l=Object.values(e).flat()[0];l&&typeof l=="string"?(o(l),e.password&&i.setError("password",{type:"server",message:Array.isArray(e.password)?e.password[0]:e.password}),e.password_confirmation&&i.setError("password_confirmation",{type:"server",message:Array.isArray(e.password_confirmation)?e.password_confirmation[0]:e.password_confirmation})):o(t?.message??"Failed to set password")}else o(t?.message??"Failed to set password")}}),{register:h}=i;return a.useEffect(()=>{if(u){const c=setTimeout(()=>{d(A.auth.jwt.signIn,{replace:!0})},1200);return()=>clearTimeout(c)}},[u,d]),s.jsxs(s.Fragment,{children:[s.jsx("title",{children:R.title}),!!w&&s.jsx(x,{severity:"success",sx:{mb:3},children:w}),!!g&&s.jsx(x,{severity:"error",sx:{mb:3},children:g}),s.jsxs(I,{methods:i,onSubmit:v,children:[s.jsx("input",{type:"hidden",...h("email")}),s.jsx("input",{type:"hidden",...h("token")}),s.jsxs(B,{spacing:2.5,children:[s.jsxs(F,{children:[s.jsx(y.Text,{name:"password",label:"Create password",type:"password",slotProps:{inputLabel:{shrink:!0}}}),s.jsx(E,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:"Password must be at least 8 characters and contain: uppercase letter, lowercase letter, and special character"})]}),s.jsx(y.Text,{name:"password_confirmation",label:"Confirm password",type:"password",slotProps:{inputLabel:{shrink:!0}}}),s.jsx(T,{fullWidth:!0,size:"large",type:"submit",variant:"contained",children:"Activate account"})]})]})]})}export{cs as default};
