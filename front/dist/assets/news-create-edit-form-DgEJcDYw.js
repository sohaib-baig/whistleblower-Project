import{j as e,X as W,_ as q,T as w,c as f,a6 as C,ab as z,C as L,B as K,w as M,u as G,a4 as y,r as O,a0 as h,p as X,a5 as F,bA as J,bt as Q,a7 as Y,I as Z}from"./index-BJkBHIXD.js";import{a as $}from"./index.esm-DG78EUPk.js";import{a as N}from"./zod-DbnPk1Kl.js";import{u as ee,c as se,a as ae}from"./news-D7oUkqF0.js";import{F as i}from"./fields-wQ2IQIfM.js";import{s as I}from"./schema-utils-C_-d4BNQ.js";import{F as te}from"./form-provider-BYLnCB41.js";import{M as oe}from"./markdown-CqzjXB8r.js";import{E as re}from"./empty-content-Cck_Y1yy.js";import{N as ie}from"./news-details-hero-BAPErd-B.js";import{S as x}from"./Stack-DSqJGNfN.js";import{C as k}from"./Card-CU8jzKuK.js";import{C as E}from"./CardHeader-BmHD0Q2N.js";import{F as ne}from"./FormControlLabel-Do9AncA_.js";import{o as le,s as n}from"./schemas-BaSQ7w8v.js";function de({open:a,title:s,content:u,isValid:l,onClose:d,coverUrl:o,onSubmit:j,description:b,isSubmitting:c}){const m=s||o,v=s||b||u||o;return e.jsxs(W,{fullScreen:!0,open:a,"aria-hidden":!a,onClose:d,children:[e.jsxs(q,{sx:{py:2,px:3},children:[e.jsx(w,{variant:"h6",sx:{flexGrow:1},children:"Preview"}),e.jsx(f,{variant:"outlined",color:"inherit",onClick:d,children:"Cancel"}),e.jsx(f,{type:"submit",variant:"contained",disabled:!l,loading:c,onClick:j,children:"News"})]}),e.jsx(C,{}),v?e.jsxs(z,{children:[m&&e.jsx(ie,{title:s,coverUrl:o||null}),e.jsx(L,{sx:{mt:5,mb:10},children:e.jsxs(K,{sx:{mx:"auto",maxWidth:720},children:[e.jsx(w,{variant:"h6",children:b}),e.jsx(oe,{children:u})]})})]}):e.jsx(re,{filled:!0,title:"Empty content!"})]})}const ce=a=>le({title:n().min(1,{error:a("dashboard.news.errors.titleRequired")}),description:n().min(1,{error:a("dashboard.news.errors.descriptionRequired")}),content:I.editor().min(20,{error:a("dashboard.news.errors.contentMinLength")}),coverUrl:I.file().nullable().optional(),tags:n().array().optional(),metaKeywords:n().array().min(1,{error:a("dashboard.news.errors.metaKeywordsRequired")}),metaTitle:n().optional(),metaDescription:n().optional(),status:n().optional()});function Ue({currentNews:a}){const{t:s}=M("navbar"),u=G(),l=y(),d=y(!0),o=y(!0),j={title:"",description:"",content:"",coverUrl:null,tags:[],metaKeywords:[],metaTitle:"",metaDescription:"",status:"draft"},b=ce(s),c=$({mode:"all",resolver:N(b),defaultValues:j}),{reset:m,watch:v,setValue:P,handleSubmit:_,formState:{isSubmitting:T,isValid:B}}=c,p=v();O.useEffect(()=>{if(a){const t={title:a.title||"",description:a.description||"",content:a.content||"",coverUrl:a.coverUrl||null,tags:a.tags||[],metaKeywords:a.metaKeywords||[],metaTitle:a.metaTitle||"",metaDescription:a.metaDescription||"",status:a.publish||"draft"};m(t)}},[a,m,c]);const S=_(async t=>{try{let r;const V=a?.coverUrl&&typeof a.coverUrl=="string"&&!t.coverUrl,g={title:t.title,content:t.content,status:t.status||"draft",meta_title:t.metaTitle,meta_description:t.metaDescription,meta_keywords:t.metaKeywords.join(",")};if(V&&(g.cover_image=null),a?(await ee(a.id,g),r=a.id,h.success(s("dashboard.news.toast.updatedSuccessfully"))):(r=(await se(g)).id,h.success(s("dashboard.news.toast.createdSuccessfully"))),t.coverUrl&&t.coverUrl instanceof File)try{await ae(r,t.coverUrl),h.success(s("dashboard.news.toast.coverUploadedSuccessfully"))}catch(U){console.error("Failed to upload cover:",U),h.warning(s("dashboard.news.toast.coverUploadFailed"))}m(),l.onFalse(),u.push(X.dashboard.news.list)}catch(r){console.error("Failed to save news:",r),h.error(s("dashboard.news.toast.saveFailed"))}}),D=(t,r)=>e.jsx(Y,{onClick:r,children:e.jsx(Z,{icon:t?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})}),H=()=>e.jsxs(k,{children:[e.jsx(E,{title:s("dashboard.news.details.heading"),subheader:s("dashboard.news.details.subheader"),action:D(d.value,d.onToggle),sx:{mb:3}}),e.jsxs(F,{in:d.value,children:[e.jsx(C,{}),e.jsxs(x,{spacing:3,sx:{p:3},children:[e.jsx(i.Text,{name:"title",label:s("dashboard.news.details.newsTitle")}),e.jsx(i.Text,{name:"description",label:s("dashboard.news.details.description"),multiline:!0,rows:3}),e.jsxs(x,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",children:s("dashboard.news.details.content")}),e.jsx(i.Editor,{name:"content",sx:{maxHeight:480}})]}),e.jsxs(x,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",children:s("dashboard.news.details.coverImage")}),e.jsx(i.Upload,{name:"coverUrl",maxSize:5242880,helperText:s("dashboard.news.details.coverImageHelper")})]})]})]})]}),R=()=>e.jsxs(k,{children:[e.jsx(E,{title:s("dashboard.news.properties.heading"),subheader:s("dashboard.news.properties.subheader"),action:D(o.value,o.onToggle),sx:{mb:3}}),e.jsxs(F,{in:o.value,children:[e.jsx(C,{}),e.jsxs(x,{spacing:3,sx:{p:3},children:[e.jsx(i.Text,{name:"metaTitle",label:s("dashboard.news.properties.metaTitle")}),e.jsx(i.Text,{name:"metaDescription",label:s("dashboard.news.properties.metaDescription"),fullWidth:!0,multiline:!0,rows:3}),e.jsx(i.Autocomplete,{name:"metaKeywords",label:s("dashboard.news.properties.metaKeywords"),placeholder:s("dashboard.news.properties.metaKeywordsPlaceholder"),multiple:!0,freeSolo:!0,disableCloseOnSelect:!0,options:J.map(t=>t),getOptionLabel:t=>t,slotProps:{chip:{color:"info"}}})]})]})]}),A=()=>e.jsxs(K,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-end"},children:[e.jsx(ne,{label:s("dashboard.news.actions.publish"),control:e.jsx(Q,{checked:p.status==="published",onChange:t=>P("status",t.target.checked?"published":"draft"),slotProps:{input:{id:"publish-switch"}}}),sx:{pl:3,flexGrow:1}}),e.jsxs("div",{children:[e.jsx(f,{color:"inherit",variant:"outlined",size:"large",onClick:l.onTrue,children:s("dashboard.news.actions.preview")}),e.jsx(f,{type:"submit",variant:"contained",size:"large",loading:T,sx:{ml:2},children:s(a?"dashboard.news.actions.saveChanges":"dashboard.news.actions.createNews")})]})]});return e.jsxs(te,{methods:c,onSubmit:S,children:[e.jsxs(x,{spacing:5,sx:{mx:"auto",maxWidth:{xs:720,xl:880}},children:[H(),R(),A()]}),e.jsx(de,{isValid:B,onSubmit:S,title:p.title,open:l.value,content:p.content,onClose:l.onFalse,coverUrl:p.coverUrl,isSubmitting:T,description:p.description})]})}export{Ue as N};
